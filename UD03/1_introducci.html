<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>1. Introducció | 3. El servei DHCP </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.2ppa1 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
	</head>
<body class="exe-web-site" id="exe-node-40"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">3. El servei DHCP</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">3. Servei DHCP</a></li>
   <li><a href="objectius.html" class="no-ch">Objectius</a></li>
   <li><a href="continguts.html" class="no-ch">Continguts</a></li>
   <li id="active"><a href="1_introducci.html" class="active daddy">1. Introducció</a>
   <ul>
      <li><a href="11_evoluci_del_protocol_dhcp.html" class="no-ch">1.1. Evolució del protocol DHCP</a></li>
      <li><a href="12_un_servei_clientservidor.html" class="no-ch">1.2. Un servei client/servidor</a></li>
   </ul>
   </li>
   <li><a href="2_configuraci_dels_equips_de_la_xarxa.html" class="no-ch">2. Configuració dels equips de la xarxa</a></li>
   <li><a href="3_el_model_funcional_dhcp.html" class="no-ch">3. El model funcional DHCP</a></li>
   <li><a href="4_intervals_exclusions_concessions_i_reserves.html" class="no-ch">4. Intervals, exclusions, concessions i reserves</a></li>
   <li><a href="5__opcions_addicionals_del_protocol.html" class="daddy">5.  Opcions addicionals del protocol.</a>
   <ul class="other-section">
      <li><a href="prctica_1_installaci_i_configuraci_dun_servei_dhcp.html" class="no-ch">Pràctica 1: Instal·lació i configuració d'un servei DHCP</a></li>
   </ul>
   </li>
   <li><a href="6_problemes_del_servei.html" class="no-ch">6. Problemes del servei</a></li>
   <li><a href="installaci_dun_servidor__dhcp.html" class="no-ch">Instal·lació d'un servidor  DHCP</a></li>
   <li><a href="activitats.html" class="no-ch">Activitats</a></li>
   <li><a href="prctiques.html" class="no-ch">Pràctiques</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="continguts.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="11_evoluci_del_protocol_dhcp.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">1. Introducció</h1></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id75">
<div class="iDevice emphasis0">
<div id="ta75_154" class="block iDevice_content">
<p>L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.</p>
<p>Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina pesada i repetitiva si no es disposa de serveis de xarxa que la faciliten.</p>
<p>El <strong>servei DHCP</strong> permet la configuració d’adreces IP, màscares, passarel·les per defecte i moltes altres opcions de configuració de manera totalment dinàmica. DHCP és l’acrònim de <em>dynamic host configuration protocol</em>, en català, protocol de configuració dinàmica d’equips. </p>
<div class="exe-block-info">
<p><strong>Què fa el DHCP?</strong></p>
<p>Una forma planera d’entendre el DHCP és imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten “hi ha algú?”, “qui sóc jo?”. El servidor de DHCP els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.</p>
</div>
<p>El servei DHCP proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor DHCP anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-se.</p>
<div class="exe-block-info">
<p><strong>Avantatges DHCP</strong></p>
<p>El servei DHCP té diversos avantatges:</p>
<ul>
<li>Centralitza l'administració.</li>
<li>Evita errors i conflictes IP.</li>
<li>Estalvia temps.</li>
<li>Simplifica l’administració.</li>
</ul>
</div>
<p>Els principals avantatges d’utilitzar DHCP són: d’una banda, evitar conflictes d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor DHCP; i, d’altra banda, poder fer l’administració centralitzada representa un estalvi de temps i de feina.</p>
<p>El servei DHCP simplifica l’administració de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.</p>
<p>La concessió dinàmica d’adreces IP i altres paràmetres de configuració de xarxa es realitza per a un període de temps determinat, que varia en funció de les necessitats del client i del servidor.</p>
<h3>Exemples d'ús del servei DHCP</h3>
<p>Els següents són alguns exemples d’ús del servei DHCP:</p>
<ul>
<li>En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduït, per exemple, minuts.</li>
<li>Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (ISP) tindrà una concessió que segurament serà per hores.</li>
<li>En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant DHCP, els equips rebran concessions dinàmiques per períodes de temps molt llargs, per exemple, dies.</li>
</ul>
<div style="overflow: hidden; position: absolute; top: -5000px; height: 1px;">
<p>Instal·lació de serveis de configuració dinàmica de sistemes <br />DHCP</p>
<p>DHCP és l’acrònim de dynamic host configuration protocol, en català, protocol de configuració dinàmica d’equips.<br />El servei DHCP permet la configuració d’adreces IP, màscares, passarel·les per defecte i moltes altres opcions de configuració de manera totalment dinàmica.</p>
<p>Què fa el DHCP?</p>
<p>Una forma planera d’entendre el DHCP és imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten “que hi ha algú?”, “qui sóc jo?”. El servidor de DHCP els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.<br />Identificació dels equips de xarxa</p>
<p>L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.</p>
<p>Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina feixuga i repetitiva si no es disposa de serveis de xarxa que la facilitin.<br />El servei DHCP<br />El servei DHCP proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor DHCP anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-se.</p>
<p>Avantatges DHCP</p>
<p>El servei DHCP té diversos avantatges:</p>
<p>Evita errors i conflictes IP.<br />Centralitza l’administració.<br />Estalvia temps.<br />Simplifica l’administració.<br />Els principals avantatges d’utilitzar DHCP són: d’una banda, evitar conflictes d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor DHCP; i, d’altra banda, poder fer l’administració centralitzada representa un estalvi de temps i de feina.</p>
<p>El servei DHCP simplifica l’administració de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.<br />La concessió dinàmica d’adreces IP i altres paràmetres de configuració de xarxa es realitza per a un període de temps determinat, que varia en funció de les necessitats del client i del servidor.</p>
<p>Exemples d'ús del servei DHCP</p>
<p>Els següents són alguns exemples d’ús del servei DHCP:</p>
<p>En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduït, per exemple, minuts.<br />Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (ISP) tindrà una concessió que segurament serà per hores.<br />En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant DHCP, els equips rebran concessions dinàmiques per períodes de temps molt llargs, per exemple, dies.<br />Configuració d'un equip de xarxa<br />Qualsevol equip que pertany a una xarxa requereix que es configuri amb uns paràmetres mínims, que són l’adreça IP, la màscara i la porta d’enllaç per defecte. L’adreça IP identifica l’equip de manera única, i la màscara permet determinar la xarxa o subxarxa en què es troba l’equip. Amb aquests dos paràmetres n’hi ha prou per tenir connectivitat en la xarxa. Si es vol disposar d’accés fora de la xarxa pròpia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir també la porta d’enllaç predeterminada. A part de la configuració bàsica, els equips poden necessitar (i de fet ho necessiten) més paràmetres de configuració com, per exemple: el nom del host, el servidor DNS, el fitxer d’iniciació a baixar, etc.</p>
<p>Tot equip de xarxa necessita disposar d’una adreça IP que l’identifica de manera única a la xarxa. Cal també una màscara per poder separar de l’adreça IP quina és la part d’adreça de xarxa i quina la part d’adreça de host. Finalment, és imprescindible disposar de l’adreça de la porta d’enllaç predeterminada o passarel·la per defecte (o gateway), per disposar d’accés a xarxes externes.<br />Exemple de configuració de xarxa d'un equip de casa:</p>
<p>La majoria d’usuaris disposen a casa d’un equip (o més) connectats a un router que proporciona l’accés a Internet. Aquest equip està configurat com a client DHCP i en iniciar-se rep la configuració de xarxa del router. Podeu comprovar a casa quina configuració teniu. Una configuració d’exemple podria ser:</p>
<p>Dirección IP. . . . . . . . . . . : 192.168.1.33<br />Máscara de subred . . . . . . . . : 255.255.255.0<br />Puerta de enlace predeterminada : 192.168.1.1<br />Servidor DHCP . . . . . . . . . . : 192.168.1.1<br />Servidores DNS . . . . . . . . . .: 80.58.61.250<br /> 80.58.61.254<br />L'inconvenient de la configuració estàtica</p>
<p>La configuració estàtica implica configurar els equips un a un. Fins i tot encara que es tingui accés remot als equips (per Telnet o SSH), com que cal modificar la configuració de xarxa no es pot fer assegut des de l’equip de l’administrador, sinó que cal anar equip per equip a modificar la configuració.<br />Aquest procés de configuració cal que es faci per a cada equip de la xarxa. Fer-lo manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les màscares. Qualsevol canvi en l’estructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. És evident que tota aquesta feinada no és agradable per a l’administrador de xarxa (i és molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una solució que permeti automatitzar la configuració de xarxa de cada equip de manera centralitzada.</p>
<p>Les opcions de configuració de xarxa es poden assignar a cada equip estàticament o es poden configurar de manera dinàmica utilitzant DHCP.<br />Com a administradors de xarxa, la gestió centralitzada que ens proporciona DHCP ens permet modificar la xarxa afegint, eliminant i redefinint, equips amb un cost mínim.<br />Tipus d'assignacions d'adreces IP<br />Cada equip de xarxa té assignada una adreça IP que l’identifica de manera única dins la xarxa. La composició de l’adreça IP i la màscara determina la xarxa o subxarxa a la qual pertany. A més a més, es configuren altres paràmetres de xarxa com la porta d’enllaç predeterminada, servidors DNS, etc. Això es pot configurar manualment anant equip per equip i introduint aquesta informació.</p>
<p>Reconfiguració d'una xarxa</p>
<p>Imagineu la diversió de l’administrador d’una xarxa corporativa de 1.000 equips amb adreces estàtiques quan cal reconfigurar-la en un cap de setmana!<br />Quan l’adreça IP i els altres paràmetres necessaris de configuració de la xarxa es configuren equip per equip, manualment, es diu que tenen IP estàtica.<br />Quan la configuració de xarxa d’un equip no es fa manualment i localment en l’equip sinó que es rep per mitjà d’un servidor DHCP, es diu que l’equip utilitza una IP dinàmica. Per realitzar configuracions de xarxa dinàmicament caldran un o més servidors de DHCP (a manera de redundància) que proporcionaran la configuració als equips clients (els que cal configurar). Per tant, serà una estructura client-servidor. Les adreces IP dinàmiques que rep el client les podem classificar en dues categories: assignació dinàmica d’interval i assignació fixa.</p>
<p>El servidor DHCP disposa d’un interval d’adreces que pot assignar als clients que demanen una adreça IP. Quan el servidor assigna una adreça qualsevol de l’interval al client (a l’atzar) es tracta d’una assignació dinàmica d’interval. El client no sap quina adreça IP tindrà i no hi ha manera de predir quina adreça se li concedirà en una futura configuració. A cada nova assignació l’adreça IP pot ser diferent.</p>
<p>MAC</p>
<p>Cada interfície de xarxa s’identifica de manera única físicament per l’adreça MAC (media acces control, adreça d’accés al medi).<br />Una assignació fixa es produeix quan el servidor DHCP sempre assigna la mateixa adreça al client. Per assignar sempre la mateixa adreça IP al client</p>
<p>cal que el servidor pugui identificar inequívocament el client (per l’adreça MAC). El servidor disposa d’una taula amb les correspondències entre les adreces MAC i les adreces IP fixes.</p>
<p>Quan la configuració de xarxa d’un equip es rep per mitjà d’un servidor DHCP es diu que utilitza una adreça IP dinàmica. Aquesta adreça pot variar dins d’un interval d’adreces disponibles per al servidor DHCP o pot ser fixa.<br />Els avantatges de disposar d’una IP fixa són que la vostra identificació a Internet (la vostra adreça IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips, els clients us identifiquen sempre amb la mateixa adreça sense haver de recordar en cada moment quina adreça IP teniu avui (com passa en el cas d’una IP dinàmica).</p>
<p>DNS dinàmic</p>
<p>Hi ha serveis de DNS dinàmic (DDNS) que permeten assignar un nom de domini a equips amb adreça IP dinàmica.<br />El protocol DHCP i els seus components<br />El protocol DHCP ve descrit, com la majoria de protocols de xarxa, per un document oficial anomenat RFC. Al llarg dels anys ha sofert diverses evolucions per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diàleg entre els equips que hi intervenen, ens caldrà doncs analitzar quin és i com es produeix aquest diàleg. Finalment es descriurà el significat de termes tan usuals en DHCP com intervals, exclusions, concessions i reserves.</p>
<p>Què són els RFC?</p>
<p>Els Request for Comments (RFC) són memoràndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies d’Internet. Quan els publica l’IETF (Internet Engineering Task Force) defineixen a escala mundial els protocols i les seves revisions. És a dir, són les publicacions oficials que descriuen els protocols.<br />Per trobar especificacions dels protocols d’Internet, vegeu la secció “Més informació” del web d’aquest mòdul.<br />Evolució del protocol DHCP<br />El servei DHCP és un servei del tipus client-servidor que proporciona la configuració de xarxa als clients que ho sol·liciten. Proporciona els paràmetres bàsics de xarxa com l’adreça IP, la màscara de xarxa, la porta d’enllaç i també d’altres paràmetres necessaris per a una connexió en una xarxa IP. Es tracta d’un protocol de la capa d’aplicació del model TCP/IP.</p>
<p>El protocol DHCP està basat en l’arquitectura de serveis client-servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor DHCP es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.<br />L’RFC 951 és el document base que descriu el protocol BOOTP.<br />La configuració dinàmica d’equips de xarxa es va iniciar amb el protocol BOOTP (BOOT strap protocol, protocol d’arrencada). Un protocol més bàsic que principalment permetia definir l’adreça IP, la màscara de xarxa i la passarel·la per defecte per al client. El protocol BOOTP (RFC 951, any 1985) és un protocol pensat per proporcionar automàticament la IP a clients de xarxa en el procés d’arrencada. Originàriament s’utilitzava per a estacions de treball sense disc que obtenien la configuració de xarxa del protocol BOOTP i també obtenien el nom d’un fitxer d’arrencada que s’havia de baixar per mitjà del TFTP, que usualment era el sistema operatiu.</p>
<p>RFC de DHCP</p>
<p>Principals RFC dedicades a DHCP:</p>
<p>RFC 2131. Març 1997. DHCP dynamic host configuration protocol.<br />RFC 2132. DHCP options.<br />RFC 3396. Encoding long options.<br />RFC 4361. No especific client identifications for dhcpv4.<br />RFC 3315. DHCPv6 dinamic host configuration protocol Ipv6.<br />El BOOTP va donar pas al protocol DHCP, que n’és una evolució amb moltes més prestacions. El DHCP sorgeix l’octubre del 1993 a través de l’RFC 1531. Ràpidament evoluciona per mitjà de diverses RFC, com l’RFC 1541 el mateix any 1993, que serà substituïda per l’RFC 2131 el març del 1997. Aquest document és la base del protocol DHCP actual. A grans trets, el protocol es descriu en l’RFC 2131 per a xarxes Ipv4, el conjunt d’opcions de configuració de DHCP es descriuen en l’RFC 2132, i l’especificació de DHCP per a xarxes Ipv6 és en l’RFC 3315.<br />El model funcional del protocol DHCP<br />Ports DHCP</p>
<p>El protocol DHCP utilitza UDP en la capa de transport. Utilitza dos ports:</p>
<p>Port 67, on escolta el servidor.<br />Port 68, on escolta el client.<br />El protocol DHCP descriu el diàleg que es produeix entre client i servidor per a la concessió de configuracions IP. En una xarxa amb configuració d’equips dinàmica, un o més servidors DHCP escoltaran les peticions dels clients en el port 67. Els clients DHCP sol·licitaran al servidor DHCP una configuració IP, i començarà un procés de negociació que ha d’acabar (si tot va bé) amb la concessió d’una adreça IP al client. Els servidors parlen al port 68 dels clients.</p>
<p>La negociació que s’estableix es pot definir a grans trets de la manera següent:</p>
<p>El client sol·licita una adreça IP (de fet, una configuració de xarxa).<br />El servidor mira les adreces IP disponibles dins de l’interval d’adreces dinàmiques de què disposa per concedir i n’ofereix una al client.<br />Si el client l’accepta, envia una sol·licitud al servidor per fer-la seva.<br />Si al servidor li sembla bé, accepta la petició del client i li confirma que pot utilitzar aquesta IP, que la hi concedeix per un període de temps limitat.<br />UDP en les transmissions DHCP</p>
<p>L’intercanvi d’informació entre client i servidor no és gaire gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). És per això que el protocol que s’utilitza en les transmissions DHCP és l’UDP.<br />La concessió de l’adreça IP és per un període de temps establert pel servidor. Això significa que, transcorregut aquest període, el client haurà de renegociar la concessió en un procés similar al descrit anteriorment. En la figura.1 es pot veure el diàleg de quatre fases client-servidor.</p>
<p>El procés real, però, és més detallat. El podem repassar: consta principalment de quatre parts: la petició del client o discovery, l’oferta del servidor o offer, l’acceptació de l’adreça IP pel client o request, i la confirmació del servidor o acknowledgement. A part d’aquest tipus de missatges, el protocol DHCP en defineix d’altres com el de petició d’informació o information i el d’alliberament de l’adreça IP o releasing.</p>
<p> </p>
<p>Figura Model funcional del protocol DHCP<br /> <br /> <br />Els següents són els tipus de paquets DHCP:</p>
<p>DHCP discover.<br />DHCP offer.<br />DHCP request.<br />DHCP ack / DHCP nack.<br />DHCP decline.<br />DHCP release.<br />DHCP information.<br />DHCP discover<br />En un procés de configuració IP d’un client de DHCP el paquet DHCP discover és el primer que s’envia. L’envia el client per tal de demanar una configuració IP a algun servidor. Generalment, el client s’acaba d’inicialitzar i vol obtenir una configuració dinàmica de xarxa. El client no sap a quina xarxa pertany (no té adreça IP ni màscara de xarxa) i tampoc sap quins servidors DHCP hi ha en la xarxa (si n’hi ha cap).</p>
<p>Una difusió o broadcast s’adreça a la IP 255.255.255.255 o a l’adreça MAC FF:FF:FF:FF, que és acceptada per tots els equips.<br />Per tant, el client genera un paquet de difusió (broadcast) destinat a tots els equips de la xarxa on sol·licita una configuració IP. En la xarxa pot haver-hi cap, un o més d’un servidor DHCP per atendre aquesta petició. És responsabilitat de l’administrador de xarxes configurar correctament l’estructura i els serveis de xarxa de forma que si defineix clients de DHCP hi hagi servidors DHCP que atenguin les seves peticions.<br />DHCP offer<br />En rebre una sol·licitud de configuració d’un client (DHCP discovery), un servidor DHCP mira d’atendre-la proporcionant una IP de l’interval d’adreces dinàmiques que gestiona (hi pot haver més d’un servidor DHCP en la mateixa xarxa).</p>
<p>Diversos servidors DHCP</p>
<p>Es pot configurar més d’un servidor DHCP, tant per a còpia de seguretat o backup com per incrementar el rendiment en compartir la càrrega de les peticions.<br />El servidor tracta d’assignar una IP del conjunt o interval (també anomenat pool) d’adreces dinàmiques que gestiona. Per fer-ho, ha de mirar quines de les adreces li queden lliures i disponibles per concedir al client. Cada vegada que el servidor concedeix una IP a un client, ho anota en un fitxer de registre de les concessions efectuades. Cada vegada que finalitza una concessió, el servidor pot tornar a utilitzar la IP per a un altre client.</p>
<p>Tota concessió (o lease) DHCP és per un període determinat de temps i un cop transcorregut cal renovar-la.<br />El mecanisme que utilitza el servidor per escollir la IP dins del conjunt d’adreces IP disponibles varia en funció del programa de servidor que s’utilitzi. A més a més es poden configurar innumerables opcions del servidor per establir com s’han de fer les concessions. Un cas típic és el de les adreces fixes. A un determinat client sempre se li assigna la mateixa IP. Per això cal disposar de la llista d’adreces MAC dels clients als quals es vol assignar una IP fixa.</p>
<p>Tipus d'adreçament</p>
<p>Hi ha diversos tipus d’adreçament:</p>
<p>Unidestinació o unicast: a un equip<br />Multidestinació multicast: a un conjunt d’equips<br />De difusió o broadcast: a tothom.<br />El servidor selecciona una IP disponible i la reserva per al client (encara no està assignada). Tot seguit envia un paquet DHCP offer (unidestinació o unicast) al client amb tota la informació de configuració requerida. L’adreça IP i MAC origen identifiquen el servidor que fa l’oferta. El destinatari s’indica per la seva adreça MAC (que és coneguda). El camp IP del destinatari és l’adreça IP que el servidor ofereix (penseu que el client encara no té IP). Un altre concepte important és per quant de temps es realitza la concessió. El paquet inclou més camps per completar la resta de configuració de xarxa, per exemple, la porta d’enllaç per defecte, els servidors DNS, etc.<br />DHCP request<br />Quan el client rep una oferta de configuració IP per part d’un servidor, la pot acceptar o rebutjar. Si el client no accepta l’oferta, simplement realitzarà un DHCP discovery de nou. Això és suficient perquè el servidor s’adoni que l’oferta ha estat rebutjada.</p>
<p>Si el client accepta l’oferta, ho ha de comunicar al servidor. El mecanisme per fer-ho és mitjançant un paquet DHCP request enviat un altre cop per difusió. A hores d’ara, el client encara no disposa de l’adreça IP per utilitzar-la. El servidor l’ha reservat, però encara no ha donat el sí definitiu perquè sigui concedida al client.</p>
<p>El motiu pel qual el client demana quedar-se la concessió (DHCP request) que ha rebut utilitzant difusió és fer públic a tothom de la xarxa que ha acceptat una oferta d’un servidor DHCP concret. Recordeu que la petició del client es fa per difusió i, per tant, pot rebre ofertes de diferents servidors DHCP. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pública quina oferta accepta, la resta de servidors DHCP entenen que la seva oferta s’ha rebutjat.<br />DHCP ack/DHCP nack<br />ACK i NACK</p>
<p>ACK i NACK són dos acrònims usuals en el món de la informàtica que signifiquen confirmació (acceptació) i no-conformitat (refús) respectivament.<br />L’últim pas en una negociació DHCP bàsica el realitza el servidor quan finalment autoritza la concessió enviant el paquet DHCPACK (DHCP akcnowledgement). A partir d’aquest moment, el client sí pot fer ús de l’adreça IP i de la configuració de xarxa rebuda. DHCPACK inclou tota la informació referent a la durada de la concessió i les dades necessàries per gestionar quan expira.</p>
<p>El servidor anotarà en el registre de concessions la que acaba de realitzar i detallarà tots els aspectes d’aquesta, en especial el temps de concessió. El paquet d’acceptació de la concessió DHCPACK és un paquet unidestinació adreçat a la MAC del client. Recordeu que el client encara no disposa d’una adreça IP vàlida, en disposarà en rebre el DHCPACK.</p>
<p>Exemple de mala configuració d'un equip</p>
<p>Un exemple de mala configuració és la d’un equip que s’ha engegat amb una adreça IP estàtica errònia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si l’adreça IP ja està essent utilitzada és fer un ping. Si ningú no respon és que està lliure (segurament).<br />Quan un servidor DHCP detecta que la IP que havia reservat per a un client i que li anava a concedir ja està en ús, el servidor envia al client un paquet DHCPNACK i indica la no-autorització de la concessió. El client que rep un DHCPNACK ha de tornar a iniciar tot el procés de negociació començant un altre cop pel DHCP discovery.</p>
<p>Com és possible que algun equip de la xarxa utilitzi una adreça IP que forma part del conjunt d’adreces IP dinàmiques que reparteix el servidor DHCP? La resposta és senzilla: perquè hi ha algun equip mal configurat.<br />DHCP decline<br />Per la seva part, el client també pot examinar l’adreça IP oferta pel servidor per comprovar si està en ús o no. Pot fer altres proves per veure si li sembla correcta o no l’oferta rebuda del servidor. Per exemple, en el cas de renovació d’una IP el client pot rebre una IP diferent a la que utilitza i no li interessa. En aquests casos, el client pot enviar un paquet DHCP decline al servidor per indicar que la seva oferta ha estat rebutjada.<br />DHCP release<br />Quan un client ja no necessita més l’ús de la configuració IP que ha rebut, la pot alliberar enviant al servidor un paquet DHCP release. En fer-ho, el servidor afegeix l’adreça IP al conjunt d’adreces dinàmiques que té disponibles. També fa l’anotació pertinent en el registre de concessions (leases) per indicar que ha finalitzat l’ús de l’adreça. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquè és apagat per l’usuari sense deixar temps al sistema per alliberar la IP.<br />DHCP information<br />En tot moment el client pot sol·licitar més informació sobre la configuració de xarxa al servidor utilitzant un paquet DHCP information. En el paquet DHCP offer que el servidor envia al client, consten les informacions generals de configuració de xarxa que es trameten en l’oferta: adreça IP, màscara de xarxa, porta d’enllaç predeterminada, servidor DNS, fitxer a baixar i molts altres paràmetres que poden estar configurats per enviar-se en l’oferta. El client pot tornar a demanar al servidor la informació d’aquests paràmetres o pot sol·licitar informació per a la configuració d’altres paràmetres (WINS, NetBIOS, hostname, etc.). El client només pot realitzar una petició d’informació DHCP information al servidor un cop ja està configurat.<br />Petició de renovació/concessió d'una IP concreta<br />El procés de quatre fases usuals de DHCP consistent en discovery/offer/request/ack es produeix quan el client sol·licita una IP de nou. Sabem que les concessions són per a un interval de temps passat, la renovació de la qual cal que el client la demani. Existeix, doncs, un procés de renovació simplificat. El client demana continuar usant la mateixa IP amb un paquet DHCP request, i el servidor li concedeix o no amb els paquets DHCP ACK/NACK.</p>
<p>Macchange</p>
<p>L’ordre GNU permet (mascarade) emmascarar l’adreça MAC pròpia. Compte! No feu dolenteries.<br />Un altre cas és un client que demana usar (renovar) una adreça IP que el servidor no li pot concedir (està en ús, no és de l’interval que gestiona, etc.). En aquesta situació, el servidor envia un DHCP NACK.<br />Atacs al funcionament de DHCP i conflictes d'adreces IP<br />vei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions DHCP discovery fingint que són clients diferents (emmascarant la seva MAC) amb la intenció d’esgotar les adreces IP disponibles del servidor o simplement amb la intenció de sobrecarregar-lo amb tantes peticions que no doni a l’abast a atendre-les o que ho faci lentament.</p>
<p>Un altre tipus d’atac consisteix a falsejar la informació que s’envia al client. Recordem que el client fa una sol·licitud d’IP en forma de difusió (broadcast) i la seva petició pot ser atesa per un o més servidors DHCP. Un dels servidors DHCP pot ser un atacant que intentarà proporcionar informació de configuració falsa al client. Per exemple indicant un servidor DNS també maliciós. Aquest pot falsejar les identitats de les màquines de la xarxa i, quan el client s’adreça a la seva entitat bancària, el servidor DNS en realitat li ha proporcionat una IP d’una màquina que falseja la de l’entitat bancària. Perillós, oi?</p>
<p>Tipus d'atacs DNS</p>
<p>Clients no autoritzats: accés a servidors DNS per part de clients no autoritzats. Servidors no autoritzats: servidors DNS impostors que suplanten els vertaders servidors.<br /> </p>
<p>Per posar remei a la inseguretat en la comunicació client-servidor DHCP, el protocol permet utilitzar mecanismes d’autenticació i xifratge. Aquests mecanismes queden fora de l’abast d’aquesta explicació.<br />Conflictes amb les adreces IP<br />Un dels principals motius per utilitzar DHCP és simplificar el procés de configuració de xarxa i minimitzar els conflictes per encavalcament d’adreces IP. Per desgràcia, això no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en què dues màquines diferents tinguin la mateixa IP per una simple mala configuració del servidor DHCP. Un altre cas típic és el d’un client que s’ha configurat ell mateix una IP estàtica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreça IP assignada pel servidor DHCP.</p>
<p>Un problema habitual per als administradors poc experimentats és definir una configuració de xarxa local al client (hostname, servidor DNS, porta d’enllaç a utilitzar, etc.), però demanar l’adreça IP dinàmicament. La configuració dinàmica no és solament la IP i la màscara, sinó que el servidor DHCP pot proporcionar altres paràmetres de xarxa que sobreescriuran els que el client tenia definits localment (aquest és l’objectiu de DHCP!).</p>
<p>La configuració rebuda per DHCP sobreescriu la configuració local del client.<br />Intervals, exclusions, concessions i reserves<br />Els clients DHCP obtenen del servidor una configuració de xarxa. Descrivim ara alguns dels termes que tenen lloc durant aquest procés, i que formen part de la configuració DHCP.</p>
<p>Interval: anomenen interval d’adreces IP el conjunt d’adreces dinàmiques que el servidor té disponibles per assignar als clients. Les adreces IP disponibles s’agrupen per oferir-se a les diverses subxarxes que atén el servidor. Una mateixa subxarxa pot disposar de diversos intervals. Segurament s’entendrà més fàcilment amb un exemple:<br />subnet 140.220.191.0 netmask 255.255.255.0 {<br /> range 140.220.191.150 140.220.191.249;<br /> }</p>
<p>subnet 239.252.197.0 netmask 255.255.255.0 {<br /> range 239.252.197.10 239.252.197.107;<br /> range 239.252.197.113 239.252.197.250;<br /> }<br />En l’exemple anterior s’observa que la primera subxarxa disposa d’un interval de 100 adreces dinàmiques (de la 140.220.191.150 al 250). La segona subxarxa permet assignar dinàmicament dos intervals d’adreces no correlatius.<br />Exclusions: entenem per exclusions aquelles adreces IP que no s’ofereixen dinàmicament per part del servidor. És a dir, que no formen part de cap interval.<br />Concessions: l’assignació d’una adreça IP i la resta de paràmetres de xarxa a un client per part del servidor, és una concessió (o leasse). Els clients reben les concessions per períodes de temps finits, que en finalitzar, cal renegociar. Tant el client com el servidor s’anoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessió el servidor pot decidir revocar-la o ampliar-ne la concessió.<br />El client tothora pot decidir renunciar a la concessió. Si el client vol allargar la concessió inicia un diàleg DHCP abreujat amb el servidor que pot acabar amb una renovació o amb la pèrdua de la concessió (sempre pot tornar a començar el procés). Tant el servidor com el client normalment miren les concessions que s’han efectuat entre ells amb anterioritat per tal de, si és possible, repetir la mateixa assignació.<br />Reserves: anomenem reserves aquelles adreces IP que s’assignen via DHCP però de manera fixa. És a dir, són adreces que s’assignen dinàmicament però sempre i únicament a un host determinat. Fixeu-vos que tot i ser una adreça dinàmica només s’utilitza si el host associat en fa ús. Si el host està apagat l’adreça no es pot usar per a altres hosts, està reservada. Un exemple podria ser:<br />subnet 140.220.191.0 netmask 255.255.255.0 {<br /> host iocserver {<br /> hardware ethernet 08:00:2b:4c:59:23;<br /> fixed-address 140.220.191.1;<br /> }<br /> range 140.220.191.150 140.220.191.249;<br /> }<br />En aquest exemple es pot veure que l’adreça 140.220.191.1 és una adreça reservada exclusivament per al host iocserver, que s’identifica mitjançant la seva adreça MAC.<br />DHCP un servei client/servidor<br />Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.<br />El servei DHCP és un més dels serveis de xarxa que tenen l’estructura client /servidor. Els servidors DHCP són els equips que tenen en execució el programa servidor. És el programa encarregat d’atendre les peticions dels clients i oferir-los la configuració de xarxa, tot portant el registre de les IP que concedeix i el registre de totes les accions que realitza. Els clients DHCP són aquells equips que realitzen peticions per obtenir una configuració de xarxa a un servidor DHCP.<br />El client DHCP<br />Un equip client DHCP és un equip que sol·licita la IP i altres paràmetres de configuració de xarxa a un servidor DHCP en lloc de tenir-los definits localment en l’equip.</p>
<p>ISP</p>
<p>ISP: Internet service provider o proveïdor de servei/accés a Internet. Ho són per exemple les empreses Ono, Vodafone, Jazztel, etc.<br />Si connecteu el vostre equip informàtic a la xarxa Internet per mitjà d’un ISP (Internet service provider o proveïdor de servei/accés a Internet), segurament rebreu una IP dinàmica del vostre proveïdor. Quan es realitzava una trucada telefònica amb mòdem i usant el protocol PPP (point to point protocol, protocol punt a punt), el proveïdor proporcionava una adreça IP dinàmica. Si utilitzeu ADSL i un encaminador o router, segurament l’encaminador us proporciona una adreça IP dinàmica privada a l’ordinador de casa. Al mateix temps, l’encaminador obté una IP dinàmica pública del proveïdor. Aquestes adreces IP dinàmiques són fixes (sempre les mateixes) o dinàmiques d’interval (pot ser qualsevol IP del conjunt d’adreces IP que té disponibles per concedir el servidor DHCP).</p>
<p>IP pública / IP privada</p>
<p>La diferència entre una IP pública i una IP privada és que la pública és visible per a tots els equips d’Internet, mentre que la privada és visible només dins de la mateixa xarxa local.<br />El client DHCP ha de tenir en funcionament un dimoni (daemon) encarregat de la gestió de les tasques DHCP per part del client. El programa client realitza la part de negociació encarregada al client (DHCP discovery, request) i també porta un registre de les concessions (leases) rebudes. Aquest registre és el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessió el programa client queda “adormit”, pendent de tornar-se a executar automàticament quan calgui renegociar la concessió. Sense intervenció de l’usuari, el programa client s’activa i segueix el procediment necessari per renegociar l’adreça IP cada cop que el temps de la concessió s’exhaureix.</p>
<p>Configuració client</p>
<p>Usualment les configuracions clients es poden fer de tres maneres diferents:</p>
<p>fitxer de text: editar directament els fitxers de configuració.<br />menús en mode text: usant algun programa de menús amb interfície de text.<br />aplicació gràfica: usant una aplicació de finestres en l’entorn gràfic.<br />Els programes client varien d’un sistema operatiu a un altre i la manera d’executar-los també. Generalment es disposa d’un client executable en mode text o ordres i d’una interfície gràfica (GUI, graphics user interface o interfície gràfica d’usuari) per a la configuració. No cal dir que els sistemes Windows tendeixen a la configuració gràfica usant finestres i a la configuració i execució interna d’amagat de l’usuari. Normalment, en els sistemes GNU/Linux, la configuració es fa usant fitxers de text o com a opcions en l’ordre d’execució. La interfície gràfica acostuma a ser un frontal (front-end) per cridar l’ordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de leasses, més o menys detalladament.</p>
<p>Generalment el programa client es pot configurar per definir-ne el comportament en la comunicació amb el servidor: informació a demanar, informació a proporcionar al servidor, opcions per defecte, etc.<br />El servidor DHCP<br />L’administrador de xarxa és l’encarregat de pensar la ubicació del servidor o servidors DHCP en l’estructura corporativa. Com més complicada sigui la topologia de la xarxa, més difícil en serà la gestió. Una xarxa corporativa bàsica pot disposar d’un únic servidor DHCP que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, però totes amb connectivitat amb el servidor DHCP. Aquest també pot ser l’esquema d’una xarxa privada a casa, on un encaminador (el de l’ISP, per exemple) proporciona el servei DHCP a tots els ordinadors de la casa.</p>
<p>Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs les unes de les altres, la configuració del servidor DHCP es complica. Si es vol continuar amb un únic servidor per a tota la xarxa, caldrà que els tallafocs (firewalls) deixin passar els paquets DHCP entre les subxarxes i el servidor. Una altra opció és posar un servidor DHCP per a cada subxarxa o grups de subxarxes. Fent-ho així, l’administració de cada servidor és més senzilla però hi ha més servidors a administrar. Una xarxa amb una casuística completa és la que té diversos servidors DHCP per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets DHCP.</p>
<p>Si el servidor DHCP és l’encarregat de donar adreces IP als clients, qui li proporciona una adreça IP a ell? O bé un altre servidor DHCP (i podríem tornar a fer la mateixa pregunta indefinidament) o bé l’administrador. Usualment, en una xarxa corporativa el servidor DHCP utilitza una IP estàtica definida per l’administrador. Això li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre d’un altre servidor extern.</p>
<p>Hi ha diversos programes servidors DHCP: en mode text, en mode gràfic, en mode “màgic” (no es veu què fan) i en mode Unix (tot basat en fitxers de text). Cada administrador treballa amb les seves eines preferides. Les tasques bàsiques per aprendre a utilitzar un servidor DHCP són observar/fer una llista de la configuració actual, activar/aturar el servei, modificar la configuració, monitorar els logs (registre de successos del servei) i, evidentment, saber instal·lar i desinstal·lar l’aplicació servidor.</p>
<p>Els fitxers de logs (successos) recullen els esdeveniments que es volen monitorar.<br />Com la majoria de serveis de xarxa, el servei DHCP és un servei que s’executa en segon pla en forma de dimoni. El servidor DHCP sempre està engegat escoltant en el port 67 les peticions que rep dels clients. Quan rep una petició entrant, el programa executable del servidor DHCP la processa i posa en marxa tot el mecanisme DHCP pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultàniament (segons la configuració).</p>
<p>Els fitxers del registre del servei, on s’anoten les concessions, permeten mantenir la informació encara que el servei s’aturi o que el servidor s’apagui. En tornar a engegar es llegiran de nou els fitxers de registres per tal de saber quines són les concessions que s’havien realitzat.</p>
<p>Els fitxers de concessions permeten mantenir la coherència de l’assignació d’adreces IP entre aturades del servei.<br />Instal·lació d'un servei DHCP<br />El servei de xarxa DHCP està estructurat en forma de servei client / servidor; per tant, caldrà disposar del programari apropiat per fer cada un d’aquests rols. El programari que fa la funció de client usualment ja està integrat en el sistema operatiu (la part que gestiona la xarxa). És a dir, per disposar de la part client del servei DHCP normalment no cal instal·lar res, ja forma part del servei de xarxa.</p>
<p>Així doncs, quan parlem d’instal·lar un servei DHCP fem referència al procés d’instal·lació i configuració del programari del servidor DHCP. Evidentment també caldrà configurar els clients adequadament per fer ús d’aquest servei.</p>
<p>La instal·lació del programari que proporciona el servei DHCP es fa de manera molt similar (per no dir idèntica) al programari d’altres serveis de xarxa com els serveis DNS, HTTP, FTP, etc. Es tracta d’instal·lar el programari de l’aplicació servidor i fer-ne la configuració apropiada. Senzill oi?</p>
<p>Per fer això cal plantejar-se els passos següents:</p>
<p>Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?<br />Obtenir l’aplicació que proporciona el servei DHCP.<br />Observar l’estat de la xarxa actual. Està el servei ja en funcionament? Existeix ja una configuració DHCP activa?<br />Instal·lar l’aplicació servidor.<br />Comprovar que la instal·lació s’ha efectuat correctament.<br />Configurar el servei en el servidor i activar els clients perquè l’utilitzin.<br />Comprovar que el servei funciona correctament.<br />Aplicacions servidor DHCP<br />Sempre que l’administrador vol posar en funcionament un nou servei de xarxa cal que primerament analitzi quines aplicacions hi ha al mercat que ofereixen aquest servei. És feina seva estudiar les característiques de les diverses aplicacions, com per exemple: avaluar-ne l’eficiència, el cost, el que en diuen els altres… La manera més fàcil de fer això és navegar per Internet, consultar les revistes especialitzades o demanar consell a un dels gurus informàtics coneguts.</p>
<p>Usualment l’administrador s’informa a través del seu cercador preferit, per exemple Google, i de webs com la Viquipèdia. Podeu cercar DHCP o DHCP server al Google i a la wiki (en anglès).<br />Usualment, però, l’administrador acaba utilitzant l’aplicació servidor DHCP que li proporciona el mateix sistema operatiu. Si utilitzeu el sistema operatiu Windows l’empresa Microsoft disposa d’una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment si utilitzeu GNU/Linux segurament la mateixa distribució ja proporciona un servidor DHCP. De totes maneres en podeu obtenir d’altres també a Internet.<br />Instal·lar l'aplicació servidor<br />Tot seguit es descriurà el procés per instal·lar el servei DHCP en un entorn GNU/Linux. Un cop feta la instal·lació cal observar què s’ha instal·lat, quins programes executables, on són els fitxers de configuració, els de monitoratge, etc.</p>
<p>Els usuaris GNU/Linux poden buscar fàcilment per Internet quins paquets del client i del servidor dhcp usant eines com yum, apt-get o wget, a part dels repositoris de programari usuals o del mateix Google.</p>
<p>Llista de paquets rpm que contenen exactament el text dhcp:</p>
<p>[root@portatil ~]# yum list dhcp <br />fedora 100% |===================================================| 2.3 kB 00:00 <br />Installed Packages <br />dhcp.i386 12:3.0.5-42.fc7 installed<br />Llista de paquets que contenen la cadena dhcp:</p>
<p>[root@portatil ~]# yum list dhcp* <br />Installed Packages <br />dhcp.i386 12:3.0.5-42.fc7 installed <br />dhcpv6_client.i386 0.10-44.fc7 installed <br />Available Packages <br />dhcp-devel.i386 12:3.0.5-42.fc7 updates <br />dhcp-forwarder.i386 0.7-12.fc7 fedora <br />dhcp-forwarder-sysv.i386 0.7-12.fc7 fedora <br />dhcp-static.i386 12:3.0.5-42.fc7 updates <br />dhcpv6.i386 0.10-44.fc7 updates<br />Instal·lar el paquet dhcp:</p>
<p># yum install dhcp<br />Fer la llista dels paquets dhcp instal·lats. Si el sistema ja els té instal·lats o volem comprovar-ho podem consultar els paquets instal·lats:</p>
<p>[root@portatil ~]# rpm -qa | grep dhcp <br />libdhcp6client-0.10-44.fc7 <br />libdhcp4client-3.0.5-42.fc7 <br />dhcp-3.0.5-42.fc7 <br />dhcpv6_client-0.10-44.fc7 <br />libdhcp-1.24-6.fc7<br />Obtenir informació del paquet del servei dhcp instal·lat:</p>
<p>[root@portatil ~]# rpm -qi dhcp <br />Name : dhcp Relocations: (not relocatable) <br />Version : 3.0.5 Vendor: Fedora Project <br />Release : 42.fc7 Build Date: dl 12 nov 2007 17:37:56 CET <br />Install Date: dc 23 gen 2008 19:14:18 CET Build Host: xenbuilder4.fedora.phx.redhat.com <br />Group : System Environment/Daemons Source RPM: dhcp-3.0.5-42.fc7.src.rpm <br />Size : 2162920 License: ISC <br />Signature : DSA/SHA1, dl 14 gen 2008 19:35:22 CET, Key ID b44269d04f2a6fd2 <br />Packager : Fedora Project <br />URL : http://isc.org/products/DHCP/ <br />Summary : DHCP (Dynamic Host Configuration Protocol) server and relay agent <br />Description : <br />El DHCP (protocol de configuració dinàmica de màquines) és un protocol <br />que permet a dispositius individuals d'una xarxa IP obtenir la seva <br />informació de configuració de xarxa (adreça IP, màscara de subxarxa, <br />adreça de difusió, etc) d'un servidor DHCP. El propòsit del DHCP és <br />fer més senzilla l'administració d'una xarxa gran. El paquet dhcp <br />inclou el servei DHCP i l'agent de repetició de l'ISC. <br />Per usar DHCP a la vostra xarxa, instal·leu un servei DHCP (o agent <br />de repetició) i als clients executeu un dimoni client DHCP. El paquet <br />dhcp proporciona servei DHCP i l'agent de repetició de l'ISC.<br />Observar els components del programari instal·lat<br />Sovint passa que els usuaris instal·len programes als ordinadors però no saben quins fitxers han instal·lat ni on són. Un administrador curiós ha de fer un repàs a tot allò que s’ha afegit de nou al sistema.</p>
<p>Fer la llista dels components del paquet dhcp:</p>
<p>[root@portatil ~]# rpm -ql dhcp <br />/etc/dhcpd.conf <br />/etc/openldap/schema/dhcp.schema <br />/etc/rc.d/init.d/dhcpd <br />/etc/rc.d/init.d/dhcrelay <br />/etc/sysconfig/dhcpd <br />/etc/sysconfig/dhcrelay <br />/usr/bin/omshell <br />/usr/sbin/dhcpd <br />/usr/sbin/dhcrelay <br />/usr/share/doc/dhcp-3.0.5 <br />... output suprimit ....<br />/usr/share/doc/dhcp-3.0.5/rfc951.txt <br />/usr/share/man/man1/omshell.1.gz <br />... output suprimit ...<br />/usr/share/man/man8/dhcrelay.8.gz <br />/var/lib/dhcpd <br />/var/lib/dhcpd/dhcpd.leases<br />En funció del directori on s’ubiquen els fitxers podem intuir si són executables, de configuració o de documentació. També podem mirar de filtrar la sortida en cada cas:</p>
<p>Fitxers de configuració (usualment en el directori /etc):</p>
<p>[root@portatil ~]# rpm -qc dhcp <br />/etc/dhcpd.conf <br />/etc/openldap/schema/dhcp.schema <br />/etc/sysconfig/dhcpd <br />/etc/sysconfig/dhcrelay <br />/var/lib/dhcpd/dhcpd.leases <br /> <br />[root@portatil ~]# rpm -ql dhcp | grep etc <br />/etc/dhcpd.conf <br />/etc/openldap/schema/dhcp.schema <br />/etc/rc.d/init.d/dhcpd <br />/etc/rc.d/init.d/dhcrelay <br />/etc/sysconfig/dhcpd <br />/etc/sysconfig/dhcrelay<br />Fitxers de documentació:</p>
<p>[root@portatil ~]# rpm -qd dhcp <br />/usr/share/doc/dhcp-3.0.5/IANA-arp-parameters <br />/usr/share/doc/dhcp-3.0.5/README <br />/usr/share/doc/dhcp-3.0.5/README.ldap <br />/usr/share/doc/dhcp-3.0.5/RELNOTES <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/3.0b1-lease-convert <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/dhcp.spec <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/dhcpd-conf-to-ldap <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/ms2isc/Registry.perlmodule <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/ms2isc/ms2isc.pl <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/ms2isc/readme.txt <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/sethostname.sh <br />/usr/share/doc/dhcp-3.0.5/__fedora_contrib/solaris.init <br />/usr/share/doc/dhcp-3.0.5/api+protocol <br />/usr/share/doc/dhcp-3.0.5/dhcpd.conf.sample<br />/usr/share/doc/dhcp-3.0.5/draft-ietf-dhc-authentication-14.txt <br />/usr/share/doc/dhcp-3.0.5/draft-ietf-dhc-dhcp-dns-12.txt <br />/usr/share/doc/dhcp-3.0.5/draft-ietf-dhc-failover-07.txt <br />/usr/share/doc/dhcp-3.0.5/draft-ietf-dhc-ldap-schema-01.txt <br />/usr/share/doc/dhcp-3.0.5/rfc1542.txt <br />/usr/share/doc/dhcp-3.0.5/rfc2131.txt <br />/usr/share/doc/dhcp-3.0.5/rfc2132.txt <br />/usr/share/doc/dhcp-3.0.5/rfc2485.txt <br />/usr/share/doc/dhcp-3.0.5/rfc2489.txt <br />/usr/share/doc/dhcp-3.0.5/rfc951.txt <br />/usr/share/man/man1/omshell.1.gz <br />/usr/share/man/man5/dhcp-eval.5.gz <br />/usr/share/man/man5/dhcp-options.5.gz <br />/usr/share/man/man5/dhcpd.conf.5.gz <br />/usr/share/man/man5/dhcpd.leases.5.gz <br />/usr/share/man/man8/dhcpd.8.gz <br />/usr/share/man/man8/dhcrelay.8.gz<br />Podem mirar de filtrar quins són els executables tenint en compte que usualment estaran en un directori de nom bin o sbin:</p>
<p>Arxius executables</p>
<p>En GNU/Linux els fitxers executables per l’administrador es troben usualment a i a . Els executables d’usuari normalment són a i .<br />[root@portatil ~]# rpm -ql dhcp | grep bin <br />/usr/bin/omshell /sbin<br />/usr/sbin/dhcpd /usr/sbin<br /> /bin<br />/usr/sbin/dhcrelay /usr/bin<br /> </p>
<p>En resum:</p>
<p>Els fitxers de documentació es troben generalment a: /usr/share/doc i a /usr/share/man.<br />Els fitxers de configuració es troben a: /etc, i a /etc/sysconfig.<br />El dimoni del servei es troba a: /usr/sbin/dhcpd.<br />El fitxer de configuració del dimoni del servei és: /etc/dhcpd.conf.<br />El fitxer de govern del servei és: /etc/rc.d/init.d/dhcpd.<br />Activar/desactivar el servei i nivells d'arrancada<br />Un cop feta la instal·lació física de l’aplicació servidor DHCP (els fitxers) cal posar-lo en marxa, engegar-lo, o comprovar que ja ho està.</p>
<p>Serveis de xarxa: stand alone o xinetd</p>
<p>En la majoria de serveis de xarxa el servidor pot funcionar com un servei per si mateix (stand alone) o pot estar configurat per funcionar dins d’un superservei de xarxa com per exemple inetd i xinetd. Si funciona en mode de servei propi és el servidor qui escolta les connexions entrants i les atén. Si s’executa dins del superservei de xarxa, aquest és qui detecta les connexions entrants i activa el dimoni del servei per tal que les atengui, un cop ateses el dimoni del servei acaba i torna a ser el superservidor de xarxa qui es queda escoltant.</p>
<p>En un primer moment molts serveis funcionaven en mode stand alone, però això es va mostrar poc eficient a nivell de recursos. Fixeu-vos que si es vol oferir n serveis de xarxa, cal tenir engegats els n servidors corresponents. Aquests ocupen memòria i CPU, tot i que no atenguin cap client. Estan engegats només “per si” un client els demana.</p>
<p>Un model més eficient és engegar un únic procés que fa la tasca de superservidor de xarxa (inetd o xinetd) i només quan es rep una petició d’un client, s’executa el servei apropiat.</p>
<p>Usualment els serveis que funcionen en mode xinetd disposen de fitxers de configuració lligats al xinetd. Els serveis que actuen indivudualment disposen dels fitxers de configuració propis al etc rc.dinit.d/.</p>
<p>Molt sovint és decisió de l’administrador configurar en quin mode de funcionament vol que treballi el servei. Per exemple el servei de pàgines web (httpd), el servei ssh i molts d’altres, funcionen individualment. Serveis més bàsics com telnet, finger, tftp, etc funcionen usualment dins del xinetd.<br />Primerament cal saber si el servidor instal·lat funciona en mode stand-alone o dins del superdimoni de xarxa xinetd o initd. Si existeixen fitxers de configuració dins del directori /etc/xinetd.d/&lt;nom-servei&gt; es tracta d’un servei dins del xinetd. Si existeixen fitxers de configuració dins del directori /etc/rc.d/init.d/&lt;nom-servei&gt; es tracta d’un servei stand-alone. Podem fer:</p>
<p>[root@portatil ~]# rpm -ql dhcp | grep /etc <br />/etc/dhcpd.conf <br />/etc/openldap/schema/dhcp.schema <br />/etc/rc.d/init.d/dhcpd <br />/etc/rc.d/init.d/dhcrelay <br />/etc/sysconfig/dhcpd <br />/etc/sysconfig/dhcrelay<br />Com podem observar es tracta d’un servei stand-alone. També es pot consultar el tipus de servei amb l’ordre chkconfig i observar si surt en la llista d’un tipus o de l’altre:</p>
<p>[root@portatil ~]# chkconfig --list | grep dhcpd <br />dhcpd 0:apagat 1:apagat 2:apagat 3:apagat 4:apagat 5:apagat 6:apagat <br />Per facilitar buscar els serveis “stand-alone” podem fer:</p>
<p>[root@portatil ~]# chkconfig --list dhcpd <br />dhcpd 0:apagat 1:apagat 2:apagat 3:apagat 4:apagat 5:apagat 6:apagat<br />L’estat del servei pot ser en execució (running) o aturat (stopped). Es pot consultar l’estat amb l’opció status de l’ordre service o del mateix executable del servei:</p>
<p>Es pot saber l'estat del servei amb l'opció status de les ordres:<br />[root@portatil ~]# service dhcp status <br />dhcp està aturat <br />[root@portatil ~]# /etc/rc.d/init.d/dhcpd status <br />dhcp està aturat<br />La gestió de l’estat d’un servei normalment inclou les opcions start, stop, status, restart i reload. Aquestes són les més usuals, però cada servei pot definir les que cregui oportunes. Aquests són exemples de gestió de l’estat del servei DHCP:</p>
<p>Es pot arrancar el servei amb l’opció start de les ordres:</p>
<p>[root@portatil ~]# service dhcpd start <br />S'està iniciant el servei dhcpd: [ FET ] <br />[root@portatil ~]# /etc/rc.d/init.d/dhcpd start <br />S'està iniciant el servei dhcpd: [ FET ]<br />Es pot aturar el servei amb l’opció stop de les ordres:</p>
<p>[root@portatil ~]# service dhcpd stop <br />S'està aturant el dhcpd: [ FET ] <br />[root@portatil ~]# /etc/rc.d/init.d/dhcpd stop <br />S'està aturant el servei dhcpd: [ FET ] <br />Es pot iniciar de nou el servei (recarregar) amb l’opció reload o restart de les ordres:</p>
<p>[root@portatil ~]# /etc/rc.d/init.d/dhcpd restart <br />S'està aturant el servei dhcpd: [Incorrecte] <br />S'està iniciant el servei dhcpd: [ FET ] <br />[root@portatil ~]# service dhcpd reload <br />S'està aturant el servei dhcpd: [ FET ] <br />S'està iniciant el servei dhcpd: [ FET ] <br />Per saber les opcions possibles d’un servei es pot fer el truc:</p>
<p>[root@portatil ~]# service dhcpd patapum <br />Forma d'ús: /etc/init.d/dhcpd {start|stop|restart|condrestart|status} <br />[root@portatil ~]# /etc/rc.d/init.d/dhcpd pimpam <br />Forma d'ús: /etc/rc.d/init.d/dhcpd {start|stop|restart|condrestart|status}<br /> </p>
<p>Que un servei del sistema estigui engegat no significa que en arrancar de nou el sistema torni a estar engegat. Cal comprovar que sigui així o assegurar-se de definir-ho correctament. Els serveis (usualment dimonis executables) es poden configurar per arrancar automàticament en determinats nivells d’execució. Les màquines GNU/Linux tenen 7 nivells d’execució com es pot veure del fitxer /etc/inittab:</p>
<p>[root@portatil ~]# head -20 /etc/inittab <br />... output suprimit ...<br /># Default runlevel. The runlevels used by RHS are: <br /># 0 - halt (Do NOT set initdefault to this) <br /># 1 - Single user mode <br /># 2 - Multiuser, without NFS (The same as 3, if you do not have networking) <br /># 3 - Full multiuser mode <br /># 4 - unused <br /># 5 - X11 <br /># 6 - reboot (Do NOT set initdefault to this) <br /># ... output suprimit ...<br />Per configurar a quins nivells es vol que s’executi un servei s’utilitza l’ordre chkconfig, que permet activar/desactivar el servei pels nivells indicats. L’exemple següent mostra l’ús d’aquesta ordre, dóna la llista de l’estat actual del servei DHCP en tots els nivells i el configura per executar-se en els nivells 3, 4 i 5:</p>
<p>[root@portatil ~]# chkconfig --help <br />chkconfig versió 1.3.34 - Copyright (C) 1997-2000 Red Hat, Inc. <br />Aquest programari es pot distribuir lliurement d'acord amb els termes de la Llicència <br />Pública General GNU. <br />forma d'ús: chkconfig --list [nom] <br /> chkconfig --add &lt;nom&gt; <br /> chkconfig --del &lt;nom&gt; <br /> chkconfig --override &lt;nom&gt; <br /> chkconfig [--level &lt;nivells&gt;] &lt;nom&gt; &lt;on|off|reset|resetpriorities&gt; <br />[root@portatil ~]# chkconfig --list dhcpd <br />dhcpd 0:apagat 1:apagat 2:apagat 3:apagat 4:apagat 5:apagat 6:apagat<br />[root@portatil ~]# chkconfig --level 345 dhcpd on <br />[root@portatil ~]# chkconfig --list | grep dhcpd <br />dhcpd 0:apagat 1:apagat 2:apagat 3:engegat 4:engegat 5:engegat 6:apagat<br />Fixeu-vos que definir els nivells d’execució no significa que el servei estigui ara mateix engegat. Significa que quan arranqui el sistema de nou s’engegarà en els nivells corresponents. Podem ara estar al nivell 5 i tenir el servei aturat perquè encara no l’hem engegat. Per exemple:</p>
<p>[root@portatil ~]# runlevel <br />N 5 <br />[root@portatil ~]# service dhcpd status <br />dhcpd està aturat <br />[root@portatil ~]# service dhcpd start <br />S'està iniciant el servei dhcpd [ FET ]<br />Comprovació del funcionament bàsic<br /> </p>
<p>Comprovar que el servidor DHCP està en funcionament és un procés ben senzill, n’hi ha prou de comprovar que el servei està engegat. Això no vol dir, en cap cas, que el servei estigui funcionant correctament. Potser el servidor està engegat però no està correctament configurat. De fet, la configuració és la part realment important de l’administració d’un servei, i també del servei DHCP.</p>
<p>A part de comprovar l’estat del servei (amb l’opció status), l’administrador pot assegurar-se que el dimoni del servei està en execució buscant el seu PID (process identifier o indicador de número de procés). Una altra activitat a fer és monitorar el registre d’activitats del servei (els logs). Tot el trànsit DHCP és trànsit de xarxa TCP/IP; per tant també es pot observar l’estat dels ports i analitzar el trànsit que s’hi produeix.</p>
<p>Comprovació DHCP</p>
<p>L’administrador pot verificar el funcionament del servidor DHCP observant:</p>
<p>l’estat del servei (on, off)<br />el PID del servei (ha d’estar running).<br />el registre de logs.<br />monitorar el trànsit de xarxa amb una eina tipus wireshark.<br />l’estat dels ports.<br />Tot procés en el sistema té un identificador de procés. El PID dels serveis usualment es desen en el sistema de fitxers (al directori /var/run) en forma de fitxer que conté un valor numèric (en text) corresponent al PID del procés. Amb el servei en marxa sempre es pot observar el PID del servidor amb:</p>
<p>[root@portatil ~]# ps ax | grep dhcp <br /> 3610 ? Ss 0:00 /usr/sbin/dhcpd <br />[root@portatil ~]# service dhcpd status <br />dhcpd (pid 3610) s'està executant...<br />[root@portatil ~]# ll /var/run/dhcpd.pid <br />-rw-r--r-- 1 root root 5 29 jun 14:17 /var/run/dhcpd.pid <br />[root@portatil ~]# cat /var/run/dhcpd.pid <br />3610<br />Un cop iniciat el servei es crea un fitxer de bloqueig o lock amb el nom del servei per evitar iniciar-ne una altra instància. Els fitxers de lock usualment es troben a /var/lock i són un simple fitxer de text buit on la seva pròpia existència ja marca que el servei està en marxa. En parar el servei el fitxer s’elimina. Podem observar això fent:</p>
<p>[root@portatil ~]# cat /var/lock/subsys/dhcpd <br />[root@portatil ~]# ll /var/lock/subsys/dhcpd <br />-rw-r--r-- 1 root root 0 1 jun 18:26 /var/lock/subsys/dhhcpd<br />Tots els serveis del sistema normalment es monitoren anotant en fitxers de text un registre de totes les accions que realitzen, són els fitxers coneguts com a fitxers de log. Tant es pot utilitzar un fitxer genèric pel sistema com un fitxer independent per a un servei determinat. El servidor DHCP utilitza el fitxer de monitoratge estàndard /var/log/messages. En aquest fitxer s’enregistra cada cop que el servei s’engega i s’atura.</p>
<p>[root@portatil ~]# cat /var/log/messages | grep dhcp <br />Jun 29 14:16:53 portatil yum: Installed: dhcp - 12:3.0.5-42.fc7.i386 <br />Jun 29 14:17:33 portatil dhcpd: Internet Systems Consortium DHCP Server V3.0.5-RedHat <br />Jun 29 14:17:33 portatil dhcpd: Copyright 2004-2006 Internet Systems Consortium. <br />Jun 29 14:17:33 portatil dhcpd: All rights reserved. <br />Jun 29 14:17:33 portatil dhcpd: For info, please visit http://www.isc.org/sw/dhcp/ <br />Jun 29 14:17:33 portatil dhcpd: WARNING: Host declarations are global. They are not limited <br />to the scope you declared them in. <br />Jun 29 14:17:33 portatil dhcpd: Wrote 0 deleted host decls to leases file. <br />Jun 29 14:17:33 portatil dhcpd: Wrote 0 new dynamic host decls to leases file. <br />Jun 29 14:17:33 portatil dhcpd: Wrote 0 leases to leases file. <br />Jun 29 14:17:33 portatil dhcpd: Listening on LPF/eth0/00:17:31:15:80:7e/192.168.1/24 <br />Jun 29 14:17:33 portatil dhcpd: Sending on LPF/eth0/00:17:31:15:80:7e/192.168.1/24<br />El servei DHCP desa la informació de registre de les concessions que efectua en un fitxer de leasses. Això li permet seguir la pista de les adreces IP que ha concedit i ser coherent entre diverses arrancades del mateix servidor. Es pot observar aquest fitxer a /var/lib/dhcpd/dhcpd.leases:</p>
<p>[root@portatil ~]# ll /var/lib/dhcpd/dhcpd.leases <br />-rw-r--r-- 1 root root 473 29 jun 14:17 /var/lib/dhcpd/dhcpd.leases <br /> <br />[root@portatil ~]# cat /var/lib/dhcpd/dhcpd.leases <br /># All times in this file are in UTC (GMT), not your local timezone. This is <br /># not a bug, so please don't ask about it. There is no portable way to <br /># store leases in the local timezone, so please don't request this as a <br /># feature. If this is inconvenient or confusing to you, we sincerely <br /># apologize. Seriously, though - don't ask. <br /># The format of this file is documented in the dhcpd.leases(5) manual page. <br /># This lease file was written by isc-dhcp-V3.0.5-RedHat<br />lease 192.168.1.254 { <br /> starts 0 2008/06/29 16:03:41; <br /> ends 1 2008/06/30 04:03:41; <br /> binding state active; <br /> next binding state free; <br /> hardware ethernet 08:00:27:b2:8b:ec; <br /> client-hostname "box"; <br />}<br /> <br />lease 192.168.1.254 { <br /> starts 0 2008/06/29 16:19:30; <br /> ends 1 2008/06/30 04:19:30; <br /> binding state active; <br /> next binding state free; <br /> hardware ethernet 08:00:27:b2:8b:ec; <br /> client-hostname "box"; <br />}<br />Sovint l’administrador vol comprovar que els ports que utilitza el protocol DHCP estan oberts. En GNU/Linux es pot fer una llista fàcilment dels serveis associats a cada port mitjançant el fitxer /etc/services. Algunes utilitats com nmap permeten detectar els ports oberts. Per exemple podem fer:</p>
<p>Llista dels ports que inclouen alguna referència DHCP:<br />[root@portatil ~]# cat /etc/services | grep DHCP <br />bootpc 68/tcp dhcpc # BOOTP client <br />bootpc 68/udp dhcpc <br />dhcpv6-client 546/tcp <br />dhcpv6-client 546/udp <br />dhcpv6-server 547/tcp <br />dhcpv6-server 547/udp <br />dhcp-failover 647/tcp # DHCP Failover <br />dhcp-failover 647/udp # DHCP Failover <br />dhcp-failover2 847/tcp # dhcp-failover 2 <br />dhcp-failover2 847/udp # dhcp-failover 2 <br />qip-qdhcp 2490/tcp # qip_qdhcp <br />qip-qdhcp 2490/udp # qip_qdhcp <br />Si ens hi fixem veurem que de fet el protocol DHCP és anomenat BOOTP. Podem fer la llista de les entrades que corresponen a aquest protocol:</p>
<p>[root@portatil ~]# cat /etc/services | grep bootp <br />bootps 67/tcp # BOOTP server <br />bootps 67/udp <br />bootpc 68/tcp dhcpc # BOOTP client <br />bootpc 68/udp dhcpc <br />nuts_bootp 4133/tcp # NUTS Bootp Server <br />nuts_bootp 4133/udp # NUTS Bootp Server<br />Es pot observar que el port usat pel client DHCP és el port 68 (bootpc) i el port usat pel servidor és el port 67 (bootps).<br />Configuració DHCP<br />Per configurar el servei DHCP primer cal saber observar i manipular la configuració de xarxa existent, i això consisteix a saber:</p>
<p>Observar/fer la llista de la configuració de xarxa actual.<br />Comprovar l’estat del servei de xarxa.<br />Activar/desactivar el servei de xarxa.<br />Monitorar el servei i el procés del servidor.<br />Exemples de configuració</p>
<p>En GNU/Linux és molt usual que el paquet que proporciona un servei inclogui un fitxer d’exemple de configuració. El servei DHCP incorpora el fitxer d’exemple dhcpd..conf i la pàgina de manual del mateix nom.<br />Les tasques principals per configurar un servidor DHCP són les següents:</p>
<p>Instal·lar el programari del servidor DHCP.<br />Activar/desactivar el servei de DHCP.<br />Observar/fer la llista de la configuració actual del servidor DHCP.<br />Modificar la configuració del servidor DHCP.<br />Monitorar els logs del servei DHCP i els fitxers de registre de les concessions (leases).<br />Per tant, abans d’endinsar-nos en la configuració del servei és molt útil observar una configuració ja existent. Un exemple de fitxer de configuració del servei DHCP és el que es mostra a continuació:</p>
<p> </p>
<p># a) opcions globals del servidor DHCP (usuals)<br />ddns-update-style interim;<br />ignore client-updates;<br /># b) definició de la xarxa a la qual s'ofereix el servei DHCP<br />subnet 192.168.0.0 netmask 255.255.255.0 {<br /> # opcions genèriques per a tots els equips de la xarxa<br /> option routers 192.168.0.1;<br /> option subnet-mask 255.255.255.0;<br /> option domain-name "domain.org";<br /> option domain-name-servers 192.168.1.1;<br /> # definició de l'interval d'ips dinàmiques a usar <br /> # i dels temps de les concessions<br /> range dynamic-bootp 192.168.0.128 192.168.0.254;<br /> default-lease-time 21600;<br /> max-lease-time 43200;<br /> # c) Opcions d'equips individuals<br /> # el servidor ns obté sempre una adreça fixa basada en MAC<br /> host ns {<br /> next-server marvin.redhat.com;<br /> hardware ethernet 12:34:56:78:AB:CD;<br /> fixed-address 207.175.42.254;<br /> }<br />}<br />En aquest fitxer de configuració es pot veure que hi ha tres àmbits diferents de definició:</p>
<p>Opcions globals en el servidor DHCP. Són opcions que indiquen al servidor la seva manera d’actuar. També són opcions generals que cal aplicar a totes les concessions que es realitzin, independentment de la xarxa o equip que siguin.<br />Definicions i opcions de xarxa. Es defineixen tantes xarxes diferents com subxarxes ha d’atendre el servidor. Cada definició de subxarxa consta de la IP de la xarxa i la màscara corresponent. Entre claus s’indiquen totes les opcions específiques per a les concessions de les adreces IP corresponents a aquesta subxarxa. Una opció característica és indicar l’interval (o pool) d’adreces dinàmiques a usar, la porta d’enllaç predeterminada, el servidor de noms, etc.<br />Opcions d’equips individuals. Dins d’una subxarxa es poden definir opcions per a equips individuals. Cal identificar els equips per la seva adreça MAC i, entre claus, indicar les opcions que els són específiques. Això permet assignar adreces fixes dinàmicament (equivalent al protocol BOOTP) usant les opcions de maquinari Ethernet i fixed-address.<br />Les opcions globals de configuració DHCP es poden redefinir amb valors diferents dins d’un bloc de xarxa concret. Dins d’un equip també es poden definir opcions amb valors diferents als definits per la xarxa o globalment. Tal com passa en els llenguatges de programació preval el valor més intern, el de host sobre el de xarxa i el de xarxa per sobre del global.<br />Configuració bàsica<br />Per fer funcionar el servidor DHCP cal configurar-lo prèviament. Per poder arrancar li cal saber a quina xarxa donarà servei i quin és l’interval d’adreces IP que pot usar dinàmicament per a les concessions als clients.</p>
<p>El paquet DHCP conté un fitxer d’exemple al directori /user/share/doc/dhcp*/dhcpd.conf.sample. Aquest fitxer es pot copiar a /etc/dhcpd.conf i passarà a ser la configuració bàsica del servidor DHCP. Podem veure el seu contingut fent:</p>
<p>[root@portatil ~]# ll /usr/share/doc/dhcp-3.0.5/dhcpd.conf.sample <br />-rw-r--r-- 1 root root 852 12 nov 2007 /usr/share/doc/dhcp-3.0.5/dhcpd.conf.sample <br />[root@portatil ~]# cat /etc/dhcpd.conf <br /># <br /># DHCP Server Configuration file. <br /># see /usr/share/doc/dhcp*/dhcpd.conf.sample <br /># <br />#a) opcions globals<br />ddns-update-style interim; <br />ignore client-updates; <br /> <br />#b) opcions genèriques per a una subxarxa concreta<br />subnet 192.168.1.0 netmask 255.255.255.0 { <br /> # --- default gateway <br /> option routers 192.168.1.1; <br /> option subnet-mask 255.255.255.0; <br /> option nis-domain "domain.org"; <br /> option domain-name "domain.org"; <br /> option domain-name-servers 192.168.1.1; <br /> option time-offset -18000; # Eastern Standard Time <br /> range dynamic-bootp 192.168.1.128 192.168.1.254; <br /> default-lease-time 21600; <br /> max-lease-time 43200;<br /> <br /> #c) we want the nameserver to appear at a fixed address <br /> host ns { <br /> next-server marvin.redhat.com; <br /> hardware ethernet 12:34:56:78:AB:CD; <br /> fixed-address 207.175.42.254; <br /> }<br />}<br />En la configuració per defecte es poden analitzar els diversos elements que es configuren:</p>
<p>Opcions globals: indiquen al servidor que ignori les actualitzacions dels clients i el tipus de DDNS a usar (actualitzacions dinàmiques de DNS).<br />Definició de subxarxa: cal definir tants blocs de subxarxa com subxarxes atengui el servidor DHCP.<br />Opcions genèriques de subxarxa: per a una subxarxa es poden indicar opcions genèriques per als equips d’aquesta subxarxa. Evidentment poden diferir de les opcions d’altres subxarxes.<br />Les principals opcions de xarxa a descriure són el router, la màscara de xarxa, el domini, etc.<br />Les principals opcions a descriure del servei DHCP són definir l’interval d’adreces IP dinàmiques a usar pel servidor i el temps màxim de concessió d’aquestes adreces IP.<br />Per tal que un host determinat tingui sempre la mateixa adreça IP es poden fer entrades individualitzades per a hosts concrets. Els hosts s’identifiquen per la seva adreça MAC.<br />A un host concret (descrit en una entrada host) se li poden aplicar opcions individualitzades, com per exemple definir el seu nom. Les opcions individuals prevalen sobre les genèriques.<br />Configuració avançada<br />El protocol DHCP permet configuracions d’una certa complexitat. Podeu consultar la documentació de DHCP i les pàgines de manual del dimoni dhcpd i del fitxer de configuració dhcpd.conf.</p>
<p>Les principals característiques que s’hi descriuen són l’agrupació d’entrades en grups i classes i la possibilitat que el DHCP es comuniqui amb el DNS (actualitzacions DDNS) per crear entrades DNS quan un equip rep una configuració DHCP.</p>
<p>Un exemple de configuració amb opcions més avançades:</p>
<p>ddns-update-style interim; <br />ignore client-updates; <br /> <br />subnet 192.168.1.0 netmask 255.255.255.0 { <br /># --- default gateway<br /> <br />option routers 192.168.1.1; <br />option subnet-mask 255.255.255.0; <br /> <br />option nis-domain "domain.org"; <br />option domain-name "domain.org"; <br />option domain-name-servers192.168.1.1; <br />option time-offset-18000;# Eastern Standard Time <br /> <br />range dynamic-bootp 192.168.1.128 192.168.1.254; <br />default-lease-time 21600; <br />max-lease-time 43200; <br /> <br /> # we want the nameserver to appear at a fixed address <br /> host ns { <br /> next-server marvin.redhat.com; <br /> hardware ethernet 12:34:56:78:AB:CD; <br /> fixed-address 207.175.42.254; <br /> } <br /> <br /> group { <br /> filename "Xncd19r"; <br /> next-server ncd-booter; <br /> <br /> host ncd1 { hardware ethernet 0:c0:c3:49:2b:57; } <br /> host ncd4 { hardware ethernet 0:c0:c3:80:fc:32; } <br /> host ncd8 { hardware ethernet 0:c0:c3:22:46:81; } <br /> } <br />} <br /> <br />subnet 10.0.0.0 netmask 255.255.255.0 { <br /> option routers 10.0.0.254; <br /> # Unknown clients get this pool. <br /> pool { <br /> option domain-name-servers bogus.example.com; <br /> max-lease-time 300; <br /> range 10.0.0.200 10.0.0.253; <br /> allow unknown-clients; <br /> } <br /> <br /> # Known clients get this pool. <br /> pool { <br /> option domain-name-servers ns1.example.com, ns2.example.com; <br /> max-lease-time 28800; <br /> range 10.0.0.5 10.0.0.199; <br /> deny unknown-clients; <br /> } <br />}<br />Base de dades de concessions fetes pel servidor<br />El servidor desa en una base de dades local (de fet són fitxers de text) les concessions (leases) que realitza. D’aquesta manera en pot seguir la pista en tot moment. Generalment, les té a memòria (per permetre un accés més ràpid), però en manté una còpia a disc. Si, per exemple, el sistema o el servei es reinicia, pot saber quines són les concessions que encara estan actives (i per tant quines adreces IP no té disponibles).</p>
<p>Usualment el fitxer de concessions és a /var/lib/dhcpd. Podem veure’n el contingut fent:</p>
<p>[root@portatil ~]# cat /var/lib/dhcpd/dhcpd.leases <br /># All times in this file are in UTC (GMT), not your local timezone. This is <br /># not a bug, so please don't ask about it. There is no portable way to <br /># store leases in the local timezone, so please don't request this as a <br /># feature. If this is inconvenient or confusing to you, we sincerely <br /># apologize. Seriously, though - don't ask. <br /># The format of this file is documented in the dhcpd.leases(5) manual page. <br /># This lease file was written by isc-dhcp-V3.0.5-RedHat <br /> <br />lease 192.168.1.254 { <br /> starts 0 2008/06/29 16:03:41; <br /> ends 1 2008/06/30 04:03:41; <br /> binding state active; <br /> next binding state free; <br /> hardware ethernet 08:00:27:b2:8b:ec; <br /> client-hostname "box"; <br />} <br />lease 192.168.1.254 { <br /> starts 0 2008/06/29 16:19:30; <br /> ends 1 2008/06/30 04:19:30; <br /> binding state active; <br /> next binding state free; <br /> hardware ethernet 08:00:27:b2:8b:ec; <br /> client-hostname "box"; <br />} <br />lease 192.168.1.253 { <br /> starts 0 2008/06/29 16:27:16; <br /> ends 0 2008/06/29 22:27:16; <br /> binding state active; <br /> next binding state free; <br /> hardware ethernet 08:00:27:8e:72:de; <br />}<br />Opcions de configuració del servidor i àmbit d'aplicació<br />Les opcions de configuració DHCP són múltiples i comprenen molts àmbits. Algunes permeten compatibilitat amb sistemes antics, d’altres amb altres tipus de xarxes, etc. No és imaginable que un administrador de xarxes les conegui totes a fons. Normalment farà ús d’un conjunt reduït d’opcions que serà més que suficient per administrar la majoria de xarxes.</p>
<p>La configuració DHCP es pot definir tant al client com al servidor, tot i que usualment es farà en el servidor. Entenem com a tasca principal la de configurar un servidor per tal de proporcionar les opcions apropiades a cada subxarxa. De totes maneres, però, un client també pot disposar d’un fitxer de configuració on es defineixen quins són els seus requeriments i com ha de realitzar el diàleg amb el servidor. Per exemple es defineixen quines opcions ha de sol·licitar, valors per defecte a determinades opcions (per si el servidor no en proporciona un valor). El client també pot definir informació que proporcionarà al servidor per tal que aquest prengui decisions dinàmicament.</p>
<p>Podeu fer un repàs més extens de la configuració del servidor consultant la secció d’annexos del web d’aquest mòdul.<br />Caldrà, doncs, entendre quins són els àmbits (scope) de definició de sentències i opcions, com s’agrupen les subxarxes i els hosts, quines són les opcions globals, com es realitzen definicions condicionals i molts altres detalls.<br />Àmbit de definició<br />Els clients es poden agrupar en diversos àmbits per tal de definir les opcions que han de rebre. El mateix servidor DHCP pot actuar de manera diferent segons sigui l’àmbit de definició.</p>
<p>Alguns dels conceptes a tractar són:</p>
<p>Subnets.<br />Període de concessió.<br />Adreces fixes o reservades: identificació de host.<br />PXE: Protocol d’arrencada via xarxa.<br />Àmbit d’aplicació.<br />Pool.<br />Subnets<br />El servei DHCP permet fer assignació dinàmica d’adreces IP per diferents subxarxes sense que es requereixi un servidor específic per a cada subxarxa. Fins i tot el servei es pot oferir a xarxes “llunyanes”, és a dir, que han de creuar almenys un router per accedir al servidor. En aquest cas es parla del concepte DHCP Relaying.</p>
<p>Per oferir el servei a una subxarxa cal conèixer l’adreça de la xarxa i la seva màscara corresponent. Per cada subxarxa el servidor pot disposar d’un o més intervals d’adreces dinàmiques de les quals obtindrà l’adreça a concedir al client. Uns exemples bàsics poden ser:</p>
<p># subxarxa amb un interval d'adreces dinàmiques:<br />subnet 239.252.197.0 netmask 255.255.255.0 {<br /> range 239.252.197.10 239.252.197.250;<br />}<br /> <br /># subxarxa amb dos intervals d'adreces dinàmiques:<br />subnet 239.252.197.0 netmask 255.255.255.0 {<br /> range 239.252.197.10 239.252.197.107;<br /> range 239.252.197.113 239.252.197.250;<br />}<br />Període de concessió<br />Les concessions d’adreces s’efectuen per períodes de temps determinats. Un cop exhaurit aquest temps, cal procedir a renegociar la concessió (que es pot renovar o cancel·lar). De fet les concessions es poden efectuar per períodes des de zero segons a un temps infinit. El temps apropiat en cada cas dependrà del tipus de client i servei que s’ofereix; és diferent un client wireless a l’aeroport que l’estació de treball del supercap executiu de la corporació.</p>
<p>Des del punt de vista de la configuració del servidor es poden establir dos tipus de temps, el default-lease-time i el max-lease-time. El primer permet definir el temps màxim per defecte que es concedeix als clients quan aquests no han sol·licitat cap període de temps concret. El segon estableix el temps màxim de concessió en aquesta subxarxa. Podem veure un exemple d’aquestes opcions:</p>
<p># el temps màxim d'una concessió són 7200 segons, a cap client se li pot concedir més temps. Si el client no ha demanat cap temps concret, se li assigna una concessió de 600 segons.<br /> <br />subnet 239.252.197.0 netmask 255.255.255.0 {<br /> range 239.252.197.10 239.252.197.107;<br /> default-lease-time 600;<br /> max-lease-time 7200;<br />}<br />Els períodes de concessió es poden definir globalment per a totes les subxarxes a les quals es proporciona servei, però és més usual fer-ho per cada subxarxa quan aquestes tenen requeriments diferents.<br />Adreces reservades<br />A part de l’assignació dinàmica d’adreces d’interval el servidor DHCP també pot fer assignacions dinàmiques fixes. És a dir, assignar a un equip sempre la mateixa dreça IP. En aquest cas parlem d’adreça reservada. L’equip ‘consumeix’ aquesta adreça tant si està engegat com si està apagat. Per poder assignar a un host concret sempre la mateixa adreça cal identificar-lo de manera única i inequívoca. Això es pot fer mitjançant la seva adreça MAC. Un exemple pot ser:</p>
<p>host iocserver {<br /> hardware ethernet 08:00:2b:4c:59:23;<br /> fixed-address 239.252.197.9;<br />}<br />Es pot observar que l’opció hardware permet identificar el host iocserver a través de la seva adreça MAC.<br />PXE: protocol d'arrencada via xarxa<br />Molts sistemes i targetes de xarxa permeten arrencar clients de xarxa ‘tontos’. És a dir, equips que arranquen sense disposar de sistema operatiu i que el carreguen via xarxa. PXE és un protocol àmpliament utilitzar per a aquest fi. El client rep via DHCP el nom d’un fitxer que caldrà que descarregui via TFTP. Aquest fitxer acostuma a ser el sistema operatiu o el programari que ha de carregar per inicialitzar-se. L’opció DHCP que comunica el nom del fitxer a descarregar és l’opció filename.</p>
<p>host iocserver {<br /> hardware ethernet 08:00:2b:4c:59:23;<br /> fixed-address 239.252.197.9;<br /> filename "/tftpboot/kernel_ioc.boot";<br />}<br />En aquest exemple s’indica el fitxer kernel_ioc.boot per descarregar per TFTP si s’utilitza un protocol d’arrencada via xarxa com el PXE.<br />Opcions generals<br />El servei DHCP proveeix el client no només de l’adreça IP, màscara i gateway, sinó de molts altres paràmetres de configuració de xarxa. Alguns d’aquests paràmetres són molt usuals (DNS, routers, etc) i d’altres molt específics (rars fins i tot).</p>
<p>Tots aquests paràmetres es passen al client en forma d’options. Les opcions poden ser d’àmbit general (per a totes les subxarxes), d’àmbit per a una subxarxa i d’àmbit concret d’un sol host. L’ordre de precedència és de l’àmbit més concret al més general. Un exemple seria:</p>
<p>Per saber més de les opcions específiques es pot consultar la pàgina del manual dhcp-options(5) en un sistema GNU/Linux.<br />subnet 239.252.197.0 netmask 255.255.255.0 {<br /> range 239.252.197.10 239.252.197.250;<br /> default-lease-time 600<br /> max-lease-time 7200;<br /> option subnet-mask 255.255.255.0;<br /> option broadcast-address 239.252.197.255;<br /> option routers 239.252.197.1;<br /> option domain-name-servers 239.252.197.2, 239.252.197.3;<br /> option domain-name "isc.org";<br /> <br /> host iocserver {<br /> hardware ethernet 08:00:2b:4c:59:23;<br /> fixed-address 239.252.197.9;<br /> filename "/tftpboot/kernel_ioc.boot";<br /> option domain-name-servers 192.5.5.1;<br /> option domain-name "vix.com";<br /> }<br />}<br />En l’exemple anterior s’observa que es defineixen les opcions subnetmask, broadcast-address, routers, domain-name-servers i domain-name per a tots els equips de la subxarxa 239.252.197.0/24. Hi ha dues opcions, però, que es redefineixen amb valors diferents per al host iocserver. Són les opcions domain-name-servers i domain-name.<br />Àmbit d'aplicació: subnet<br />Les topologies de xarxa s’estructuren usualment en subxarxes, el mateix passa en la configuració del servidor DHCP. Usualment els clients s’agrupen en la subxarxa a la qual pertanyen. S’utilitza la sentència subnet per definir les opcions d’una subxarxa concreta. Si els clients de la subxarxa han de rebre adreces dinàmiques d’interval, cal com a mínim una sentència range.</p>
<p> </p>
<p>De vegades convé agrupar subxarxes diferents en un sol bloc d’opcions de configuració. Això passa per exemple quan una sola xarxa física que es vol tractar de la mateixa manera tota ella està dividida en dues subxarxes lògiques. La sentència shared-network s’utilitza en aquestes ocasions.</p>
<p>Les sentències d’àmbit d’aplicació més usuals són subnet i host, que permeten identificar una subxarxa i un host concret respectivament.</p>
<p>Les subxarxes es poden agrupar en shared-network, els clients es poden agrupar usant la sentència group.</p>
<p>Les opcions es poden definir en funció de determinats requisits que compleixi el client mitjançant la sentència class i les declaracions condicionals.<br />Quan els clients han de rebre una adreça IP dinàmica fixa, és a dir, han de rebre sempre la mateixa IP reservada, cal especificar la sentència host. Si es vol que tots els clients siguin únicament equips identificats cal fer una sentència host per a cada equip.</p>
<p>A vegades es vol establir configuracions que afecten equips i xarxes que no tenen una agrupació en forma de subxarxa clara. En aquests casos es pot optar per utilitzar la sentència group. Amb aquesta sentència es poden fer agrupacions d’elements diversos als quals se’ls assignen opcions comunes.</p>
<p>Una altra situació que es pot produir és voler agrupar clients segons determinades condicions que acompleixi el client (no únicament segons la seva MAC). La sentència class permet agrupar opcions segons la informació que envia el mateix client. A més a més, es poden utilitzar declaracions condicionals, és a dir, segons es compleixi o no una determinada condició aplicar unes declaracions o unes altres.</p>
<p>El següent és un exemple de l’esquema bàsic d’un fitxer de configuració dhcp:</p>
<p>#exemple extret de la pàgina de configuració del dhcpd.conf(5)<br /> global parameters...<br /> option domain-name "ioc.org";<br /> option domain-name-servers ns1.ioc.org, ns2.ioc.org;<br /> max-lease-time 7200;<br /> default-lease-time 600;<br /> subnet 204.254.239.0 netmask 255.255.255.224 {<br /> subnet-specific parameters...<br /> option routers 204.254.239.1;<br /> range 204.254.239.10 204.254.239.30;<br /> }<br /> subnet 204.254.239.32 netmask 255.255.255.224 {<br /> subnet-specific parameters...<br /> option routers 204.254.239.33;<br /> range 204.254.239.42 204.254.239.62;<br /> }<br /> subnet 204.254.239.64 netmask 255.255.255.224 {<br /> subnet-specific parameters...<br /> option routers 204.254.239.65;<br /> range 204.254.239.74 204.254.239.90;<br /> host grouxo {<br /> host-specific parameters...<br /> hardware ethernet 08:00:2b:4c:59:23;<br /> filename "/tftpboot/grouxo.img";<br /> fixed-address 204.254.239.91;<br /> }<br /> }<br /> group {<br /> group-specific parameters...<br /> option domain-name "marxbrothers.ioc.org";<br /> max-lease-time 120;<br /> host zappo.test.isc.org {<br /> host-specific parameters...<br /> }<br /> host harpo.test.isc.org {<br /> host-specific parameters...<br /> }<br /> }<br />En aquest exemple podem observar que:</p>
<p>es defineixen opcions globals per a totes les xarxes, com per exemple el nom del domini, els servidors de noms (DNS) i els temps de les concessions.<br />per a cada subxarxa es defineixen opcions específiques com poden ser per exemple l’interval d’adreces disponibles, el router de la subxarxa, etc. També es pot observar que en la subxarxa 204.254.239.64/27 es defineixen opcions particulars per al host grouxo. Concretament obté una adreça IP de l’interval fixa i un fitxer d’inicialització via TFTP.<br />finalment l’exemple mostra com es poden definir opcions per agrupacions amb la sentència group. Els hosts harpo i zappo estan agrupats i reben un nom de domini particular, diferent al definit en les opcions globals. També se’ls defineix un valor de temps màxim de concessió diferent al global.<br />Tot seguit es mostra un altre exemple d’estructura de configuració DHCP on s’agrupen hosts en grups d’afinitats:</p>
<p>#exemple extret de la pàgina de configuració del dhcpd.conf(5)<br /> group {<br /> filename "osOficines";<br /> next-server ncd-booter;<br /> host ncd1 { hardware ethernet 0:c0:c3:49:2b:57; }<br /> host ncd4 { hardware ethernet 0:c0:c3:80:fc:32; }<br /> host ncd8 { hardware ethernet 0:c0:c3:22:46:81; }<br /> }<br /> group {<br /> filename "osProfessorat";<br /> next-server ncd-booter;<br /> host ncd2 { hardware ethernet 0:c0:c3:88:2d:81; }<br /> host ncd3 { hardware ethernet 0:c0:c3:00:14:11; }<br /> }<br /> group {<br /> filename "osAlumnes";<br /> next-server alumni-booter;<br /> host ncd1 { hardware ethernet 0:c0:c3:11:90:23; }<br /> host ncd4 { hardware ethernet 0:c0:c3:91:a7:8; }<br /> ...output suprimt ...<br /> host ncd80 { hardware ethernet 0:c0:c3:cc:a:8f; }<br /> }<br />En aquest exemple s’han creat tres grups diferents segons si es tracta d’equips de les oficines, del professorat o dels alumnes. S’ha indicat individualment equip per equip mitjançant la sentència host. A cada grup se’ls assigna les opcions que els són comunes (en lloc de fer-ho repetidament dins de cada host). En aquest cas representa que els equips són terminals “ximples” que carreguen el sistema operatiu des de la xarxa. Cada grup carrega un sistema operatiu diferent. Oficines i professors el descarreguen del mateix servidor, mentre que els alumnes ho fan d’un altre anomenat alumni-booter.</p>
<p>Existeix un altre mecanisme per agrupar declaracions anomenat pool i que permet fer agrupacions d’adreces. Cada agrupació d’adreces o pool pot ser tractat de manera diferent. Es poden definir diferents pool dins d’una mateixa subxarxa (subnet). Possiblement, la millor manera d’entendre com funciona és mitjançant un exemple:</p>
<p>#exemple extret de la pàgina de configuració del dhcpd.conf(5)<br /> subnet 10.0.0.0 netmask 255.255.255.0 {<br /> option routers 10.0.0.254;<br /> # Unknown clients get this pool.<br /> pool {<br /> option domain-name-servers noexisteixo.com;<br /> max-lease-time 300;<br /> range 10.0.0.200 10.0.0.253;<br /> allow unknown-clients;<br /> }<br /># Known clients get this pool.<br /> pool {<br /> option domain-name-servers ns1.example.com, ns2.example.com;<br /> max-lease-time 28800;<br /> range 10.0.0.5 10.0.0.199;<br /> deny unknown-clients;<br /> }<br /> }<br />En aquest exemple la subxarxa 10.0.0.0/8 es divideix en dos pool d’adreces per ser tractats de manera diferent. En el primer s’assignen dinàmicament adreces IP de la 200 a la 253 i s’assigna també un servidor de noms inexistent. Seran clients d’aquest pool els equips que siguin no identificats (unknown-clients). En el segon pool s’accepten només clients coneguts, als quals s’assignen adreces IP de la 5 a la 199 i dos servidors de noms existents.</p>
<p>Polítiques d'accés</p>
<p>Per saber més de les polítiques d’accés es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux.<br />D’aquest exemple podem observar que la sentència pool permet establir polítiques d’accés (permit lists) definint quins clients poden accedir al pool i quins no. El tractament de les polítiques d’accés queda fora de l’abast d’aquest llibre, però és molt intuïtiu. La clàusula allow indica els clients amb accés i la clàusula deny els clients que no podran accedir al pool.<br />Class<br />Una de les eines més potents per agrupar clients és la sentència class. Els clients es poden tractar de manera diferent segons a quina classe pertanyin. Per determinar la classe del client es poden usar les dades que el mateix client proporciona. S’utilitzen sentències condicionals i tractament d’expressions (conditional, match statement) que s’avaluen per determinar si el client pertany o no a una classe. Per exemple es pot crear una classe amb tots aquells clients que contenen l’identificador “IOC”:</p>
<p>Classes</p>
<p>Per saber més de les classes es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux. Per saber com tractar i avaluar expressions es pot consultar el manual dhcp-eval(5) en un sistema GNU/Linux. Per saber més de les opcions específiques es pot consultar el manual dhcp-options(5) en un sistema GNU/Linux.<br />Les classes es poden subdividir en subclasses que corresponen a valors específics que satisfan l’expressió de la classe. El tractament de les classes, condicions i expressions queda fora de l’abast d’aquest material. Per conèixer bé les classes cal conèixer el tractament d’expressions i les opcions específiques del DHCP.<br />Sentències i opcions de configuració<br />El servei DHCP es pot configurar amb multitud de sentències que es poden repassar de l’RFC 2131 i de la pàgina de manual dhcpd.conf(5). Examinem tot seguit alguna d’aquestes sentències.<br />Declaracions<br />Include: include “filename”; Permet carregar el fitxer indicat i processar-lo com a fitxer de configuració. És una tècnica usual per dividir la configuració en mòduls.<br />Shared-network: shared-network name { [ parameters ] [ declarations ] } Permet agrupar diverses subxarxes (subnet) en una mateixa declaració. S’utilitza quan una mateixa xarxa física es compon de diverses subxarxes lògiques.<br />Subnet: subnet subnet-number netmask netmask { [ parameters ] [ declarations ] } Permet definir opcions per a una subxarxa concreta. És la sentència més usual en les definicions de configuració del servidor dhcp.<br />Range: range [ dynamic-bootp ] low-address [ high-address]; Indica l’interval d’adreces dinàmiques disponibles per assignar. El servidor DHCP extreu les adreces dinàmiques d’aquest interval d’adreces.<br />Host: host hostname { [ parameters ] [ declarations ] } Proporciona un àmbit de definició per a un equip concret. Les opcions que es defineixen dins d’una sentència host afecten únicament l’equip indicat. Es requereix una sentència host per poder fer assignacions dinàmiques fixes (assignar sempre la mateixa adreça IP basant-se en l’adreça MAC).<br />Group: group { [ parameters ] [ declarations ] } S’utilitza per agrupar declaracions de manera que les opcions definides afectin el grup d’elements que conté. Aquests poden ser shared-networks, subnets, hosts i fins i tot altres grups.<br />Paràmetres<br />Tot seguit es mostren alguns dels paràmetres que es poden definir en el servidor DHCP.</p>
<p>authoritative authoritative; not authoritative; Indica si les respostes del servidor DHCP són autoritatives o no. Si ho són el servidor revocarà les adreces IP que ell no ha concedit.<br />ddns-update-style ddns-update-style style; Pot ser ad-hoc o interim o none. Indica el tipus de dynamyc DNS que s’utilitza.<br />default-lease-time default-lease-time time; Indica el temps per defecte de les concessions. És el temps que es concedeix quan el client no requereix un període de temps concret.<br />fixed-address fixed-address address [, address … ]; Permet assignar una o més adreces IP a un client.<br />hardware hardware hardware-type hardware-address; Indica el tipus i el valor de l’adreça Mac d’un client. Aquest mecanisme és necessari per poder identificar un client de manera única, per exemple en una clàusula host.<br />max-lease-time max-lease-time time; Indica el temps màxim per a les concessions en segons.<br />min-lease-time min-lease-time time; Indica el temps mínim que han de durar les concessions.<br />next-server next-server server-name; Indica el nom o l’adreça IP del servidor TFTP del qual el client s’ha de descarregar el fitxer d’inicialització (o boot) indicat pel paràmetre filename. Si no s’indica s’utilitza el propi servidor DHCP.<br />Opcions de configuració<br />Els clients DHCP reben del servidor la configuració de xarxa. Usualment parlem de l’adreça IP i la màscara, però de fet poden rebre gran quantitat</p>
<p>de paràmetres de configuració de xarxa i informació sobre diversos serveis de xarxa disponibles. El client per la seva part pot sol·licitar paràmetres concrets al servidor. L’administrador de xarxa, quan configura el servei DHCP, no ha d’especificar totes les opcions possibles (de fet són moltíssimes), sinó només aquelles que siguin necessàries per a cada client. Algunes opcions prenen valors per defecte i no cal especificar-les, d’altres no poden ser alterades pel servidor.</p>
<p>En aquest apartat es farà la llista de la majoria de paràmetres que corresponen a opcions globals de configuració DHCP. Alguns paràmetres són indicats pel client, d’altres pel servidor i n’hi ha que són per defecte i no es poden modificar.</p>
<p>option bootfile-name bootfile-name text; Indica el nom del fitxer que el client s’ha de descarregar per tal d’iniciar el procés d’arrancada o boot. El fitxer es descarrega via TFTP del mateix servidor o de l’indicat amb l’opció next-server. Fa la mateixa funció que la sentència filename.<br />option dhcp-lease-time dhcp-lease-time uint32; Aquesta opció permet al client demanar al servidor la concessió per a un període concret de temps.<br />option dhcp-message-type dhcp-message-type uint8; Indica el tipus de missatge DHCP que s’està enviant, tant pel client com pel servidor. Els tipus possibles són:<br />DHCPDISCOVER<br />DHCPOFFER<br />DHCPREQUEST<br />DHCPDECLINE<br />DHCPACK<br />DHCPNAK<br />DHCPRELEASE<br />DHCPINFORM<br />option domain-name domain-name text; Indica el nom de domini que el client ha d’utilitzar per fer resolucions DNS.<br />option domain-name-servers domain-name-servers ip-address [, ip-address… ]; Especifica la llista de servidors de noms de domini que el client ha d’utilitzar.<br />option host-name host-name string; Especifica el nom del client.<br />option netbios-name-servers netbios-name-servers ip-address [, ip-address…]; L’opció NetBios name server (NBNS) especifica una llista de servidors RFC 1001/1002 NBNS name servers en ordre de preferència. És a dir, indica la llista de servidors NetBios a usar pel client.<br />option nis-servers nis-servers ip-address [, ip-address… ]; Especifica una llista de servidors NIS disponibles pel client.<br />option ntp-servers ntp-servers ip-address [, ip-address… ]; Indica una llista de servidors NTP disponibles pel client.<br />option routers routers ip-address [, ip-address… ]; Especifica una llista de routers disponibles pel client en la seva pròpia subxarxa.<br />option tftp-server-name tftp-server-name text; Indica el nom del servidor TFTP.<br />Expressions<br />Una de les grans potències que proporciona DHCP és poder configurar les opcions de xarxa en funció de qui i com és el client. És a dir, en funció de la informació que proporciona el client assignar-li una o altra configuració de xarxa. Fixeu-vos que no es tracta d’entrades host estàtiques per a cada client, sinó que un mateix client tindrà una o altra configuració segons la informació que proporcioni.</p>
<p>Avaluar expressions</p>
<p>Per obtenir més informació sobre expressions DHCP i mecanismes d’avaluació cal consultar la pàgina de manual dhcp.eval(5) en un sistema GNU/Linux.<br />Per poder fer això cal poder avaluar expressions i condicions basades en la informació del mateix client. Existeix, doncs, tot un llenguatge per escriure expressions i avaluar-les.</p>
<p>El mecanisme per definir expressions és:</p>
<p>paràmetre = expressió ;<br />Un exemple que mostra com definir el paràmetre ddns-hostname (que defineix el nom del client a usar en l’actualització dinàmica de DNS) usant part de l’adreça MAC del client:</p>
<p>ddns-hostname = binary-to-ascii (16, 8, "-", substring (hardware, 1, 6));<br />Es poden construir expressions similars a les dels llenguatges de programació. Per fer-ho es disposa d’estructures condicionals i de diversos tipus d’operadors. Anem a analitzar-ne uns quants:</p>
<p>Estructures condicionals (Conditional behaviour). Permeten realitzar definicions segons sigui el valor d’una opció (o d’una expressió). Utilitza les conegudes estructures if, elsif i else.<br />#Exemple de sentència condicional en el servidor<br />#Extret de la pàgina de manual dhcpd.eval(5)<br /> if option dhcp-user-class = "accounting" {<br /> max-lease-time 17600;<br /> option domain-name "accounting.example.org";<br /> option domain-name-servers ns1.accounting.example.org,<br /> ns2.accounting.example.org;<br /> } elsif option dhcp-user-class = "sales" {<br /> max-lease-time 17600;<br /> option domain-name "sales.example.org";<br /> option domain-name-servers ns1.sales.example.org,<br /> ns2.sales.example.org;<br /> } elsif option dhcp-user-class = "engineering" {<br /> max-lease-time 17600;<br /> option domain-name "engineering.example.org";<br /> option domain-name-servers ns1.engineering.example.org,<br /> ns2.engineering.example.org;<br /> } else {<br /> max-lease-time 600;<br /> option domain-name "misc.example.org";<br /> option domain-name-servers ns1.misc.example.org,<br /> ns2.misc.example.org;<br /> }<br />En aquest exemple es defineixen les opcions max-lease-time, domain-name i domain-name-servers de manera diferent segons sigui el valor de l’opció dhcp-user-class enviat pel client.</p>
<p>Les definicions condicionals també es poden fer en la part client. L’exemple següent mostra que si el client no ha rebut el paràmetre domain-name, ell mateix autodefineix el valor del paràmetre domain-name-servers al loopback.<br />Exemple de sentència condicional en el servidor</p>
<p> </p>
<p>#Extret de la pàgina de manual dhcpd.eval(5)<br />if not option domain-name = "example.org" {<br /> prepend domain-name-servers 127.0.0.1;<br />}<br />Expressions booleanes (Boolean expressions). Igual que passa en els llenguatges de programació, permeten definir expressions utilitzant els operadors booleans clàssics: =, and, or, not, exists. També els operadors known i static.<br />Expressions de tractament de text (Data expressions). Són similars a les típiques funcions de tractament de cadenes dels llenguatges de programació. Corresponen a: substring, suffix, option, config-option, hardware, packet, concat, reverse, leased-address, binary-to-ascii,encode-int, pick-first-value i host-decl-name.<br />Expressions numèriques (Numeric expressions). Les expressions numèriques realitzen la seva avaluació retornant un enter. Són exemples d’aquesta categoria: extract-int, lease-time i client-state.<br />Monitoratge (Logging). Es permeten definir expressions que s’enregistraran en els fitxers de monitoratge del sistema. És molt útil si es treballa amb definicions condicionals i expressions perquè permet fer un seguiment (com un debug) de com s’ha avaluat l’expressió o la condició.<br />#Exemple de log<br />#log (priority, data-expr) <br />#Les prioritats poden ser: fatal, error, info, debug<br />log (info, concat(hardware, hostname)<br />Aquest exemple generarà una entrada en el fitxer de log mostrant l’adreça Mac del client i el seu nom de host.<br />Actualitzacions DNS dinàmiques (dynamic DNS updates). El servei DHCP pot interactuar amb el servei DNS de manera que les concessions DHCP s’actualitzin automàticament en la base de dades DNS. Aquesta funció la poden fer tant els clients com els servidors DHCP. Quan parlem d’actualitzacions dinàmiques del DNS estem parlant de DDNS (dynamic domain name system). Com cal fer aquestes actualitzacions i quina informació cal posar al DNS és el que es pot personalitzar amb aquestes opcions.<br />Per saber més de les actualitzacions dinàmiques de DNS consulteu l’RFC 2136.<br />Configuració dels paràmetres de xarxa del client<br />Els clients de xarxa o bé tenen una configuració estàtica on es defineix cada paràmetre en el client o bé reben la configuració via DHCP. El procés de configurar un client DHCP és tan senzill com activar aquesta última opció usant algun dels mètodes adients.</p>
<p>La configuració dels clients DHCP consisteix en el següent:</p>
<p>Observar la configuració de xarxa actual del client.<br />Configurar el client per rebre dinàmicament una adreça IP. Es tracta d’activar/desactivar la configuració de xarxa dinàmica o estàtica.<br />Sol·licitar/renegociar una nova IP al servidor DHCP.<br />Observar/fer la llista del fitxer de registre de les concessions client rebudes.<br />Activar/desactivar el servei de xarxa en el client.<br />Observar la configuració de xarxa actual<br />L’administrador ha de tenir la precaució d’observar quina és la configuració de xarxa actual abans d’establir-ne una de nova. Si cal ha de deixar anotada la configuració anterior per tal de poder restablir-la. La configuració de xarxa bàsica consisteix en l’adreça IP, la màscara de xarxa, la porta d’enllaç per defecte i el servidor DNS a utilitzar. També s’hi pot incloure el nom de l’equip, les rutes i multitud d’altres paràmetres.</p>
<p>Es pot fer la llista de la configuració de les interfícies ethernet i observar les adreces IP, l’estat de les interfícies (UP o DOWN) i les rutes definides fent:</p>
<p>Fer la llista de les adreces MAC i IP i les dades de les interfícies</p>
<p>[root@pc]# ip address show<br />1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue <br /> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br /> inet 127.0.0.1/8 scope host lo<br /> inet6 ::1/128 scope host <br /> valid_lft forever preferred_lft forever<br />2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000<br /> link/ether 00:17:31:15:80:7e brd ff:ff:ff:ff:ff:ff<br /> inet 192.168.1.34/24 brd 192.168.1.255 scope global eth0<br /> inet6 fe80::217:31ff:fe15:807e/64 scope link <br /> valid_lft forever preferred_lft forever<br />3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop <br /> link/sit 0.0.0.0 brd 0.0.0.0<br />Fer la llista de les rutes definides en el host:</p>
<p>[root@pc]# ip route show<br />192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.34 <br />169.254.0.0/16 dev eth0 scope link <br />default via 192.168.1.1 dev eth0<br />Si s’observen els fitxers de configuració de les interfícies de xarxa, es pot veure si els paràmetres de xarxa estan definits estàticament o dinàmicament. En la llista següent es pot veure que la interfície loopback es configura estàticament i la interfície eth0 es configura via DHCP:</p>
<p>[root@portatil ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0 <br />DEVICE=eth0 <br />ONBOOT=yes <br />BOOTPROTO=dhcp <br />TYPE=Ethernet<br /> <br />[root@portatil ~]# cat /etc/sysconfig/network-scripts/ifcfg-lo<br />DEVICE=lo <br />IPADDR=127.0.0.1<br />NETMASK=255.0.0.0 <br />NETWORK=127.0.0.0 <br /># If you're having problems with gated making 127.0.0.0/8 a martian, <br /># you can change this to something else (255.255.255.255, for example) <br />BROADCAST=127.255.255.255 <br />ONBOOT=yes <br />NAME=loopback<br />Un error usual és creure que el servei DHCP no funciona correctament quan de fet el que passa és que el client no té el servei de xarxa activat. Es pot comprovar l’estat del servei de xarxa fent:</p>
<p>[root@portatil ~]# service NetworkManager status <br />[root@portatil ~]# service network status <br />Dispositius configurats: <br />lo eth0<br />Dispositius actius actualment: <br />lo eth0<br /> <br />Activar i desactivar el servei de xarxa:<br />[root@pc]# /etc/init.d/network stop<br />S'està aturant la interficie eth0: [ FET ]<br />S'està aturant la interficie loopback: [ FET ]<br /> <br />[root@pc]# /etc/init.d/network start<br />S'està activant la interficie loopback: [ FET ]<br />S'està activant la interficie eth0: <br />S'està determinant la informació de la IP per a eth0... fet [FET]<br />Configurar el client com a client dinàmic<br />Tot equip client de xarxa necessita una configuració apropiada. Si aquesta configuració es defineix element per element en el mateix equip, s’anomena configuració estàtica. Si és així, no cal per res un servidor DHCP. És quan els clients reben la configuració de xarxa externament que parlem de configuració dinàmica i ens cal un servidor DHCP que la proporcioni.</p>
<p>La configuració del client es pot fer en mode text editant directament els fitxers de configuració de les interfícies de xarxa, utilitzant interfícies en mode text o utilitzant interfícies gràfiques (applets). Vegem cada un d’aquests mètodes.<br />Editar els fitxers de configuració<br />Es pot editar directament el fitxer de configuració de la interfície pertinent i establir l’opció BOOTPROTO al valor dhcp per tal d’activar el client DHCP. Si per exemple es configura la interfície eth0 seria un fitxer similar al següent:</p>
<p>[root@portatil ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0 <br />DEVICE=eth0 <br />ONBOOT=yes <br />BOOTPROTO=dhcp <br />TYPE=Ethernet<br />Menús amb interfície de text<br />Un altre mecanisme per activar el client DHCP és utilitzar alguna utilitat de menús en entorn de text (varien segons el sistema i n’hi ha de disponibles per Internet).</p>
<p>Una eina força utilitzada és la utilitat setup que es pot observar en la figura.2, que mostra una configuració de client de xarxa estàtica i es pot veure que la casella que permet activar el client DHCP està desactivada.</p>
<p> </p>
<p>Figura Configuració estàtica del client DHCP<br /> <br /> <br />Observeu que senzill que és el procediment per activar el client de xarxa DHCP. N’hi ha prou d’activar l’opció pertinent, tal com es mostra en la figura.3.</p>
<p> </p>
<p>Figura Activació del client DHCP usant menús de text<br /> <br /> <br />Menús en mode gràfic<br />En mode gràfic el sistema també proporciona mecanismes per configurar les interfícies de xarxa i establir el mode d’activació a DHCP. En la figura.4 es pot observar que la configuració de la interfície eth0 té activada l’opció per rebre la configuració de xarxa via DHCP.</p>
<p> </p>
<p>Figura Activació del client DHCP usant l’entorn gràfic<br /> <br /> <br />Demanar una nova adreça IP<br />El client DHCP pot alliberar l’adreça que utilitza quan ho creu pertinent. En fer-ho el servidor anota el fi de la concessió i si es tracta d’una adreça dinàmica d’interval aquesta torna a estar disponible per assignar-la a un altre client. Quan a un client se li està acabant el temps de la concessió ha de tornar a negociar una adreça amb el servidor. De totes maneres si el client vol, pot tornar a sol·licitar-ne una en un moment o altre.</p>
<p>El client pot alliberar una adreça (release) que està en ús un moment o altre, pot forçar-ho fent, per exemple:</p>
<p>[root@portatil ~]# dhclient -r <br />Internet Systems Consortium DHCP Client V3.0.5-RedHat <br />Copyright 2004-2006 Internet Systems Consortium. <br />All rights reserved. <br />For info, please visit http://www.isc.org/sw/dhcp/ <br />Listening on LPF/eth0/00:17:31:15:80:7e <br />Sending on LPF/eth0/00:17:31:15:80:7e <br />DHCPRELEASE on eth0 to 192.168.1.1 port 67<br />Per forçar el client a demanar una nova adreça per a la interfície ethernet eth0 es pot fer:</p>
<p>[root@portatil ~]# dhclient eth0 <br />Internet Systems Consortium DHCP Client V3.0.5-RedHat <br />Copyright 2004-2006 Internet Systems Consortium. <br />All rights reserved. <br />For info, please visit http://www.isc.org/sw/dhcp/ <br />Listening on LPF/eth0/00:17:31:15:80:7e <br />Sending on LPF/eth0/00:17:31:15:80:7e <br />Sending on Socket/fallback <br />DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 5 <br />DHCPOFFER from 192.168.1.1 <br />DHCPREQUEST on eth0 to 255.255.255.255 port 67 <br />DHCPACK from 192.168.1.1 <br />bound to 192.168.1.34 -- renewal in 38975 seconds.<br />Observar el registre client de les concessions rebudes<br />El client DHCP porta un registre de les concessions rebudes, d’aquesta manera pot tornar a demanar una concessió abans que expiri l’actual. També pot servir per demanar al servidor preferentment una adreça IP concreta. Les concessions o leases del client es desen en un fitxer anomenat /var/lib/dhclient/dhclient.leases. Podem veure’n el contingut fent:</p>
<p>[root@pc]# cat /var/lib/dhclient/dhclient.leases <br />lease {<br /> interface "eth0";<br /> fixed-address 192.168.1.34;<br /> option subnet-mask 255.255.255.0;<br /> option routers 192.168.1.1;<br /> option dhcp-lease-time 86400;<br /> option dhcp-message-type 5;<br /> option domain-name-servers 80.58.61.250,80.58.61.254;<br /> option dhcp-server-identifier 192.168.1.1;<br /> option domain-name "local.lan";<br /> renew 3 2007/12/19 04:05:49;<br /> rebind 3 2007/12/19 15:12:57;<br /> expire 3 2007/12/19 18:12:57;<br />Comprovació del funcionament DHCP<br />La millor manera de comprovar el funcionament DHCP és simplement posant-lo en pràctica, és a dir, crear una xarxa amb diversos clients DHCP i un servidor que els atengui. Com es pot saber si funciona? Fàcil, mirant un a un cada client i comprovant que han rebut la configuració de xarxa correcta. El problema, però, és què fem si els clients no es configuren correctament.</p>
<p>Els passos més usuals a seguir per a la resolució de problemes són:</p>
<p>Comprovar que la xarxa està correctament connectada físicament, és a dir cables, connectors, interfícies, etc.<br />Mirar si existeix connectivitat entre els equips, per exemple usant una configuració estàtica. Això permetrà descartar que els problemes siguin deguts a altres causes. Si el DHCP no va és que no està configurat correctament.<br />Repassar la configuració del client i del servidor DHCP, especialment la del servidor. Es pot començar fent la configuració tan senzilla com sigui possible. Un cop funciona es pot anar avançant en la seva complexitat.<br />Examinar els fitxers de concessions, tant el del client com el del servidor, per detectar-hi anomalies.<br />Quan la comunicació client/servidor no funciona correctament i no sabem el perquè és molt útil monitorar el trànsit de xarxa mitjançant alguna eina d’anàlisi dels paquets que viatgen per la xarxa.<br />Centrem-nos, doncs, en la monitoratge del trànsit de xarxa per tal d’analitzar que el diàleg entre el client i el servidor és l’apropiat. Existeixen moltes eines al mercat (que podeu trobar per Internet) que fan aquesta funció. Un de les més recomanables és l’aplicació wireshark. Amb aquesta eina hem de poder observar l’intercanvi dels paquets DHCP Discover, DHCP Offer, DHCP Request i DHCP Ack que es produeix quan tot el procés DHCP funciona correctament. Si aquest intercanvi no es produeix és que existeix algun problema.</p>
<p>En l’apartat “El model funcional del protocol DHCP” podeu observar detalladament com és el diàleg entre el client i el servidor.<br />En l’apartat “Demanar una nova adreça IP” es pot observar com forçar el client a demanar una nova configuració.<br />En la figura.5 podeu observar una captura de trànsit DHCP feta amb Wireshark. La captura s’ha fet al servidor i el client s’ha forçat a demanar de nou una configuració de xarxa amb la utilitat dhclient.</p>
<p> </p>
<p>Figura Captura d’un diàleg DHCP client/servidor<br /> <br /> <br />Podeu manipular vosaltres mateixos la captura del trànsit de xarxa DNS carregant el fitxer de captura del wireshark que es lliura com a material complementari. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.<br />A continuació es pot observar la llista de text de les quatre trames capturades amb el wireshark que s’han exportat en format text. Això permet veure detalladament tot el diàleg DHCP.</p>
<p>No. Time Source Destination Protocol Info<br /> 1 0.000000 0.0.0.0 255.255.255.255 DHCP DHCP Discover - <br />Transaction ID 0x8a1327b2<br /> <br />Frame 1 (590 bytes on wire, 590 bytes captured)<br />Ethernet II, Src: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec), Dst: Broadcast (ff:ff:ff:ff:ff:ff)<br />Internet Protocol, Src: 0.0.0.0 (0.0.0.0), Dst: 255.255.255.255 (255.255.255.255)<br />User Datagram Protocol, Src Port: bootpc (68), Dst Port: bootps (67)<br />Bootstrap Protocol<br /> Message type: Boot Request (1)<br /> Hardware type: Ethernet<br /> Hardware address length: 6<br /> Hops: 0<br /> Transaction ID: 0x8a1327b2<br /> Seconds elapsed: 0<br /> Bootp flags: 0x0000 (Unicast)<br /> Client IP address: 0.0.0.0 (0.0.0.0)<br /> Your (client) IP address: 0.0.0.0 (0.0.0.0)<br /> Next server IP address: 0.0.0.0 (0.0.0.0)<br /> Relay agent IP address: 0.0.0.0 (0.0.0.0)<br /> Client MAC address: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec)<br /> Server host name not given<br /> Boot file name not given<br /> Option: (t=53,l=1) DHCP Message Type = DHCP Discover<br /> Option: (t=57,l=2) Maximum DHCP Message Size = 548<br /> Option: (t=55,l=11) Parameter Request List<br /> Option: (t=12,l=4) Host Name = "box"<br /> Option: (t=51,l=4) IP Address Lease Time = 12 hours<br /> End Option<br /> Padding<br /> <br />No. Time Source Destination Protocol Info<br /> 2 0.000351 192.168.1.34 192.168.1.254 DHCP DHCP Offer - <br />Transaction ID 0x8a1327b2<br /> <br />Frame 2 (342 bytes on wire, 342 bytes captured)<br />Ethernet II, Src: AsustekC_15:80:7e (00:17:31:15:80:7e), Dst: CadmusCo_b2:8b:ec <br />(08:00:27:b2:8b:ec)<br />Internet Protocol, Src: 192.168.1.34 (192.168.1.34), Dst: 192.168.1.254 (192.168.1.254)<br />User Datagram Protocol, Src Port: bootps (67), Dst Port: bootpc (68)<br />Bootstrap Protocol<br /> Message type: Boot Reply (2)<br /> Hardware type: Ethernet<br /> Hardware address length: 6<br /> Hops: 0<br /> Transaction ID: 0x8a1327b2<br /> Seconds elapsed: 0<br /> Bootp flags: 0x0000 (Unicast)<br /> Client IP address: 0.0.0.0 (0.0.0.0)<br /> Your (client) IP address: 192.168.1.254 (192.168.1.254)<br /> Next server IP address: 0.0.0.0 (0.0.0.0)<br /> Relay agent IP address: 0.0.0.0 (0.0.0.0)<br /> Client MAC address: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec)<br /> Server host name not given<br /> Boot file name not given<br /> Option: (t=53,l=1) DHCP Message Type = DHCP Offer<br /> Option: (t=54,l=4) Server Identifier = 192.168.1.34<br /> Option: (t=51,l=4) IP Address Lease Time = 12 hours<br /> Option: (t=1,l=4) Subnet Mask = 255.255.255.0<br /> Option: (t=3,l=4) Router = 192.168.1.1<br /> Option: (t=6,l=4) Domain Name Server = 192.168.1.1<br /> Option: (t=15,l=11) Domain Name = "domain.org"<br /> End Option<br /> Padding<br /> <br />No. Time Source Destination Protocol Info<br /> 3 0.009004 0.0.0.0 255.255.255.255 DHCP DHCP Request - <br />Transaction ID 0x8b1327b2<br /> <br />Frame 3 (590 bytes on wire, 590 bytes captured)<br />Ethernet II, Src: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec), Dst: Broadcast (ff:ff:ff:ff:ff:ff)<br />Internet Protocol, Src: 0.0.0.0 (0.0.0.0), Dst: 255.255.255.255 (255.255.255.255)<br />User Datagram Protocol, Src Port: bootpc (68), Dst Port: bootps (67)<br />Bootstrap Protocol<br /> Message type: Boot Request (1)<br /> Hardware type: Ethernet<br /> Hardware address length: 6<br /> Hops: 0<br /> Transaction ID: 0x8b1327b2<br /> Seconds elapsed: 0<br /> Bootp flags: 0x0000 (Unicast)<br /> Client IP address: 0.0.0.0 (0.0.0.0)<br /> Your (client) IP address: 0.0.0.0 (0.0.0.0)<br /> Next server IP address: 0.0.0.0 (0.0.0.0)<br /> Relay agent IP address: 0.0.0.0 (0.0.0.0)<br /> Client MAC address: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec)<br /> Server host name not given<br /> Boot file name not given<br /> Option: (t=53,l=1) DHCP Message Type = DHCP Request<br /> Option: (t=57,l=2) Maximum DHCP Message Size = 548<br /> Option: (t=55,l=11) Parameter Request List<br /> Option: (t=12,l=4) Host Name = "box"<br /> Option: (t=51,l=4) IP Address Lease Time = 12 hours<br /> Option: (t=54,l=4) Server Identifier = 192.168.1.34<br /> Option: (t=50,l=4) Requested IP Address = 192.168.1.254<br /> End Option<br /> Padding<br /> <br />No. Time Source Destination Protocol Info<br /> 4 0.010712 192.168.1.1 255.255.255.255 DHCP DHCP NAK - <br />Transaction ID 0x8b1327b2<br /> <br />Frame 4 (342 bytes on wire, 342 bytes captured)<br />Ethernet II, Src: XaviTech_7b:ff:1d (00:01:38:7b:ff:1d), Dst: Broadcast (ff:ff:ff:ff:ff:ff)<br />Internet Protocol, Src: 192.168.1.1 (192.168.1.1), Dst: 255.255.255.255 (255.255.255.255)<br />User Datagram Protocol, Src Port: bootps (67), Dst Port: bootpc (68)<br />Bootstrap Protocol<br /> Message type: Boot Reply (2)<br /> Hardware type: Ethernet<br /> Hardware address length: 6<br /> Hops: 0<br /> Transaction ID: 0x8b1327b2<br /> Seconds elapsed: 0<br /> Bootp flags: 0x8000 (Broadcast)<br /> Client IP address: 0.0.0.0 (0.0.0.0)<br /> Your (client) IP address: 0.0.0.0 (0.0.0.0)<br /> Next server IP address: 192.168.1.1 (192.168.1.1)<br /> Relay agent IP address: 0.0.0.0 (0.0.0.0)<br /> Client MAC address: CadmusCo_b2:8b:ec (08:00:27:b2:8b:ec)<br /> Server host name not given<br /> Boot file name not given<br /> Option: (t=53,l=1) DHCP Message Type = DHCP NAK<br /> Option: (t=56,l=31) Message = "requested address not available"<br /> End Option<br /> Padding<br />Realitzar documentació de suport a l'usuari<br />Una de les facetes més ignorades en el camp de la informàtica és la confecció de manuals i documentació de suport. Com a clients molt sovint ens queixem que falta informació o que està mal redactada. Com a administradors de xarxa no trobem mai temps per anotar les coses. Mentre les tenim al cap no creiem necessari fer la documentació, quan no ho tenim al cap, ja ens és impossible fer-ho, i sovint, és just quan en faria falta haver-ho fet! Fem un repàs de la informació necessària que cal documentar, tant per a l’usuari com per a l’administrador.</p>
<p>Un altre exemple de captura DHCP es lliura com a material complementari. En aquesta captura hi ha dos servidors dhcp diferents en la xarxa i es poden observar paquets NACK. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.<br />El client ha de saber:</p>
<p>Com contactar amb el servidor DHCP. Quin programari ha d’utilitzar i com l’ha de configurar per fer ús del servei.<br />Quina és la informació que s’obtindrà via DHCP. Cal saber visualitzar, consultar aquesta informació i saber què significa, per a què serveix.<br />Així doncs, la documentació de l’usuari descriurà el procés per activar el client DHCP, amb captures de pantalla que facilitin aquest procés. Cal també exemples de llista de concessions rebudes, on són i com es poden consultar aquestes concessions. La part més important és mostrar un exemple de configuració de xarxa rebuda on es detalli el significat de cada element i explicar a l’usuari com fer aquesta consulta.</p>
<p>Un exemple d’informació a proporcionar podria ser el següent:</p>
<p>L'usuari pot consultar la concessió de xarxa amb l'ordre:<br />C:\&gt;ifconfig /all<br />Configuración IP de Windows<br /> Nombre del host . . . . . . . . . : nombre-29b9943f<br /> Sufijo DNS principal . . . . . . : <br /> Tipo de nodo. . . . . . . . . . . : híbrido<br /> Enrutamiento habilitado. . . . . .: No<br /> Proxy WINS habilitado. . . . . : No<br /> Lista de búsqueda de sufijo DNS: local.lan</p>
<p>Adaptador Ethernet Conexiones de red inalámbricas :<br /> Estado de los medios. . . .: medios desconectados<br /> Descripción. . . . . . . . . . . : Intel(R) PRO/Wireless 3945ABG Net Connection<br /> Dirección física. . . . . . . . . : 00-31-02-44-9F-5A</p>
<p>Adaptador Ethernet Conexión de área local :<br /> Sufijo de conexión específica DNS : local.lan<br /> Descripción. . . . . . . . . . . : Realtek RTL8168/8111 PCI-E Gigabit Ether NIC<br /> Dirección física. . . . . . . . . : 00-21-32-80-23-7D<br /> DHCP habilitado. . . . . . . . . : No<br /> Autoconfiguración habilitada. . . : Sí<br /> Dirección IP. . . . . . . . . . . : 192.168.1.33<br /> Máscara de subred . . . . . . . . : 255.255.255.0<br /> Puerta de enlace predeterminada : 192.168.1.1<br /> Servidor DHCP . . . . . . . . . . : 192.168.1.1<br /> Servidores DNS . . . . . . . . . .: 80.58.61.250<br /> 80.58.61.254<br /> Concesión obtenida . . . . . . . : jueves, 24 de septiembre de 2009 12:09:16<br /> Concesión expira . . . . . . . . .: jueves, 24 de septiembre de 2009 13:09:16<br />Els principals valors de xarxa a destacar són: Adreça IP, màscara de xarxa, el router o porta d’enllaç predeterminada, el servidor dhcp amb el qual s’ha contactat, els servidors de noms DNS que s’utilitzen i quan expira la concessió.</p>
<h1><a id="instal_lacio_de_serveis_de_configuracio_dinamica_de_sistemes"></a>Instal·lació de serveis de configuració dinàmica de sistemes</h1>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">DHCP</p>
<p><em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></em> és l’acrònim de <em>dynamic host configuration protocol</em>, en català, protocol de configuració dinàmica d’equips.</p>
</div>
</div>
<p>El servei <strong><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></strong> permet la configuració d’adreces IP, màscares, passarel·les per defecte i moltes altres opcions de configuració de manera totalment dinàmica.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Què fa el DHCP?</p>
<p>Una forma planera d’entendre el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten “que hi ha algú?”, “qui sóc jo?”. El servidor de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.</p>
</div>
</div>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Identificació dels equips de xarxa</p>
<p>L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.</p>
<p>Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina feixuga i repetitiva si no es disposa de serveis de xarxa que la facilitin.</p>
</div>
</div>
<h2><a id="el_servei_dhcp"></a>El servei DHCP</h2>
<div class="level2">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-se.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Avantatges DHCP</p>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> té diversos avantatges:</p>
<ul>
<li class="level1">
<div class="li">Evita errors i conflictes IP.</div>
</li>
<li class="level1">
<div class="li">Centralitza l’administració.</div>
</li>
<li class="level1">
<div class="li">Estalvia temps.</div>
</li>
<li class="level1">
<div class="li">Simplifica l’administració.</div>
</li>
</ul>
</div>
</div>
<p>Els principals avantatges d’utilitzar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són: d’una banda, evitar conflictes d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>; i, d’altra banda, poder fer l’administració centralitzada representa un estalvi de temps i de feina.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> simplifica l’administració de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.</p>
</div>
</div>
<p>La concessió dinàmica d’adreces IP i altres paràmetres de configuració de xarxa es realitza per a un període de temps determinat, que varia en funció de les necessitats del client i del servidor.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Exemples d'ús del servei DHCP</p>
<p>Els següents són alguns exemples d’ús del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li">En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduït, per exemple, minuts.</div>
</li>
<li class="level1">
<div class="li">Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (<acronym title="Internet Service Provider">ISP</acronym>) tindrà una concessió que segurament serà per hores.</div>
</li>
<li class="level1">
<div class="li">En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, els equips rebran concessions dinàmiques per períodes de temps molt llargs, per exemple, dies.</div>
</li>
</ul>
</div>
</div>
</div>
<h3><a id="configuracio_d_un_equip_de_xarxa"></a>Configuració d'un equip de xarxa</h3>
<div class="level3">
<p>Qualsevol equip que pertany a una xarxa requereix que es configuri amb uns paràmetres mínims, que són l’adreça IP, la màscara i la porta d’enllaç per defecte. L’adreça IP identifica l’equip de manera única, i la màscara permet determinar la xarxa o subxarxa en què es troba l’equip. Amb aquests dos paràmetres n’hi ha prou per tenir connectivitat en la xarxa. Si es vol disposar d’accés fora de la xarxa pròpia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir també la porta d’enllaç predeterminada. A part de la configuració bàsica, els equips poden necessitar (i de fet ho necessiten) més paràmetres de configuració com, per exemple: el nom del <em>host</em>, el servidor <acronym title="Domain Name System">DNS</acronym>, el fitxer d’iniciació a baixar, etc.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Tot equip de xarxa necessita disposar d’una <strong>adreça IP</strong> que l’identifica de manera única a la xarxa. Cal també una <strong>màscara</strong> per poder separar de l’adreça IP quina és la part d’<strong>adreça de xarxa</strong> i quina la part d’<strong>adreça de host</strong>. Finalment, és imprescindible disposar de l’adreça de la <strong>porta d’enllaç predeterminada</strong> o passarel·la per defecte (o <em>gateway</em>), per disposar d’accés a xarxes externes.</p>
</div>
</div>
<div class="iocexample">
<div class="ioccontent">
<p class="ioctitle">Exemple de configuració de xarxa d'un equip de casa:</p>
<p>La majoria d’usuaris disposen a casa d’un equip (o més) connectats a un router que proporciona l’accés a Internet. Aquest equip està configurat com a client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i en iniciar-se rep la configuració de xarxa del router. Podeu comprovar a casa quina configuració teniu. Una configuració d’exemple podria ser:</p>
<pre class="code">Dirección IP. . . . . . . . . . . : 192.168.1.33
Máscara de subred . . . . . . . . : 255.255.255.0
Puerta de enlace predeterminada   : 192.168.1.1
Servidor DHCP . . . . . . . . . . : 192.168.1.1
Servidores DNS . . . . . . . . . .: 80.58.61.250
                                    80.58.61.254</pre>
</div>
</div>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">L'inconvenient de la configuració estàtica</p>
<p>La configuració estàtica implica configurar els equips un a un. Fins i tot encara que es tingui accés remot als equips (per Telnet o <acronym title="Secure Shell">SSH</acronym>), com que cal modificar la configuració de xarxa no es pot fer assegut des de l’equip de l’administrador, sinó que cal anar equip per equip a modificar la configuració.</p>
</div>
</div>
<p>Aquest procés de configuració cal que es faci per a cada equip de la xarxa. Fer-lo manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les màscares. Qualsevol canvi en l’estructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. És evident que tota aquesta feinada no és agradable per a l’administrador de xarxa (i és molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una solució que permeti automatitzar la configuració de xarxa de cada equip de manera centralitzada.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Les opcions de configuració de xarxa es poden assignar a cada equip <strong>estàticament</strong> o es poden configurar de manera <strong>dinàmica</strong> utilitzant <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
</div>
<p>Com a administradors de xarxa, la gestió centralitzada que ens proporciona <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ens permet modificar la xarxa afegint, eliminant i redefinint, equips amb un cost mínim.</p>
</div>
<h3><a id="tipus_d_assignacions_d_adreces_ip"></a>Tipus d'assignacions d'adreces IP</h3>
<div class="level3">
<p>Cada equip de xarxa té assignada una adreça IP que l’identifica de manera única dins la xarxa. La composició de l’adreça IP i la màscara determina la xarxa o subxarxa a la qual pertany. A més a més, es configuren altres paràmetres de xarxa com la porta d’enllaç predeterminada, servidors <acronym title="Domain Name System">DNS</acronym>, etc. Això es pot configurar manualment anant equip per equip i introduint aquesta informació.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Reconfiguració d'una xarxa</p>
<p>Imagineu la diversió de l’administrador d’una xarxa corporativa de 1.000 equips amb adreces estàtiques quan cal reconfigurar-la en un cap de setmana!</p>
</div>
</div>
<div class="iocimportant">
<div class="ioccontent">
<p>Quan l’adreça IP i els altres paràmetres necessaris de configuració de la xarxa es configuren equip per equip, manualment, es diu que tenen <strong>IP estàtica</strong>.</p>
</div>
</div>
<p>Quan la configuració de xarxa d’un equip no es fa manualment i localment en l’equip sinó que es rep per mitjà d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, es diu que l’equip utilitza una <strong>IP dinàmica</strong>. Per realitzar configuracions de xarxa dinàmicament caldran un o més servidors de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (a manera de redundància) que proporcionaran la configuració als equips clients (els que cal configurar). Per tant, serà una estructura client-servidor. Les adreces IP dinàmiques que rep el client les podem classificar en dues categories: <strong>assignació dinàmica d’interval</strong> i <strong>assignació fixa</strong>.</p>
<p>El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> disposa d’un interval d’adreces que pot assignar als clients que demanen una adreça IP. Quan el servidor assigna una adreça qualsevol de l’interval al client (a l’atzar) es tracta d’una assignació dinàmica d’interval. El client no sap quina adreça IP tindrà i no hi ha manera de predir quina adreça se li concedirà en una futura configuració. A cada nova assignació l’adreça IP pot ser diferent.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">MAC</p>
<p>Cada interfície de xarxa s’identifica de manera única físicament per l’adreça MAC (<em>media acces control</em>, adreça d’accés al medi).</p>
</div>
</div>
<p>Una assignació fixa es produeix quan el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sempre assigna la mateixa adreça al client. Per assignar sempre la mateixa adreça IP al client</p>
<p>cal que el servidor pugui identificar inequívocament el client (per l’adreça MAC). El servidor disposa d’una taula amb les correspondències entre les adreces MAC i les adreces IP fixes.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Quan la configuració de xarxa d’un equip es rep per mitjà d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es diu que utilitza una adreça IP <strong>dinàmica</strong>. Aquesta adreça pot variar dins d’un <strong>interval</strong> d’adreces disponibles per al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> o pot ser <strong>fixa</strong>.</p>
</div>
</div>
<p>Els avantatges de disposar d’una IP fixa són que la vostra identificació a Internet (la vostra adreça IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips, els clients us identifiquen sempre amb la mateixa adreça sense haver de recordar en cada moment quina adreça IP teniu avui (com passa en el cas d’una IP dinàmica).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">DNS dinàmic</p>
<p>Hi ha serveis de <acronym title="Domain Name System">DNS</acronym> dinàmic (DDNS) que permeten assignar un nom de domini a equips amb adreça IP dinàmica.</p>
</div>
</div>
</div>
<h2><a id="el_protocol_dhcp_i_els_seus_components"></a>El protocol DHCP i els seus components</h2>
<div class="level2">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ve descrit, com la majoria de protocols de xarxa, per un document <em>oficial</em> anomenat <acronym title="Request for Comments">RFC</acronym>. Al llarg dels anys ha sofert diverses evolucions per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diàleg entre els equips que hi intervenen, ens caldrà doncs analitzar quin és i com es produeix aquest diàleg. Finalment es descriurà el significat de termes tan usuals en <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> com <em>intervals</em>, <em>exclusions</em>, <em>concessions</em> i <em>reserves</em>.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Què són els RFC?</p>
<p>Els Request for Comments (<acronym title="Request for Comments">RFC</acronym>) són memoràndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies d’Internet. Quan els publica l’IETF (Internet Engineering Task Force) defineixen a escala mundial els protocols i les seves revisions. És a dir, són les publicacions oficials que descriuen els protocols.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>Per trobar especificacions dels protocols d’Internet, vegeu la secció “Més informació” del web d’aquest mòdul.</p>
</div>
</div>
</div>
<h3><a id="evolucio_del_protocol_dhcp"></a>Evolució del protocol DHCP</h3>
<div class="level3">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un servei del tipus client-servidor que proporciona la configuració de xarxa als clients que ho sol·liciten. Proporciona els paràmetres bàsics de xarxa com l’adreça IP, la màscara de xarxa, la porta d’enllaç i també d’altres paràmetres necessaris per a una connexió en una xarxa IP. Es tracta d’un protocol de la capa d’aplicació del model TCP/IP.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està basat en l’arquitectura de serveis client-servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>L’<acronym title="Request for Comments">RFC</acronym> 951 és el document base que descriu el protocol BOOTP.</p>
</div>
</div>
<p>La configuració dinàmica d’equips de xarxa es va iniciar amb el protocol BOOTP (BOOT <em>strap protocol</em>, protocol d’arrencada). Un protocol més bàsic que principalment permetia definir l’adreça IP, la màscara de xarxa i la passarel·la per defecte per al client. El protocol BOOTP (<acronym title="Request for Comments">RFC</acronym> 951, any 1985) és un protocol pensat per proporcionar automàticament la IP a clients de xarxa en el procés d’arrencada. Originàriament s’utilitzava per a estacions de treball sense disc que obtenien la configuració de xarxa del protocol BOOTP i també obtenien el nom d’un fitxer d’arrencada que s’havia de baixar per mitjà del TFTP, que usualment era el sistema operatiu.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">RFC de DHCP</p>
<p>Principals <acronym title="Request for Comments">RFC</acronym> dedicades a <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 2131. Març 1997. <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>dynamic host configuration protocol</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 2132. <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>options</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 3396. <em>Encoding long options</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 4361. <em>No especific client identifications for dhcpv4.</em></div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 3315. DHCPv6 <em>dinamic host configuration protocol</em> <em>Ipv6.</em></div>
</li>
</ul>
</div>
</div>
<p>El BOOTP va donar pas al protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, que n’és una evolució amb moltes més prestacions. El <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sorgeix l’octubre del 1993 a través de l’<acronym title="Request for Comments">RFC</acronym> 1531. Ràpidament evoluciona per mitjà de diverses <acronym title="Request for Comments">RFC</acronym>, com l’<acronym title="Request for Comments">RFC</acronym> 1541 el mateix any 1993, que serà substituïda per l’<acronym title="Request for Comments">RFC</acronym> 2131 el març del 1997. Aquest document és la base del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> actual. A grans trets, el protocol es descriu en l’<acronym title="Request for Comments">RFC</acronym> 2131 per a xarxes Ipv4, el conjunt d’opcions de configuració de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es descriuen en l’<acronym title="Request for Comments">RFC</acronym> 2132, i l’especificació de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a xarxes Ipv6 és en l’<acronym title="Request for Comments">RFC</acronym> 3315.</p>
</div>
<h3><a id="el_model_funcional_del_protocol_dhcp"></a>El model funcional del protocol DHCP</h3>
<div class="level3">
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Ports DHCP</p>
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza UDP en la capa de transport. Utilitza dos ports:</p>
<ul>
<li class="level1">
<div class="li">Port 67, on escolta el servidor.</div>
</li>
<li class="level1">
<div class="li">Port 68, on escolta el client.</div>
</li>
</ul>
</div>
</div>
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> descriu el diàleg que es produeix entre client i servidor per a la concessió de configuracions IP. En una xarxa amb configuració d’equips dinàmica, un o més servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> escoltaran les peticions dels clients en el port 67. Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sol·licitaran al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> una configuració IP, i començarà un procés de negociació que ha d’acabar (si tot va bé) amb la concessió d’una adreça IP al client. Els servidors parlen al port 68 dels clients.</p>
<p>La negociació que s’estableix es pot definir a grans trets de la manera següent:</p>
<ol>
<li class="level1">
<div class="li">El client sol·licita una adreça IP (de fet, una configuració de xarxa).</div>
</li>
<li class="level1">
<div class="li">El servidor mira les adreces IP disponibles dins de l’interval d’adreces dinàmiques de què disposa per concedir i n’ofereix una al client.</div>
</li>
<li class="level1">
<div class="li">Si el client l’accepta, envia una sol·licitud al servidor per fer-la seva.</div>
</li>
<li class="level1">
<div class="li">Si al servidor li sembla bé, accepta la petició del client i li confirma que pot utilitzar aquesta IP, que la hi concedeix per un període de temps limitat.</div>
</li>
</ol>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">UDP en les transmissions DHCP</p>
<p>L’intercanvi d’informació entre client i servidor no és gaire gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). És per això que el protocol que s’utilitza en les transmissions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és l’UDP.</p>
</div>
</div>
<p>La concessió de l’adreça IP és per un període de temps establert pel servidor. Això significa que, transcorregut aquest període, el client haurà de renegociar la concessió en un procés similar al descrit anteriorment. En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura1"><span>figura</span>.1</a></span> es pot veure el diàleg de quatre fases client-servidor.</p>
<p>El procés real, però, és més detallat. El podem repassar: consta principalment de quatre parts: la petició del client o <em>discovery</em>, l’oferta del servidor o <em>offer</em>, l’acceptació de l’adreça IP pel client o <em>request</em>, i la confirmació del servidor o <em>acknowledgement</em>. A part d’aquest tipus de missatges, el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en defineix d’altres com el de petició d’informació o <em>information</em> i el d’alliberament de l’adreça IP o <em>releasing</em>.</p>
<div class="iocfigure"><a name="Figura1"></a>
<p></p>
<figure>
<figcaption style="width: 355px; max-width: 75%;"><span class="figuretitle">Figura</span> Model funcional del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im1.png" alt="" /></figure>
<p></p>
</div>
<p>Els següents són els tipus de paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discover</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>ack</em> / <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>nack</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>decline</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>release</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em>.</div>
</li>
</ul>
</div>
<h4><a id="dhcp_discover"></a>DHCP discover</h4>
<div class="level4">
<p>En un procés de configuració IP d’un client de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> el paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discover</em> és el primer que s’envia. L’envia el client per tal de demanar una configuració IP a algun servidor. Generalment, el client s’acaba d’inicialitzar i vol obtenir una configuració dinàmica de xarxa. El client no sap a quina xarxa pertany (no té adreça IP ni màscara de xarxa) i tampoc sap quins servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> hi ha en la xarxa (si n’hi ha cap).</p>
<div class="iocnote">
<div class="ioccontent">
<p>Una difusió o broadcast s’adreça a la IP 255.255.255.255 o a l’adreça MAC FF:FF:FF:FF, que és acceptada per tots els equips.</p>
</div>
</div>
<p>Per tant, el client genera un paquet de difusió (<em>broadcast</em>) destinat a tots els equips de la xarxa on sol·licita una configuració IP. En la xarxa pot haver-hi cap, un o més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per atendre aquesta petició. És responsabilitat de l’administrador de xarxes configurar correctament l’estructura i els serveis de xarxa de forma que si defineix clients de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> hi hagi servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que atenguin les seves peticions.</p>
</div>
<h4><a id="dhcp_offer"></a>DHCP offer</h4>
<div class="level4">
<p>En rebre una sol·licitud de configuració d’un client (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>), un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> mira d’atendre-la proporcionant una IP de l’interval d’adreces dinàmiques que gestiona (hi pot haver més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en la mateixa xarxa).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Diversos servidors DHCP</p>
<p>Es pot configurar més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, tant per a còpia de seguretat o <em>backup</em> com per incrementar el rendiment en compartir la càrrega de les peticions.</p>
</div>
</div>
<p>El servidor tracta d’assignar una IP del conjunt o interval (també anomenat <em>pool</em>) d’adreces dinàmiques que gestiona. Per fer-ho, ha de mirar quines de les adreces li queden lliures i disponibles per concedir al client. Cada vegada que el servidor concedeix una IP a un client, ho anota en un fitxer de registre de les concessions efectuades. Cada vegada que finalitza una concessió, el servidor pot tornar a utilitzar la IP per a un altre client.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Tota <strong>concessió</strong> (o <em>lease</em>) <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és per un període determinat de temps i un cop transcorregut cal renovar-la.</p>
</div>
</div>
<p>El mecanisme que utilitza el servidor per escollir la IP dins del conjunt d’adreces IP disponibles varia en funció del programa de servidor que s’utilitzi. A més a més es poden configurar innumerables opcions del servidor per establir com s’han de fer les concessions. Un cas típic és el de les adreces fixes. A un determinat client sempre se li assigna la mateixa IP. Per això cal disposar de la llista d’adreces MAC dels clients als quals es vol assignar una IP fixa.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Tipus d'adreçament</p>
<p>Hi ha diversos tipus d’adreçament:</p>
<ul>
<li class="level1">
<div class="li">Unidestinació o <em>unicast</em>: a un equip</div>
</li>
<li class="level1">
<div class="li">Multidestinació <em>multicast</em>: a un conjunt d’equips</div>
</li>
<li class="level1">
<div class="li">De difusió o <em>broadcast</em>: a tothom.</div>
</li>
</ul>
</div>
</div>
<p>El servidor selecciona una IP disponible i la reserva per al client (encara no està assignada). Tot seguit envia un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em> (unidestinació o <em>unicast</em>) al client amb tota la informació de configuració requerida. L’adreça IP i MAC origen identifiquen el servidor que fa l’oferta. El destinatari s’indica per la seva adreça MAC (que és coneguda). El camp IP del destinatari és l’adreça IP que el servidor ofereix (penseu que el client encara no té IP). Un altre concepte important és per quant de temps es realitza la concessió. El paquet inclou més camps per completar la resta de configuració de xarxa, per exemple, la porta d’enllaç per defecte, els servidors <acronym title="Domain Name System">DNS</acronym>, etc.</p>
</div>
<h4><a id="dhcp_request"></a>DHCP request</h4>
<div class="level4">
<p>Quan el client rep una oferta de configuració IP per part d’un servidor, la pot acceptar o rebutjar. Si el client no accepta l’oferta, simplement realitzarà un <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em> de nou. Això és suficient perquè el servidor s’adoni que l’oferta ha estat rebutjada.</p>
<p>Si el client accepta l’oferta, ho ha de comunicar al servidor. El mecanisme per fer-ho és mitjançant un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em> enviat un altre cop per difusió. A hores d’ara, el client encara no disposa de l’adreça IP per utilitzar-la. El servidor l’ha reservat, però encara no ha donat el sí definitiu perquè sigui concedida al client.</p>
<p>El motiu pel qual el client demana quedar-se la concessió (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>) que ha rebut utilitzant difusió és fer públic a tothom de la xarxa que ha acceptat una oferta d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> concret. Recordeu que la petició del client es fa per difusió i, per tant, pot rebre ofertes de diferents servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pública quina oferta accepta, la resta de servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> entenen que la seva oferta s’ha rebutjat.</p>
</div>
<h4><a id="dhcp_ack_dhcp_nack"></a>DHCP ack/DHCP nack</h4>
<div class="level4">
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">ACK i NACK</p>
<p>ACK i NACK són dos acrònims usuals en el món de la informàtica que signifiquen confirmació (acceptació) i no-conformitat (refús) respectivament.</p>
</div>
</div>
<p>L’últim pas en una negociació <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> bàsica el realitza el servidor quan finalment autoritza la concessió enviant el paquet DHCPACK (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>akcnowledgement</em>). A partir d’aquest moment, el client sí pot fer ús de l’adreça IP i de la configuració de xarxa rebuda. DHCPACK inclou tota la informació referent a la durada de la concessió i les dades necessàries per gestionar quan expira.</p>
<p>El servidor anotarà en el registre de concessions la que acaba de realitzar i detallarà tots els aspectes d’aquesta, en especial el temps de concessió. El paquet d’acceptació de la concessió DHCPACK és un paquet unidestinació adreçat a la MAC del client. Recordeu que el client encara no disposa d’una adreça IP vàlida, en disposarà en rebre el DHCPACK.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Exemple de mala configuració d'un equip</p>
<p>Un exemple de mala configuració és la d’un equip que s’ha engegat amb una adreça IP estàtica errònia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si l’adreça IP ja està essent utilitzada és fer un ping. Si ningú no respon és que està lliure (segurament).</p>
</div>
</div>
<p>Quan un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> detecta que la IP que havia reservat per a un client i que li anava a concedir ja està en ús, el servidor envia al client un paquet DHCPNACK i indica la no-autorització de la concessió. El client que rep un DHCPNACK ha de tornar a iniciar tot el procés de negociació començant un altre cop pel <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>.</p>
<p>Com és possible que algun equip de la xarxa utilitzi una adreça IP que forma part del conjunt d’adreces IP dinàmiques que reparteix el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>? La resposta és senzilla: perquè hi ha algun equip mal configurat.</p>
</div>
<h4><a id="dhcp_decline"></a>DHCP decline</h4>
<div class="level4">
<p>Per la seva part, el client també pot examinar l’adreça IP oferta pel servidor per comprovar si està en ús o no. Pot fer altres proves per veure si li sembla correcta o no l’oferta rebuda del servidor. Per exemple, en el cas de renovació d’una IP el client pot rebre una IP diferent a la que utilitza i no li interessa. En aquests casos, el client pot enviar un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>decline</em> al servidor per indicar que la seva oferta ha estat rebutjada.</p>
</div>
<h4><a id="dhcp_release"></a>DHCP release</h4>
<div class="level4">
<p>Quan un client ja no necessita més l’ús de la configuració IP que ha rebut, la pot alliberar enviant al servidor un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>release</em>. En fer-ho, el servidor afegeix l’adreça IP al conjunt d’adreces dinàmiques que té disponibles. També fa l’anotació pertinent en el registre de concessions (<em>leases</em>) per indicar que ha finalitzat l’ús de l’adreça. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquè és apagat per l’usuari sense deixar temps al sistema per alliberar la IP.</p>
</div>
<h4><a id="dhcp_information"></a>DHCP information</h4>
<div class="level4">
<p>En tot moment el client pot sol·licitar més informació sobre la configuració de xarxa al servidor utilitzant un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em>. En el paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em> que el servidor envia al client, consten les informacions generals de configuració de xarxa que es trameten en l’oferta: adreça IP, màscara de xarxa, porta d’enllaç predeterminada, servidor <acronym title="Domain Name System">DNS</acronym>, fitxer a baixar i molts altres paràmetres que poden estar configurats per enviar-se en l’oferta. El client pot tornar a demanar al servidor la informació d’aquests paràmetres o pot sol·licitar informació per a la configuració d’altres paràmetres (WINS, NetBIOS, <em>hostname</em>, etc.). El client només pot realitzar una petició d’informació <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em> al servidor un cop ja està configurat.</p>
</div>
<h4><a id="peticio_de_renovacio_concessio_d_una_ip_concreta"></a>Petició de renovació/concessió d'una IP concreta</h4>
<div class="level4">
<p>El procés de quatre fases usuals de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> consistent en <em>discovery/offer/request/ack</em> es produeix quan el client sol·licita una IP de nou. Sabem que les concessions són per a un interval de temps passat, la renovació de la qual cal que el client la demani. Existeix, doncs, un procés de renovació simplificat. El client demana continuar usant la mateixa IP amb un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>, i el servidor li concedeix o no amb els paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ACK/NACK.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Macchange</p>
<p>L’ordre GNU permet (<em>mascarade</em>) emmascarar l’adreça MAC pròpia. Compte! No feu dolenteries.</p>
</div>
</div>
<p>Un altre cas és un client que demana usar (renovar) una adreça IP que el servidor no li pot concedir (està en ús, no és de l’interval que gestiona, etc.). En aquesta situació, el servidor envia un <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> NACK.</p>
</div>
<h3><a id="atacs_al_funcionament_de_dhcp_i_conflictes_d_adreces_ip"></a>Atacs al funcionament de DHCP i conflictes d'adreces IP</h3>
<div class="level3">
<p>vei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em> fingint que són clients diferents (emmascarant la seva MAC) amb la intenció d’esgotar les adreces IP disponibles del servidor o simplement amb la intenció de sobrecarregar-lo amb tantes peticions que no doni a l’abast a atendre-les o que ho faci lentament.</p>
<p>Un altre tipus d’atac consisteix a falsejar la informació que s’envia al client. Recordem que el client fa una sol·licitud d’IP en forma de difusió (<em>broadcast</em>) i la seva petició pot ser atesa per un o més servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Un dels servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot ser un atacant que intentarà proporcionar informació de configuració falsa al client. Per exemple indicant un servidor <acronym title="Domain Name System">DNS</acronym> també maliciós. Aquest pot falsejar les identitats de les màquines de la xarxa i, quan el client s’adreça a la seva entitat bancària, el servidor <acronym title="Domain Name System">DNS</acronym> en realitat li ha proporcionat una IP d’una màquina que falseja la de l’entitat bancària. Perillós, oi?</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Tipus d'atacs DNS</p>
<p>Clients no autoritzats: accés a servidors <acronym title="Domain Name System">DNS</acronym> per part de clients no autoritzats. Servidors no autoritzats: servidors <acronym title="Domain Name System">DNS</acronym> impostors que suplanten els vertaders servidors.</p>
</div>
</div>
<p></p>
<p>Per posar remei a la inseguretat en la comunicació client-servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, el protocol permet utilitzar mecanismes d’autenticació i xifratge. Aquests mecanismes queden fora de l’abast d’aquesta explicació.</p>
</div>
<h4><a id="conflictes_amb_les_adreces_ip"></a>Conflictes amb les adreces IP</h4>
<div class="level4">
<p>Un dels principals motius per utilitzar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és simplificar el procés de configuració de xarxa i minimitzar els conflictes per encavalcament d’adreces IP. Per desgràcia, això no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en què dues màquines diferents tinguin la mateixa IP per una simple mala configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Un altre cas típic és el d’un client que s’ha configurat ell mateix una IP estàtica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreça IP assignada pel servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Un problema habitual per als administradors poc experimentats és definir una configuració de xarxa local al client (<em>hostname</em>, servidor <acronym title="Domain Name System">DNS</acronym>, porta d’enllaç a utilitzar, etc.), però demanar l’adreça IP dinàmicament. La configuració dinàmica no és solament la IP i la màscara, sinó que el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot proporcionar altres paràmetres de xarxa que sobreescriuran els que el client tenia definits localment (aquest és l’objectiu de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>!).</p>
<div class="iocreference">
<div class="ioccontent">
<p>La configuració rebuda per <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sobreescriu la configuració local del client.</p>
</div>
</div>
</div>
<h3><a id="intervals_exclusions_concessions_i_reserves"></a>Intervals, exclusions, concessions i reserves</h3>
<div class="level3">
<p>Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> obtenen del servidor una configuració de xarxa. Descrivim ara alguns dels termes que tenen lloc durant aquest procés, i que formen part de la configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ul>
<li class="level1">
<div class="li"><strong>Interval</strong>: anomenen <em>interval d’adreces IP</em> el conjunt d’adreces dinàmiques que el servidor té disponibles per assignar als clients. Les adreces IP disponibles s’agrupen per oferir-se a les diverses subxarxes que atén el servidor. Una mateixa subxarxa pot disposar de diversos intervals. Segurament s’entendrà més fàcilment amb un exemple:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
              range 140.220.191.150 140.220.191.249;
            }

  subnet 239.252.197.0 netmask 255.255.255.0 {
              range 239.252.197.10 239.252.197.107;
              range 239.252.197.113 239.252.197.250;
            }</pre>
<div class="iocimportant">
<div class="ioccontent">
<p>En l’exemple anterior s’observa que la primera subxarxa disposa d’un interval de 100 adreces dinàmiques (de la 140.220.191.150 al 250). La segona subxarxa permet assignar dinàmicament dos intervals d’adreces no correlatius.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Exclusions</strong>: entenem per <em>exclusions</em> aquelles adreces IP que no s’ofereixen dinàmicament per part del servidor. És a dir, que no formen part de cap interval.</div>
</li>
<li class="level1">
<div class="li"><strong>Concessions</strong>: l’assignació d’una adreça IP i la resta de paràmetres de xarxa a un client per part del servidor, és una concessió (o <em>leasse</em>). Els clients reben les concessions per períodes de temps finits, que en finalitzar, cal renegociar. Tant el client com el servidor s’anoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessió el servidor pot decidir revocar-la o ampliar-ne la concessió.</div>
</li>
</ul>
<div class="iocimportant">
<div class="ioccontent">
<p>El client tothora pot decidir renunciar a la concessió. Si el client vol allargar la concessió inicia un diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> abreujat amb el servidor que pot acabar amb una renovació o amb la pèrdua de la concessió (sempre pot tornar a començar el procés). Tant el servidor com el client normalment miren les concessions que s’han efectuat entre ells amb anterioritat per tal de, si és possible, repetir la mateixa assignació.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Reserves</strong>: anomenem <em>reserves</em> aquelles adreces IP que s’assignen via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> però de manera fixa. És a dir, són adreces que s’assignen dinàmicament però sempre i únicament a un <em>host</em> determinat. Fixeu-vos que tot i ser una adreça dinàmica només s’utilitza si el <em>host</em> associat en fa ús. Si el <em>host</em> està apagat l’adreça no es pot usar per a altres <em>hosts</em>, està reservada. Un exemple podria ser:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
       host iocserver {
           hardware ethernet 08:00:2b:4c:59:23;
           fixed-address 140.220.191.1;
       }
      range 140.220.191.150 140.220.191.249;
       }</pre>
<div class="iocimportant">
<div class="ioccontent">
<p>En aquest exemple es pot veure que l’adreça <em>140.220.191.1</em> és una adreça reservada exclusivament per al <em>host</em> iocserver, que s’identifica mitjançant la seva adreça MAC.</p>
</div>
</div>
</div>
<h3><a id="dhcp_un_servei_client_servidor"></a>DHCP un servei client/servidor</h3>
<div class="level3">
<div class="iocreference">
<div class="ioccontent">
<p>Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.</p>
</div>
</div>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un més dels serveis de xarxa que tenen l’estructura client /servidor. Els servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són els equips que tenen en execució el programa servidor. És el programa encarregat d’atendre les peticions dels clients i oferir-los la configuració de xarxa, tot portant el registre de les IP que concedeix i el registre de totes les accions que realitza. Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són aquells equips que realitzen peticions per obtenir una configuració de xarxa a un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
<h4><a id="el_client_dhcp"></a>El client DHCP</h4>
<div class="level4">
<p>Un equip client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un equip que sol·licita la IP i altres paràmetres de configuració de xarxa a un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en lloc de tenir-los definits localment en l’equip.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">ISP</p>
<p><acronym title="Internet Service Provider">ISP</acronym>: <em>Internet service provider</em> o proveïdor de servei/accés a Internet. Ho són per exemple les empreses Ono, Vodafone, Jazztel, etc.</p>
</div>
</div>
<p>Si connecteu el vostre equip informàtic a la xarxa Internet per mitjà d’un <acronym title="Internet Service Provider">ISP</acronym> (<em>Internet service provider</em> o proveïdor de servei/accés a Internet), segurament rebreu una IP dinàmica del vostre proveïdor. Quan es realitzava una trucada telefònica amb mòdem i usant el protocol PPP (<em>point to point protocol</em>, protocol punt a punt), el proveïdor proporcionava una adreça IP dinàmica. Si utilitzeu ADSL i un encaminador o <em>router</em>, segurament l’encaminador us proporciona una adreça IP dinàmica privada a l’ordinador de casa. Al mateix temps, l’encaminador obté una IP dinàmica pública del proveïdor. Aquestes adreces IP dinàmiques són fixes (sempre les mateixes) o dinàmiques d’interval (pot ser qualsevol IP del conjunt d’adreces IP que té disponibles per concedir el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">IP pública / IP privada</p>
<p>La diferència entre una IP pública i una IP privada és que la pública és visible per a tots els equips d’Internet, mentre que la privada és visible només dins de la mateixa xarxa local.</p>
</div>
</div>
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ha de tenir en funcionament un dimoni (<em>daemon</em>) encarregat de la gestió de les tasques <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per part del client. El programa client realitza la part de negociació encarregada al client (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>, <em>request</em>) i també porta un registre de les concessions (<em>leases</em>) rebudes. Aquest registre és el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessió el programa client queda “adormit”, pendent de tornar-se a executar automàticament quan calgui renegociar la concessió. Sense intervenció de l’usuari, el programa client s’activa i segueix el procediment necessari per renegociar l’adreça IP cada cop que el temps de la concessió s’exhaureix.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Configuració client</p>
<p>Usualment les configuracions clients es poden fer de tres maneres diferents:</p>
<ul>
<li class="level1">
<div class="li">fitxer de text: editar directament els fitxers de configuració.</div>
</li>
<li class="level1">
<div class="li">menús en mode text: usant algun programa de menús amb interfície de text.</div>
</li>
<li class="level1">
<div class="li">aplicació gràfica: usant una aplicació de finestres en l’entorn gràfic.</div>
</li>
</ul>
</div>
</div>
<p>Els programes client varien d’un sistema operatiu a un altre i la manera d’executar-los també. Generalment es disposa d’un client executable en mode text o ordres i d’una interfície gràfica (<acronym title="Graphical User Interface">GUI</acronym>, <em>graphics user interface</em> o interfície gràfica d’usuari) per a la configuració. No cal dir que els sistemes Windows tendeixen a la configuració gràfica usant finestres i a la configuració i execució interna d’amagat de l’usuari. Normalment, en els sistemes GNU/Linux, la configuració es fa usant fitxers de text o com a opcions en l’ordre d’execució. La interfície gràfica acostuma a ser un frontal (<em>front-end</em>) per cridar l’ordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de <em>leasses</em>, més o menys detalladament.</p>
<p>Generalment el programa client es pot configurar per definir-ne el comportament en la comunicació amb el servidor: informació a demanar, informació a proporcionar al servidor, opcions per defecte, etc.</p>
</div>
<h3><a id="el_servidor_dhcp"></a>El servidor DHCP</h3>
<div class="level3">
<p>L’administrador de xarxa és l’encarregat de pensar la ubicació del servidor o servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en l’estructura corporativa. Com més complicada sigui la topologia de la xarxa, més difícil en serà la gestió. Una xarxa corporativa bàsica pot disposar d’un únic servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, però totes amb connectivitat amb el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Aquest també pot ser l’esquema d’una xarxa privada a casa, on un encaminador (el de l’<acronym title="Internet Service Provider">ISP</acronym>, per exemple) proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> a tots els ordinadors de la casa.</p>
<p>Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs les unes de les altres, la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es complica. Si es vol continuar amb un únic servidor per a tota la xarxa, caldrà que els tallafocs (<em>firewalls</em>) deixin passar els paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> entre les subxarxes i el servidor. Una altra opció és posar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a cada subxarxa o grups de subxarxes. Fent-ho així, l’administració de cada servidor és més senzilla però hi ha més servidors a administrar. Una xarxa amb una casuística completa és la que té diversos servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Si el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és l’encarregat de donar adreces IP als clients, qui li proporciona una adreça IP a ell? O bé un altre servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (i podríem tornar a fer la mateixa pregunta indefinidament) o bé l’administrador. Usualment, en una xarxa corporativa el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza una IP estàtica definida per l’administrador. Això li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre d’un altre servidor extern.</p>
<p>Hi ha diversos programes servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>: en mode text, en mode gràfic, en mode “màgic” (no es veu què fan) i en mode Unix (tot basat en fitxers de text). Cada administrador treballa amb les seves eines preferides. Les tasques bàsiques per aprendre a utilitzar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són observar/fer una llista de la configuració actual, activar/aturar el servei, modificar la configuració, monitorar els <em>logs</em> (registre de successos del servei) i, evidentment, saber instal·lar i desinstal·lar l’aplicació servidor.</p>
<div class="iocnote">
<div class="ioccontent">
<p>Els fitxers de logs (successos) recullen els esdeveniments que es volen monitorar.</p>
</div>
</div>
<p>Com la majoria de serveis de xarxa, el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un servei que s’executa en segon pla en forma de dimoni. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sempre està engegat escoltant en el port 67 les peticions que rep dels clients. Quan rep una petició entrant, el programa executable del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> la processa i posa en marxa tot el mecanisme <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultàniament (segons la configuració).</p>
<p>Els fitxers del registre del servei, on s’anoten les concessions, permeten mantenir la informació encara que el servei s’aturi o que el servidor s’apagui. En tornar a engegar es llegiran de nou els fitxers de registres per tal de saber quines són les concessions que s’havien realitzat.</p>
<div class="iocnote">
<div class="ioccontent">
<p>Els fitxers de concessions permeten mantenir la coherència de l’assignació d’adreces IP entre aturades del servei.</p>
</div>
</div>
</div>
<h2><a id="instal_lacio_d_un_servei_dhcp"></a>Instal·lació d'un servei DHCP</h2>
<div class="level2">
<p>El servei de xarxa <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està estructurat en forma de servei client / servidor; per tant, caldrà disposar del programari apropiat per fer cada un d’aquests rols. El programari que fa la funció de client usualment ja està integrat en el sistema operatiu (la part que gestiona la xarxa). És a dir, per disposar de la part client del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> normalment no cal instal·lar res, ja forma part del servei de xarxa.</p>
<p>Així doncs, quan parlem d’instal·lar un servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> fem referència al procés d’instal·lació i configuració del programari del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Evidentment també caldrà configurar els clients adequadament per fer ús d’aquest servei.</p>
<p>La instal·lació del programari que proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es fa de manera molt similar (per no dir idèntica) al programari d’altres serveis de xarxa com els serveis <acronym title="Domain Name System">DNS</acronym>, <acronym title="Hyper Text Transfer Protocol">HTTP</acronym>, <acronym title="File Transfer Protocol">FTP</acronym>, etc. Es tracta d’instal·lar el programari de l’aplicació servidor i fer-ne la configuració apropiada. Senzill oi?</p>
<p>Per fer això cal plantejar-se els passos següents:</p>
<ol>
<li class="level1">
<div class="li">Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?</div>
</li>
<li class="level1">
<div class="li">Obtenir l’aplicació que proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar l’estat de la xarxa actual. Està el servei ja en funcionament? Existeix ja una configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> activa?</div>
</li>
<li class="level1">
<div class="li">Instal·lar l’aplicació servidor.</div>
</li>
<li class="level1">
<div class="li">Comprovar que la instal·lació s’ha efectuat correctament.</div>
</li>
<li class="level1">
<div class="li">Configurar el servei en el servidor i activar els clients perquè l’utilitzin.</div>
</li>
<li class="level1">
<div class="li">Comprovar que el servei funciona correctament.</div>
</li>
</ol>
</div>
<h3><a id="aplicacions_servidor_dhcp"></a>Aplicacions servidor DHCP</h3>
<div class="level3">
<p>Sempre que l’administrador vol posar en funcionament un nou servei de xarxa cal que primerament analitzi quines aplicacions hi ha al mercat que ofereixen aquest servei. És feina seva estudiar les característiques de les diverses aplicacions, com per exemple: avaluar-ne l’eficiència, el cost, el que en diuen els altres… La manera més fàcil de fer això és navegar per Internet, consultar les revistes especialitzades o demanar consell a un dels gurus informàtics coneguts.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Usualment l’administrador s’informa a través del seu cercador preferit, per exemple Google, i de webs com la Viquipèdia. Podeu cercar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> o <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server al Google i a la wiki (en anglès).</p>
</div>
</div>
<p>Usualment, però, l’administrador acaba utilitzant l’aplicació servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que li proporciona el mateix sistema operatiu. Si utilitzeu el sistema operatiu Windows l’empresa Microsoft disposa d’una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment si utilitzeu GNU/Linux segurament la mateixa distribució ja proporciona un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. De totes maneres en podeu obtenir d’altres també a Internet.</p>
</div>
<h3><a id="instal_lar_l_aplicacio_servidor"></a>Instal·lar l'aplicació servidor</h3>
<div class="level3">
<p>Tot seguit es descriurà el procés per instal·lar el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en un entorn GNU/Linux. Un cop feta la instal·lació cal observar què s’ha instal·lat, quins programes executables, on són els fitxers de configuració, els de monitoratge, etc.</p>
<p>Els usuaris GNU/Linux poden buscar fàcilment per Internet quins paquets del client i del servidor dhcp usant eines com yum, apt-get o wget, a part dels repositoris de programari usuals o del mateix Google.</p>
<p>Llista de paquets <em>rpm</em> que contenen exactament el text <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># yum list dhcp </span></div>
</li>
<li class="li1">
<div class="de1">fedora <span class="nu0">100</span><span class="sy0">%</span> <span class="sy0">|</span>===================================================<span class="sy0">|</span> <span class="nu0">2.3</span> kB 00:00</div>
</li>
<li class="li1">
<div class="de1">Installed Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 installed</div>
</li>
</ol>
<p>Llista de paquets que contenen la cadena <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># yum list dhcp* </span></div>
</li>
<li class="li1">
<div class="de1">Installed Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 installed</div>
</li>
<li class="li1">
<div class="de1">dhcpv6_client.i386 <span class="nu0">0.10</span>-<span class="nu0">44</span>.fc7 installed</div>
</li>
<li class="li1">
<div class="de1">Available Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp-devel.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 updates</div>
</li>
<li class="li1">
<div class="de1">dhcp-forwarder.i386 <span class="nu0">0.7</span>-<span class="nu0">12</span>.fc7 fedora</div>
</li>
<li class="li1">
<div class="de1">dhcp-forwarder-sysv.i386 <span class="nu0">0.7</span>-<span class="nu0">12</span>.fc7 fedora</div>
</li>
<li class="li1">
<div class="de1">dhcp-static.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 updates</div>
</li>
<li class="li1">
<div class="de1">dhcpv6.i386 <span class="nu0">0.10</span>-<span class="nu0">44</span>.fc7 updates</div>
</li>
</ol>
<p>Instal·lar el paquet <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># yum install dhcp</span></div>
</li>
</ol>
<p>Fer la llista dels paquets <em>dhcp</em> instal·lats. Si el sistema ja els té instal·lats o volem comprovar-ho podem consultar els paquets instal·lats:</p>
<pre class="code">[root@portatil ~]# rpm -qa | grep dhcp 
libdhcp6client-0.10-44.fc7 
libdhcp4client-3.0.5-42.fc7 
dhcp-3.0.5-42.fc7 
dhcpv6_client-0.10-44.fc7 
libdhcp-1.24-6.fc7</pre>
<p>Obtenir informació del paquet del servei <em>dhcp</em> instal·lat:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qi dhcp </span></div>
</li>
<li class="li1">
<div class="de1">Name : dhcp Relocations: <span class="br0">(</span>not relocatable<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Version : 3.0.5 Vendor: Fedora Project</div>
</li>
<li class="li1">
<div class="de1">Release : <span class="nu0">42</span>.fc7 Build Date: dl <span class="nu0">12</span> nov <span class="nu0">2007</span> <span class="nu0">17</span>:<span class="nu0">37</span>:<span class="nu0">56</span> CET</div>
</li>
<li class="li1">
<div class="de1">Install Date: <span class="kw2">dc</span> <span class="nu0">23</span> gen <span class="nu0">2008</span> <span class="nu0">19</span>:<span class="nu0">14</span>:<span class="nu0">18</span> CET Build Host: xenbuilder4.fedora.phx.redhat.com</div>
</li>
<li class="li1">
<div class="de1">Group : System Environment<span class="sy0">/</span>Daemons Source RPM: dhcp-3.0.5-<span class="nu0">42</span>.fc7.src.rpm</div>
</li>
<li class="li1">
<div class="de1">Size : <span class="nu0">2162920</span> License: ISC</div>
</li>
<li class="li1">
<div class="de1">Signature : DSA<span class="sy0">/</span>SHA1, dl <span class="nu0">14</span> gen <span class="nu0">2008</span> <span class="nu0">19</span>:<span class="nu0">35</span>:<span class="nu0">22</span> CET, Key ID b44269d04f2a6fd2</div>
</li>
<li class="li1">
<div class="de1">Packager : Fedora Project</div>
</li>
<li class="li1">
<div class="de1">URL : http:<span class="sy0">//</span>isc.org<span class="sy0">/</span>products<span class="sy0">/</span>DHCP<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Summary : DHCP <span class="br0">(</span>Dynamic Host Configuration Protocol<span class="br0">)</span> server and relay agent</div>
</li>
<li class="li1">
<div class="de1">Description :</div>
</li>
<li class="li1">
<div class="de1">El DHCP <span class="br0">(</span>protocol de configuració dinàmica de màquines<span class="br0">)</span> és un protocol</div>
</li>
<li class="li1">
<div class="de1">que permet a dispositius individuals d<span class="st_h">'una xarxa IP obtenir la seva </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">informació de configuració de xarxa (adreça IP, màscara de subxarxa, </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">adreça de difusió, etc) d'</span>un servidor DHCP. El propòsit del DHCP és</div>
</li>
<li class="li1">
<div class="de1">fer més senzilla l<span class="st_h">'administració d'</span>una xarxa gran. El paquet dhcp</div>
</li>
<li class="li1">
<div class="de1">inclou el servei DHCP i l<span class="st_h">'agent de repetició de l'</span>ISC.</div>
</li>
<li class="li1">
<div class="de1">Per usar DHCP a la vostra xarxa, instal·leu un servei DHCP <span class="br0">(</span>o agent</div>
</li>
<li class="li1">
<div class="de1">de repetició<span class="br0">)</span> i als clients executeu un dimoni client DHCP. El paquet</div>
</li>
<li class="li1">
<div class="de1">dhcp proporciona servei DHCP i l<span class="st_h">'agent de repetició de l'</span>ISC.</div>
</li>
</ol>
</div>
<h3><a id="observar_els_components_del_programari_instal_lat"></a>Observar els components del programari instal·lat</h3>
<div class="level3">
<p>Sovint passa que els usuaris instal·len programes als ordinadors però no saben quins fitxers han instal·lat ni on són. Un administrador curiós ha de fer un repàs a tot allò que s’ha afegit de nou al sistema.</p>
<p>Fer la llista dels components del paquet <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>omshell</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5</div>
</li>
<li class="li1">
<div class="de1">... output suprimit ....</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc951.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man1<span class="sy0">/</span>omshell.1.gz</div>
</li>
<li class="li1">
<div class="de1">... output suprimit ...</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcrelay.8.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
</ol>
<p>En funció del directori on s’ubiquen els fitxers podem intuir si són executables, de configuració o de documentació. També podem mirar de filtrar la sortida en cada cas:</p>
<p>Fitxers de configuració (usualment en el directori <em>/etc</em>):</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qc dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep etc </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
</ol>
<p>Fitxers de documentació:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qd dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>IANA-arp-parameters</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>README</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>README.ldap</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>RELNOTES</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>3.0b1-lease-convert</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>dhcp.spec</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>dhcpd-conf-to-ldap</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>Registry.perlmodule</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>ms2isc.pl</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>readme.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>sethostname.sh</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>solaris.init</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>api+protocol</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>dhcpd.conf.sample</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-authentication-<span class="nu0">14</span>.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-dhcp-dns-<span class="nu0">12</span>.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-failover-07.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-ldap-schema-01.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc1542.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2131.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2132.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2485.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2489.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc951.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man1<span class="sy0">/</span>omshell.1.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcp-eval.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcp-options.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcpd.conf.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcpd.leases.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcpd.8.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcrelay.8.gz</div>
</li>
</ol>
<p>Podem mirar de filtrar quins són els executables tenint en compte que usualment estaran en un directori de nom <em>bin</em> o <em>sbin</em>:</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Arxius executables</p>
<p>En GNU/Linux els fitxers executables per l’administrador es troben usualment a i a . Els executables d’usuari normalment són a i .</p>
</div>
</div>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep bin </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>omshell <span class="sy0">/</span>sbin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd <span class="sy0">/</span>usr<span class="sy0">/</span>sbin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>bin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcrelay <span class="sy0">/</span>usr<span class="sy0">/</span>bin</div>
</li>
</ol>
<p></p>
<p>En resum:</p>
<ul>
<li class="level1">
<div class="li">Els fitxers de documentació es troben generalment a: <em>/usr/share/doc</em> i a <em>/usr/share/man</em>.</div>
</li>
<li class="level1">
<div class="li">Els fitxers de configuració es troben a: <em>/etc</em>, i a <em>/etc/sysconfig</em>.</div>
</li>
<li class="level1">
<div class="li">El dimoni del servei es troba a: <em>/usr/sbin/dhcpd</em>.</div>
</li>
<li class="level1">
<div class="li">El fitxer de configuració del dimoni del servei és: <em>/etc/dhcpd.conf</em>.</div>
</li>
<li class="level1">
<div class="li">El fitxer de govern del servei és: <em>/etc/rc.d/init.d/dhcpd</em>.</div>
</li>
</ul>
</div>
<h4><a id="activar_desactivar_el_servei_i_nivells_d_arrancada"></a>Activar/desactivar el servei i nivells d'arrancada</h4>
<div class="level4">
<p>Un cop feta la instal·lació física de l’aplicació servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (els fitxers) cal posar-lo en marxa, engegar-lo, o comprovar que ja ho està.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Serveis de xarxa: stand alone o xinetd</p>
<p>En la majoria de serveis de xarxa el servidor pot funcionar com un servei per si mateix (<em>stand alone</em>) o pot estar configurat per funcionar dins d’un superservei de xarxa com per exemple <em>inetd</em> i <em>xinetd</em>. Si funciona en mode de servei propi és el servidor qui escolta les connexions entrants i les atén. Si s’executa dins del superservei de xarxa, aquest és qui detecta les connexions entrants i activa el dimoni del servei per tal que les atengui, un cop ateses el dimoni del servei acaba i torna a ser el superservidor de xarxa qui es queda escoltant.</p>
<p>En un primer moment molts serveis funcionaven en mode <em>stand alone</em>, però això es va mostrar poc eficient a nivell de recursos. Fixeu-vos que si es vol oferir n serveis de xarxa, cal tenir engegats els n servidors corresponents. Aquests ocupen memòria i CPU, tot i que no atenguin cap client. Estan engegats només “per si” un client els demana.</p>
<p>Un model més eficient és engegar un únic procés que fa la tasca de superservidor de xarxa (<em>inetd o xinetd</em>) i només quan es rep una petició d’un client, s’executa el servei apropiat.</p>
<p>Usualment els serveis que funcionen en mode xinetd disposen de fitxers de configuració lligats al xinetd. Els serveis que actuen indivudualment disposen dels fitxers de configuració propis al etc rc.dinit.d/.</p>
<p>Molt sovint és decisió de l’administrador configurar en quin mode de funcionament vol que treballi el servei. Per exemple el servei de pàgines web (<em>httpd</em>), el servei <em>ssh</em> i molts d’altres, funcionen individualment. Serveis més bàsics com <em>telnet</em>, <em>finger</em>, <em>tftp</em>, etc funcionen usualment dins del <em>xinetd</em>.</p>
</div>
</div>
<p>Primerament cal saber si el servidor instal·lat funciona en mode <em>stand-alone</em> o dins del superdimoni de xarxa <em>xinetd</em> o <em>initd</em>. Si existeixen fitxers de configuració dins del directori <em>/etc/xinetd.d/&lt;nom-servei&gt;</em> es tracta d’un servei dins del <em>xinetd</em>. Si existeixen fitxers de configuració dins del directori <em>/etc/rc.d/init.d/&lt;nom-servei&gt;</em> es tracta d’un servei <em>stand-alone</em>. Podem fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep /etc </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
</ol>
<p>Com podem observar es tracta d’un servei <em>stand-alone</em>. També es pot consultar el tipus de servei amb l’ordre chkconfig i observar si surt en la llista d’un tipus o de l’altre:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list | grep dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>Per facilitar buscar els serveis “stand-alone” podem fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>L’estat del servei pot ser en execució (<em>running</em>) o aturat (<em>stopped</em>). Es pot consultar l’estat amb l’opció <em>status</em> de l’ordre <em>service</em> o del mateix executable del servei:</p>
<ol>
<li class="li1">
<div class="de1">Es pot saber l<span class="st_h">'estat del servei amb l'</span>opció status de les ordres:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcp status </span></div>
</li>
<li class="li1">
<div class="de1">dhcp està aturat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># /etc/rc.d/init.d/dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcp està aturat</div>
</li>
</ol>
<p>La gestió de l’estat d’un servei normalment inclou les opcions <em>start</em>, <em>stop</em>, <em>status</em>, <em>restart</em> i <em>reload</em>. Aquestes són les més usuals, però cada servei pot definir les que cregui oportunes. Aquests són exemples de gestió de l’estat del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<p>Es pot arrancar el servei amb l’opció start de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està iniciant el servei dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Es pot aturar el servei amb l’opció stop de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd stop </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd stop </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està aturant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Es pot iniciar de nou el servei (recarregar) amb l’opció reload o restart de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># /etc/rc.d/init.d/dhcpd restart </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el servei dhcpd: [Incorrecte] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd reload </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el servei dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Per saber les opcions possibles d’un servei es pot fer el truc:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd patapum </span></div>
</li>
<li class="li1">
<div class="de1">Forma d<span class="st_h">'ús: /etc/init.d/dhcpd {start|stop|restart|condrestart|status} </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd pimpam </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">Forma d'</span>ús: <span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd <span class="br0">{</span>start<span class="sy0">|</span>stop<span class="sy0">|</span>restart<span class="sy0">|</span>condrestart<span class="sy0">|</span>status<span class="br0">}</span></div>
</li>
</ol>
<p></p>
<p>Que un servei del sistema estigui engegat no significa que en arrancar de nou el sistema torni a estar engegat. Cal comprovar que sigui així o assegurar-se de definir-ho correctament. Els serveis (usualment dimonis executables) es poden configurar per arrancar automàticament en determinats nivells d’execució. Les màquines GNU/Linux tenen 7 nivells d’execució com es pot veure del fitxer <em>/etc/inittab</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># head -20 /etc/inittab </span></div>
</li>
<li class="li1">
<div class="de1">... output suprimit ...</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Default runlevel. The runlevels used by RHS are: </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 0 - halt (Do NOT set initdefault to this) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 1 - Single user mode </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 2 - Multiuser, without NFS (The same as 3, if you do not have networking) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 3 - Full multiuser mode </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 4 - unused </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 5 - X11 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 6 - reboot (Do NOT set initdefault to this) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># ... output suprimit ...</span></div>
</li>
</ol>
<p>Per configurar a quins nivells es vol que s’executi un servei s’utilitza l’ordre chkconfig, que permet activar/desactivar el servei pels nivells indicats. L’exemple següent mostra l’ús d’aquesta ordre, dóna la llista de l’estat actual del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en tots els nivells i el configura per executar-se en els nivells 3, 4 i 5:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --help </span></div>
</li>
<li class="li1">
<div class="de1">chkconfig versió 1.3.34 - Copyright <span class="br0">(</span>C<span class="br0">)</span> <span class="nu0">1997</span>-<span class="nu0">2000</span> Red Hat, Inc.</div>
</li>
<li class="li1">
<div class="de1">Aquest programari es pot distribuir lliurement d<span class="st_h">'acord amb els termes de la Llicència </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">Pública General GNU. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">forma d'</span>ús: chkconfig <span class="re5">--list</span> <span class="br0">[</span>nom<span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--add</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--del</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--override</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="br0">[</span>--level <span class="sy0">&lt;</span>nivells<span class="sy0">&gt;</span><span class="br0">]</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>on<span class="sy0">|</span>off<span class="sy0">|</span>reset<span class="sy0">|</span>resetpriorities<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --level 345 dhcpd on </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list | grep dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:engegat <span class="nu0">4</span>:engegat <span class="nu0">5</span>:engegat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>Fixeu-vos que definir els nivells d’execució no significa que el servei estigui ara mateix engegat. Significa que quan arranqui el sistema de nou s’engegarà en els nivells corresponents. Podem ara estar al nivell 5 i tenir el servei aturat perquè encara no l’hem engegat. Per exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># runlevel </span></div>
</li>
<li class="li1">
<div class="de1">N <span class="nu0">5</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd està aturat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està iniciant el servei dhcpd [ FET ]</span></div>
</li>
</ol>
</div>
<h2><a id="comprovacio_del_funcionament_basic"></a>Comprovació del funcionament bàsic</h2>
<div class="level2">
<p></p>
<p>Comprovar que el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està en funcionament és un procés ben senzill, n’hi ha prou de comprovar que el servei està engegat. Això no vol dir, en cap cas, que el servei estigui funcionant correctament. Potser el servidor està engegat però no està correctament configurat. De fet, la configuració és la part realment important de l’administració d’un servei, i també del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>A part de comprovar l’estat del servei (amb l’opció <em>status</em>), l’administrador pot assegurar-se que el dimoni del servei està en execució buscant el seu PID (<em>process identifier</em> o indicador de número de procés). Una altra activitat a fer és monitorar el registre d’activitats del servei (els <em>logs</em>). Tot el trànsit <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és trànsit de xarxa TCP/IP; per tant també es pot observar l’estat dels ports i analitzar el trànsit que s’hi produeix.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Comprovació DHCP</p>
<p>L’administrador pot verificar el funcionament del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> observant:</p>
<ul>
<li class="level1">
<div class="li">l’estat del servei (on, off)</div>
</li>
<li class="level1">
<div class="li">el PID del servei (ha d’estar running).</div>
</li>
<li class="level1">
<div class="li">el registre de <em>logs</em>.</div>
</li>
<li class="level1">
<div class="li">monitorar el trànsit de xarxa amb una eina tipus <em>wireshark</em>.</div>
</li>
<li class="level1">
<div class="li">l’estat dels ports.</div>
</li>
</ul>
</div>
</div>
<p>Tot procés en el sistema té un identificador de procés. El PID dels serveis usualment es desen en el sistema de fitxers (al directori <em>/var/run</em>) en forma de fitxer que conté un valor numèric (en text) corresponent al PID del procés. Amb el servei en marxa sempre es pot observar el PID del servidor amb:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ps ax | grep dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3610</span> ? Ss <span class="nu0">0</span>:00 <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="br0">(</span>pid <span class="nu0">3610</span><span class="br0">)</span> s<span class="st_h">'està executant...</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# ll /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">-rw-r--r-- 1 root root 5 29 jun 14:17 /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# cat /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">3610</span></div>
</li>
</ol>
<p>Un cop iniciat el servei es crea un fitxer de bloqueig o <em>lock</em> amb el nom del servei per evitar iniciar-ne una altra instància. Els fitxers de <em>lock</em> usualment es troben a <em>/var/lock</em> i són un simple fitxer de text buit on la seva pròpia existència ja marca que el servei està en marxa. En parar el servei el fitxer s’elimina. Podem observar això fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lock/subsys/dhcpd </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /var/lock/subsys/dhcpd </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">0</span> <span class="nu0">1</span> jun <span class="nu0">18</span>:<span class="nu0">26</span> <span class="sy0">/</span>var<span class="sy0">/</span>lock<span class="sy0">/</span>subsys<span class="sy0">/</span>dhhcpd</div>
</li>
</ol>
<p>Tots els serveis del sistema normalment es monitoren anotant en fitxers de text un registre de totes les accions que realitzen, són els fitxers coneguts com a fitxers de <em>log</em>. Tant es pot utilitzar un fitxer genèric pel sistema com un fitxer independent per a un servei determinat. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza el fitxer de monitoratge estàndard <em>/var/log/messages</em>. En aquest fitxer s’enregistra cada cop que el servei s’engega i s’atura.</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/log/messages | grep dhcp </span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">16</span>:<span class="nu0">53</span> portatil yum: Installed: dhcp - <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7.i386</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Internet Systems Consortium DHCP Server V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: WARNING: Host declarations are global. They are not limited</div>
</li>
<li class="li1">
<div class="de1">to the scope you declared them in.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> deleted host decls to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> new dynamic host decls to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> leases to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="sy0">/</span>192.168.1<span class="sy0">/</span><span class="nu0">24</span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="sy0">/</span>192.168.1<span class="sy0">/</span><span class="nu0">24</span></div>
</li>
</ol>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> desa la informació de registre de les concessions que efectua en un fitxer de <em>leasses</em>. Això li permet seguir la pista de les adreces IP que ha concedit i ser coherent entre diverses arrancades del mateix servidor. Es pot observar aquest fitxer a <em>/var/lib/dhcpd/dhcpd.leases</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">473</span> <span class="nu0">29</span> jun <span class="nu0">14</span>:<span class="nu0">17</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># All times in this file are in UTC (GMT), not your local timezone. This is </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># not a bug, so please don't ask about it. There is no portable way to </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># store leases in the local timezone, so please don't request this as a </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># feature. If this is inconvenient or confusing to you, we sincerely </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># apologize. Seriously, though - don't ask. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># The format of this file is documented in the dhcpd.leases(5) manual page. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># This lease file was written by isc-dhcp-V3.0.5-RedHat</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Sovint l’administrador vol comprovar que els ports que utilitza el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> estan oberts. En GNU/Linux es pot fer una llista fàcilment dels serveis associats a cada port mitjançant el fitxer <em>/etc/services</em>. Algunes utilitats com nmap permeten detectar els ports oberts. Per exemple podem fer:</p>
<ol>
<li class="li1">
<div class="de1">Llista dels ports que inclouen alguna referència DHCP:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/services | grep DHCP </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>tcp dhcpc <span class="co0"># BOOTP client </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>udp dhcpc</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-client <span class="nu0">546</span><span class="sy0">/</span>tcp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-client <span class="nu0">546</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-server <span class="nu0">547</span><span class="sy0">/</span>tcp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-server <span class="nu0">547</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">dhcp-failover <span class="nu0">647</span><span class="sy0">/</span>tcp <span class="co0"># DHCP Failover </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover <span class="nu0">647</span><span class="sy0">/</span>udp <span class="co0"># DHCP Failover </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover2 <span class="nu0">847</span><span class="sy0">/</span>tcp <span class="co0"># dhcp-failover 2 </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover2 <span class="nu0">847</span><span class="sy0">/</span>udp <span class="co0"># dhcp-failover 2 </span></div>
</li>
<li class="li1">
<div class="de1">qip-qdhcp <span class="nu0">2490</span><span class="sy0">/</span>tcp <span class="co0"># qip_qdhcp </span></div>
</li>
<li class="li1">
<div class="de1">qip-qdhcp <span class="nu0">2490</span><span class="sy0">/</span>udp <span class="co0"># qip_qdhcp </span></div>
</li>
</ol>
<p>Si ens hi fixem veurem que de fet el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és anomenat BOOTP. Podem fer la llista de les entrades que corresponen a aquest protocol:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/services | grep bootp </span></div>
</li>
<li class="li1">
<div class="de1">bootps <span class="nu0">67</span><span class="sy0">/</span>tcp <span class="co0"># BOOTP server </span></div>
</li>
<li class="li1">
<div class="de1">bootps <span class="nu0">67</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>tcp dhcpc <span class="co0"># BOOTP client </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>udp dhcpc</div>
</li>
<li class="li1">
<div class="de1">nuts_bootp <span class="nu0">4133</span><span class="sy0">/</span>tcp <span class="co0"># NUTS Bootp Server </span></div>
</li>
<li class="li1">
<div class="de1">nuts_bootp <span class="nu0">4133</span><span class="sy0">/</span>udp <span class="co0"># NUTS Bootp Server</span></div>
</li>
</ol>
<p>Es pot observar que el port usat pel client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és el port 68 (bootpc) i el port usat pel servidor és el port 67 (bootps).</p>
</div>
<h2><a id="configuracio_dhcp"></a>Configuració DHCP</h2>
<div class="level2">
<p>Per configurar el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> primer cal saber observar i manipular la configuració de xarxa existent, i això consisteix a saber:</p>
<ul>
<li class="level1">
<div class="li">Observar/fer la llista de la configuració de xarxa actual.</div>
</li>
<li class="level1">
<div class="li">Comprovar l’estat del servei de xarxa.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de xarxa.</div>
</li>
<li class="level1">
<div class="li">Monitorar el servei i el procés del servidor.</div>
</li>
</ul>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Exemples de configuració</p>
<p>En GNU/Linux és molt usual que el paquet que proporciona un servei inclogui un fitxer d’exemple de configuració. El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> incorpora el fitxer d’exemple <em>dhcpd..conf</em> i la pàgina de manual del mateix nom.</p>
</div>
</div>
<p>Les tasques principals per configurar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són les següents:</p>
<ul>
<li class="level1">
<div class="li">Instal·lar el programari del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar/fer la llista de la configuració actual del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Modificar la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Monitorar els <em>logs</em> del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i els fitxers de registre de les concessions (<em>leases</em>).</div>
</li>
</ul>
<p>Per tant, abans d’endinsar-nos en la configuració del servei és molt útil observar una configuració ja existent. Un exemple de fitxer de configuració del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és el que es mostra a continuació:</p>
<p></p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># a) opcions globals del servidor DHCP (usuals)</span></div>
</li>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># b) definició de la xarxa a la qual s'ofereix el servei DHCP</span></div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># opcions genèriques per a tots els equips de la xarxa</span></div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.0.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># definició de l'interval d'ips dinàmiques a usar </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># i dels temps de les concessions</span></div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.0.128 192.168.0.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># c) Opcions d'equips individuals</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># el servidor ns obté sempre una adreça fixa basada en MAC</span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest fitxer de configuració es pot veure que hi ha tres àmbits diferents de definició:</p>
<ol>
<li class="level1">
<div class="li"><strong>Opcions globals en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</strong> Són opcions que indiquen al servidor la seva manera d’actuar. També són opcions generals que cal aplicar a totes les concessions que es realitzin, independentment de la xarxa o equip que siguin.</div>
</li>
<li class="level1">
<div class="li"><strong>Definicions i opcions de xarxa.</strong> Es defineixen tantes xarxes diferents com subxarxes ha d’atendre el servidor. Cada definició de subxarxa consta de la IP de la xarxa i la màscara corresponent. Entre claus s’indiquen totes les opcions específiques per a les concessions de les adreces IP corresponents a aquesta subxarxa. Una opció característica és indicar l’interval (o <em>pool</em>) d’adreces dinàmiques a usar, la porta d’enllaç predeterminada, el servidor de noms, etc.</div>
</li>
<li class="level1">
<div class="li"><strong>Opcions d’equips individuals.</strong> Dins d’una subxarxa es poden definir opcions per a equips individuals. Cal identificar els equips per la seva adreça MAC i, entre claus, indicar les opcions que els són específiques. Això permet assignar adreces fixes dinàmicament (equivalent al protocol BOOTP) usant les opcions de maquinari Ethernet i <em>fixed-address</em>.</div>
</li>
</ol>
<p>Les opcions globals de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es poden redefinir amb valors diferents dins d’un bloc de xarxa concret. Dins d’un equip també es poden definir opcions amb valors diferents als definits per la xarxa o globalment. Tal com passa en els llenguatges de programació preval el valor més intern, el de <em>host</em> sobre el de xarxa i el de xarxa per sobre del global.</p>
</div>
<h3><a id="configuracio_basica"></a>Configuració bàsica</h3>
<div class="level3">
<p>Per fer funcionar el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> cal configurar-lo prèviament. Per poder arrancar li cal saber a quina xarxa donarà servei i quin és l’interval d’adreces IP que pot usar dinàmicament per a les concessions als clients.</p>
<p>El paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> conté un fitxer d’exemple al directori <em> /user/share/doc/dhcp*/dhcpd.conf.sample</em>. Aquest fitxer es pot copiar a <em> /etc/dhcpd.conf</em> i passarà a ser la configuració bàsica del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Podem veure el seu contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /usr/share/doc/dhcp-3.0.5/dhcpd.conf.sample </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">852</span> <span class="nu0">12</span> nov <span class="nu0">2007</span> <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>dhcpd.conf.sample</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/dhcpd.conf </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># DHCP Server Configuration file. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># see /usr/share/doc/dhcp*/dhcpd.conf.sample </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#a) opcions globals</span></div>
</li>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#b) opcions genèriques per a una subxarxa concreta</span></div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.1.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># --- default gateway </span></div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option nis-domain <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option time-offset <span class="re5">-18000</span>; <span class="co0"># Eastern Standard Time </span></div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.1.128 192.168.1.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#c) we want the nameserver to appear at a fixed address </span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En la configuració per defecte es poden analitzar els diversos elements que es configuren:</p>
<ul>
<li class="level1">
<div class="li">Opcions globals: indiquen al servidor que ignori les actualitzacions dels clients i el tipus de DDNS a usar (actualitzacions dinàmiques de <acronym title="Domain Name System">DNS</acronym>).</div>
</li>
<li class="level1">
<div class="li">Definició de subxarxa: cal definir tants blocs de subxarxa com subxarxes atengui el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Opcions genèriques de subxarxa: per a una subxarxa es poden indicar opcions genèriques per als equips d’aquesta subxarxa. Evidentment poden diferir de les opcions d’altres subxarxes.</div>
</li>
<li class="level1">
<div class="li">Les principals opcions de xarxa a descriure són el router, la màscara de xarxa, el domini, etc.</div>
</li>
<li class="level1">
<div class="li">Les principals opcions a descriure del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són definir l’interval d’adreces IP dinàmiques a usar pel servidor i el temps màxim de concessió d’aquestes adreces IP.</div>
</li>
<li class="level1">
<div class="li">Per tal que un <em>host</em> determinat tingui sempre la mateixa adreça IP es poden fer entrades individualitzades per a <em>hosts</em> concrets. Els <em>hosts</em> s’identifiquen per la seva adreça MAC.</div>
</li>
<li class="level1">
<div class="li">A un <em>host</em> concret (descrit en una entrada <em>host</em>) se li poden aplicar opcions individualitzades, com per exemple definir el seu nom. Les opcions individuals prevalen sobre les genèriques.</div>
</li>
</ul>
</div>
<h3><a id="configuracio_avancada"></a>Configuració avançada</h3>
<div class="level3">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> permet configuracions d’una certa complexitat. Podeu consultar la documentació de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i les pàgines de manual del dimoni <em>dhcpd</em> i del fitxer de configuració <em>dhcpd.conf</em>.</p>
<p>Les principals característiques que s’hi descriuen són l’agrupació d’entrades en grups i classes i la possibilitat que el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es comuniqui amb el <acronym title="Domain Name System">DNS</acronym> (actualitzacions DDNS) per crear entrades <acronym title="Domain Name System">DNS</acronym> quan un equip rep una configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Un exemple de configuració amb opcions més avançades:</p>
<ol>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.1.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># --- default gateway</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">option nis-domain <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option time-offset-<span class="nu0">18000</span>;<span class="co0"># Eastern Standard Time </span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.1.128 192.168.1.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># we want the nameserver to appear at a fixed address </span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"Xncd19r"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">49</span>:2b:<span class="nu0">57</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">80</span>:<span class="kw3">fc</span>:<span class="nu0">32</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd8 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">22</span>:<span class="nu0">46</span>:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 10.0.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option routers 10.0.0.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Unknown clients get this pool. </span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers bogus.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">300</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.200 10.0.0.253;</div>
</li>
<li class="li1">
<div class="de1">allow unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Known clients get this pool. </span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.example.com, ns2.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">28800</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.5 10.0.0.199;</div>
</li>
<li class="li1">
<div class="de1">deny unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h3><a id="base_de_dades_de_concessions_fetes_pel_servidor"></a>Base de dades de concessions fetes pel servidor</h3>
<div class="level3">
<p>El servidor desa en una base de dades local (de fet són fitxers de text) les concessions (<em>leases</em>) que realitza. D’aquesta manera en pot seguir la pista en tot moment. Generalment, les té a memòria (per permetre un accés més ràpid), però en manté una còpia a disc. Si, per exemple, el sistema o el servei es reinicia, pot saber quines són les concessions que encara estan actives (i per tant quines adreces IP no té disponibles).</p>
<p>Usualment el fitxer de concessions és a <em>/var/lib/dhcpd</em>. Podem veure’n el contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># All times in this file are in UTC (GMT), not your local timezone. This is </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># not a bug, so please don't ask about it. There is no portable way to </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># store leases in the local timezone, so please don't request this as a </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># feature. If this is inconvenient or confusing to you, we sincerely </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># apologize. Seriously, though - don't ask. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># The format of this file is documented in the dhcpd.leases(5) manual page. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># This lease file was written by isc-dhcp-V3.0.5-RedHat </span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.253 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">27</span>:<span class="nu0">16</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">22</span>:<span class="nu0">27</span>:<span class="nu0">16</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:8e:<span class="nu0">72</span>:de;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h3><a id="opcions_de_configuracio_del_servidor_i_ambit_d_aplicacio"></a>Opcions de configuració del servidor i àmbit d'aplicació</h3>
<div class="level3">
<p>Les opcions de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són múltiples i comprenen molts àmbits. Algunes permeten compatibilitat amb sistemes antics, d’altres amb altres tipus de xarxes, etc. No és imaginable que un administrador de xarxes les conegui totes a fons. Normalment farà ús d’un conjunt reduït d’opcions que serà més que suficient per administrar la majoria de xarxes.</p>
<p>La configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es pot definir tant al client com al servidor, tot i que usualment es farà en el servidor. Entenem com a tasca principal la de configurar un servidor per tal de proporcionar les opcions apropiades a cada subxarxa. De totes maneres, però, un client també pot disposar d’un fitxer de configuració on es defineixen quins són els seus requeriments i com ha de realitzar el diàleg amb el servidor. Per exemple es defineixen quines opcions ha de sol·licitar, valors per defecte a determinades opcions (per si el servidor no en proporciona un valor). El client també pot definir informació que proporcionarà al servidor per tal que aquest prengui decisions dinàmicament.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Podeu fer un repàs més extens de la configuració del servidor consultant la secció d’annexos del web d’aquest mòdul.</p>
</div>
</div>
<p>Caldrà, doncs, entendre quins són els àmbits (scope) de definició de sentències i opcions, com s’agrupen les subxarxes i els <em>hosts</em>, quines són les opcions globals, com es realitzen definicions condicionals i molts altres detalls.</p>
</div>
<h4><a id="ambit_de_definicio"></a>Àmbit de definició</h4>
<div class="level4">
<p>Els clients es poden agrupar en diversos àmbits per tal de definir les opcions que han de rebre. El mateix servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot actuar de manera diferent segons sigui l’àmbit de definició.</p>
<p>Alguns dels conceptes a tractar són:</p>
<ul>
<li class="level1">
<div class="li"><em>Subnets</em>.</div>
</li>
<li class="level1">
<div class="li">Període de concessió.</div>
</li>
<li class="level1">
<div class="li">Adreces fixes o reservades: identificació de <em>host</em>.</div>
</li>
<li class="level1">
<div class="li">PXE: Protocol d’arrencada via xarxa.</div>
</li>
<li class="level1">
<div class="li">Àmbit d’aplicació.</div>
</li>
<li class="level1">
<div class="li"><em>Pool</em>.</div>
</li>
</ul>
</div>
<h4><a id="subnets"></a>Subnets</h4>
<div class="level4">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> permet fer assignació dinàmica d’adreces IP per diferents subxarxes sense que es requereixi un servidor específic per a cada subxarxa. Fins i tot el servei es pot oferir a xarxes “llunyanes”, és a dir, que han de creuar almenys un router per accedir al servidor. En aquest cas es parla del concepte <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Relaying.</p>
<p>Per oferir el servei a una subxarxa cal conèixer l’adreça de la xarxa i la seva màscara corresponent. Per cada subxarxa el servidor pot disposar d’un o més intervals d’adreces dinàmiques de les quals obtindrà l’adreça a concedir al client. Uns exemples bàsics poden ser:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># subxarxa amb un interval d'adreces dinàmiques:</span></div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># subxarxa amb dos intervals d'adreces dinàmiques:</span></div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.107;</div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.113 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h4><a id="periode_de_concessio"></a>Període de concessió</h4>
<div class="level4">
<p>Les concessions d’adreces s’efectuen per períodes de temps determinats. Un cop exhaurit aquest temps, cal procedir a renegociar la concessió (que es pot renovar o cancel·lar). De fet les concessions es poden efectuar per períodes des de zero segons a un temps infinit. El temps apropiat en cada cas dependrà del tipus de client i servei que s’ofereix; és diferent un client wireless a l’aeroport que l’estació de treball del supercap executiu de la corporació.</p>
<p>Des del punt de vista de la configuració del servidor es poden establir dos tipus de temps, el <em>default-lease-time</em> i el <em>max-lease-time</em>. El primer permet definir el temps màxim per defecte que es concedeix als clients quan aquests no han sol·licitat cap període de temps concret. El segon estableix el temps màxim de concessió en aquesta subxarxa. Podem veure un exemple d’aquestes opcions:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># el temps màxim d'una concessió són 7200 segons, a cap client se li pot concedir més temps. Si el client no ha demanat cap temps concret, se li assigna una concessió de 600 segons.</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.107;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Els períodes de concessió es poden definir globalment per a totes les subxarxes a les quals es proporciona servei, però és més usual fer-ho per cada subxarxa quan aquestes tenen requeriments diferents.</p>
</div>
<h4><a id="adreces_reservades"></a>Adreces reservades</h4>
<div class="level4">
<p>A part de l’assignació dinàmica d’adreces d’interval el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> també pot fer assignacions dinàmiques fixes. És a dir, assignar a un equip sempre la mateixa dreça IP. En aquest cas parlem d’adreça reservada. L’equip ‘consumeix’ aquesta adreça tant si està engegat com si està apagat. Per poder assignar a un <em>host</em> concret sempre la mateixa adreça cal identificar-lo de manera única i inequívoca. Això es pot fer mitjançant la seva adreça MAC. Un exemple pot ser:</p>
<ol>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Es pot observar que l’opció hardware permet identificar el <em>host</em> iocserver a través de la seva adreça MAC.</p>
</div>
<h4><a id="pxeprotocol_d_arrencada_via_xarxa"></a>PXE: protocol d'arrencada via xarxa</h4>
<div class="level4">
<p>Molts sistemes i targetes de xarxa permeten arrencar clients de xarxa ‘tontos’. És a dir, equips que arranquen sense disposar de sistema operatiu i que el carreguen via xarxa. PXE és un protocol àmpliament utilitzar per a aquest fi. El client rep via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> el nom d’un fitxer que caldrà que descarregui via TFTP. Aquest fitxer acostuma a ser el sistema operatiu o el programari que ha de carregar per inicialitzar-se. L’opció <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que comunica el nom del fitxer a descarregar és l’opció <em>filename</em>.</p>
<ol>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/kernel_ioc.boot"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple s’indica el fitxer <em>kernel_ioc.boot</em> per descarregar per TFTP si s’utilitza un protocol d’arrencada via xarxa com el PXE.</p>
</div>
<h4><a id="opcions_generals"></a>Opcions generals</h4>
<div class="level4">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> proveeix el client no només de l’adreça IP, màscara i gateway, sinó de molts altres paràmetres de configuració de xarxa. Alguns d’aquests paràmetres són molt usuals (<acronym title="Domain Name System">DNS</acronym>, <em>routers</em>, etc) i d’altres molt específics (rars fins i tot).</p>
<p>Tots aquests paràmetres es passen al client en forma d’<em>options</em>. Les opcions poden ser d’àmbit general (per a totes les subxarxes), d’àmbit per a una subxarxa i d’àmbit concret d’un sol <em>host</em>. L’ordre de precedència és de l’àmbit més concret al més general. Un exemple seria:</p>
<div class="iocnote">
<div class="ioccontent">
<p>Per saber més de les opcions específiques es pot consultar la pàgina del manual dhcp-options(5) en un sistema GNU/Linux.</p>
</div>
</div>
<ol>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option broadcast-address 239.252.197.255;</div>
</li>
<li class="li1">
<div class="de1">option routers 239.252.197.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 239.252.197.2, 239.252.197.3;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"isc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/kernel_ioc.boot"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.5.5.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"vix.com"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En l’exemple anterior s’observa que es defineixen les opcions <em>subnetmask</em>, <em>broadcast-address</em>, <em>routers</em>, <em>domain-name-servers</em> i <em>domain-name</em> per a tots els equips de la subxarxa 239.252.197.0/24. Hi ha dues opcions, però, que es redefineixen amb valors diferents per al <em>host iocserver</em>. Són les opcions <em>domain-name-servers</em> i <em>domain-name</em>.</p>
</div>
<h4><a id="ambit_d_aplicaciosubnet"></a>Àmbit d'aplicació: subnet</h4>
<div class="level4">
<p>Les topologies de xarxa s’estructuren usualment en subxarxes, el mateix passa en la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Usualment els clients s’agrupen en la subxarxa a la qual pertanyen. S’utilitza la sentència <em>subnet</em> per definir les opcions d’una subxarxa concreta. Si els clients de la subxarxa han de rebre adreces dinàmiques d’interval, cal com a mínim una sentència <em>range</em>.</p>
<p></p>
<p>De vegades convé agrupar subxarxes diferents en un sol bloc d’opcions de configuració. Això passa per exemple quan una sola xarxa física que es vol tractar de la mateixa manera tota ella està dividida en dues subxarxes lògiques. La sentència <em>shared-network</em> s’utilitza en aquestes ocasions.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Les sentències d’àmbit d’aplicació més usuals són subnet i host, que permeten identificar una subxarxa i un host concret respectivament.</p>
<p>Les subxarxes es poden agrupar en shared-network, els clients es poden agrupar usant la sentència <strong>group</strong>.</p>
<p>Les opcions es poden definir en funció de determinats requisits que compleixi el client mitjançant la sentència <strong>class</strong> i les <strong>declaracions</strong> <strong>condicionals</strong>.</p>
</div>
</div>
<p>Quan els clients han de rebre una adreça IP dinàmica fixa, és a dir, han de rebre sempre la mateixa IP reservada, cal especificar la sentència <em>host</em>. Si es vol que tots els clients siguin únicament equips identificats cal fer una sentència <em>host</em> per a cada equip.</p>
<p>A vegades es vol establir configuracions que afecten equips i xarxes que no tenen una agrupació en forma de subxarxa clara. En aquests casos es pot optar per utilitzar la sentència <em>group</em>. Amb aquesta sentència es poden fer agrupacions d’elements diversos als quals se’ls assignen opcions comunes.</p>
<p>Una altra situació que es pot produir és voler agrupar clients segons determinades condicions que acompleixi el client (no únicament segons la seva MAC). La sentència class permet agrupar opcions segons la informació que envia el mateix client. A més a més, es poden utilitzar declaracions condicionals, és a dir, segons es compleixi o no una determinada condició aplicar unes declaracions o unes altres.</p>
<p>El següent és un exemple de l’esquema bàsic d’un fitxer de configuració dhcp:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">global parameters...</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"ioc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.ioc.org, ns2.ioc.org;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.0 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.1;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.10 204.254.239.30;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.32 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.33;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.42 204.254.239.62;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.64 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.65;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.74 204.254.239.90;</div>
</li>
<li class="li1">
<div class="de1">host grouxo <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/grouxo.img"</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 204.254.239.91;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">group-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"marxbrothers.ioc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">120</span>;</div>
</li>
<li class="li1">
<div class="de1">host zappo.test.isc.org <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host harpo.test.isc.org <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple podem observar que:</p>
<ul>
<li class="level1">
<div class="li">es defineixen opcions globals per a totes les xarxes, com per exemple el nom del domini, els servidors de noms (<acronym title="Domain Name System">DNS</acronym>) i els temps de les concessions.</div>
</li>
<li class="level1">
<div class="li">per a cada subxarxa es defineixen opcions específiques com poden ser per exemple l’interval d’adreces disponibles, el router de la subxarxa, etc. També es pot observar que en la subxarxa 204.254.239.64/27 es defineixen opcions particulars per al <em>host grouxo</em>. Concretament obté una adreça IP de l’interval fixa i un fitxer d’inicialització via TFTP.</div>
</li>
<li class="level1">
<div class="li">finalment l’exemple mostra com es poden definir opcions per agrupacions amb la sentència <em>group</em>. Els <em>hosts harpo</em> i <em>zappo</em> estan agrupats i reben un nom de domini particular, diferent al definit en les opcions globals. També se’ls defineix un valor de temps màxim de concessió diferent al global.</div>
</li>
</ul>
<p>Tot seguit es mostra un altre exemple d’estructura de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> on s’agrupen <em>hosts</em> en grups d’afinitats:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osOficines"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">49</span>:2b:<span class="nu0">57</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">80</span>:<span class="kw3">fc</span>:<span class="nu0">32</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd8 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">22</span>:<span class="nu0">46</span>:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osProfessorat"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd2 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">88</span>:2d:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd3 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:00:<span class="nu0">14</span>:<span class="nu0">11</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osAlumnes"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server alumni-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">11</span>:<span class="nu0">90</span>:<span class="nu0">23</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">91</span>:a7:<span class="nu0">8</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">...output suprimt ...</div>
</li>
<li class="li1">
<div class="de1">host ncd80 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="kw2">cc</span>:a:8f; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple s’han creat tres grups diferents segons si es tracta d’equips de les oficines, del professorat o dels alumnes. S’ha indicat individualment equip per equip mitjançant la sentència <em>host</em>. A cada grup se’ls assigna les opcions que els són comunes (en lloc de fer-ho repetidament dins de cada <em>host</em>). En aquest cas representa que els equips són terminals “ximples” que carreguen el sistema operatiu des de la xarxa. Cada grup carrega un sistema operatiu diferent. Oficines i professors el descarreguen del mateix servidor, mentre que els alumnes ho fan d’un altre anomenat <em>alumni-booter</em>.</p>
<p>Existeix un altre mecanisme per agrupar declaracions anomenat <em>pool</em> i que permet fer agrupacions d’adreces. Cada agrupació d’adreces o <em>pool</em> pot ser tractat de manera diferent. Es poden definir diferents pool dins d’una mateixa subxarxa (<em>subnet</em>). Possiblement, la millor manera d’entendre com funciona és mitjançant un exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">subnet 10.0.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option routers 10.0.0.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Unknown clients get this pool.</span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers noexisteixo.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">300</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.200 10.0.0.253;</div>
</li>
<li class="li1">
<div class="de1">allow unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Known clients get this pool.</span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.example.com, ns2.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">28800</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.5 10.0.0.199;</div>
</li>
<li class="li1">
<div class="de1">deny unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple la subxarxa 10.0.0.0/8 es divideix en dos <em>pool</em> d’adreces per ser tractats de manera diferent. En el primer s’assignen dinàmicament adreces IP de la 200 a la 253 i s’assigna també un servidor de noms inexistent. Seran clients d’aquest <em>pool</em> els equips que siguin no identificats (<em>unknown-clients</em>). En el segon pool s’accepten només clients coneguts, als quals s’assignen adreces IP de la 5 a la 199 i dos servidors de noms existents.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Polítiques d'accés</p>
<p>Per saber més de les polítiques d’accés es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>D’aquest exemple podem observar que la sentència <em>pool</em> permet establir polítiques d’accés (<em>permit lists</em>) definint quins clients poden accedir al <em>pool</em> i quins no. El tractament de les polítiques d’accés queda fora de l’abast d’aquest llibre, però és molt intuïtiu. La clàusula <em>allow</em> indica els clients amb accés i la clàusula <em>deny</em> els clients que no podran accedir al <em>pool</em>.</p>
</div>
<h4><a id="class"></a>Class</h4>
<div class="level4">
<p>Una de les eines més potents per agrupar clients és la sentència class. Els clients es poden tractar de manera diferent segons a quina classe pertanyin. Per determinar la classe del client es poden usar les dades que el mateix client proporciona. S’utilitzen sentències condicionals i tractament d’expressions (<em>conditional, match statement</em>) que s’avaluen per determinar si el client pertany o no a una classe. Per exemple es pot crear una classe amb tots aquells clients que contenen l’identificador “IOC”:</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Classes</p>
<p>Per saber més de les classes es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux. Per saber com tractar i avaluar expressions es pot consultar el manual dhcp-eval(5) en un sistema GNU/Linux. Per saber més de les opcions específiques es pot consultar el manual dhcp-options(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>Les classes es poden subdividir en subclasses que corresponen a valors específics que satisfan l’expressió de la classe. El tractament de les classes, condicions i expressions queda fora de l’abast d’aquest material. Per conèixer bé les classes cal conèixer el tractament d’expressions i les opcions específiques del <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
<h3><a id="sentencies_i_opcions_de_configuracio"></a>Sentències i opcions de configuració</h3>
<div class="level3">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es pot configurar amb multitud de sentències que es poden repassar de l’<acronym title="Request for Comments">RFC</acronym> 2131 i de la pàgina de manual dhcpd.conf(5). Examinem tot seguit alguna d’aquestes sentències.</p>
</div>
<h4><a id="declaracions"></a>Declaracions</h4>
<div class="level4">
<ul>
<li class="level1">
<div class="li"><strong>Include:</strong> include “filename”; Permet carregar el fitxer indicat i processar-lo com a fitxer de configuració. És una tècnica usual per dividir la configuració en mòduls.</div>
</li>
<li class="level1">
<div class="li"><strong>Shared-network:</strong> shared-network name { [ parameters ] [ declarations ] } Permet agrupar diverses subxarxes (subnet) en una mateixa declaració. S’utilitza quan una mateixa xarxa física es compon de diverses subxarxes lògiques.</div>
</li>
<li class="level1">
<div class="li"><strong>Subnet:</strong> subnet subnet-number netmask netmask { [ parameters ] [ declarations ] } Permet definir opcions per a una subxarxa concreta. És la sentència més usual en les definicions de configuració del servidor dhcp.</div>
</li>
<li class="level1">
<div class="li"><strong>Range:</strong> range [ dynamic-bootp ] low-address [ high-address]; Indica l’interval d’adreces dinàmiques disponibles per assignar. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> extreu les adreces dinàmiques d’aquest interval d’adreces.</div>
</li>
<li class="level1">
<div class="li"><strong>Host:</strong> host hostname { [ parameters ] [ declarations ] } Proporciona un àmbit de definició per a un equip concret. Les opcions que es defineixen dins d’una sentència <em>host</em> afecten únicament l’equip indicat. Es requereix una sentència <em>host</em> per poder fer assignacions dinàmiques fixes (assignar sempre la mateixa adreça IP basant-se en l’adreça MAC).</div>
</li>
<li class="level1">
<div class="li"><strong>Group:</strong> group { [ parameters ] [ declarations ] } S’utilitza per agrupar declaracions de manera que les opcions definides afectin el grup d’elements que conté. Aquests poden ser <em>shared-networks</em>, <em>subnets</em>, <em>hosts</em> i fins i tot altres grups.</div>
</li>
</ul>
</div>
<h4><a id="parametres"></a>Paràmetres</h4>
<div class="level4">
<p>Tot seguit es mostren alguns dels paràmetres que es poden definir en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ul>
<li class="level1">
<div class="li"><strong>authoritative</strong> authoritative; not authoritative; Indica si les respostes del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són autoritatives o no. Si ho són el servidor revocarà les adreces IP que ell no ha concedit.</div>
</li>
<li class="level1">
<div class="li"><strong>ddns-update-style</strong> ddns-update-style style; Pot ser <em>ad-hoc</em> o <em>interim</em> o <em>none</em>. Indica el tipus de <em>dynamyc <acronym title="Domain Name System">DNS</acronym></em> que s’utilitza.</div>
</li>
<li class="level1">
<div class="li"><strong>default-lease-time</strong> default-lease-time time; Indica el temps per defecte de les concessions. És el temps que es concedeix quan el client no requereix un període de temps concret.</div>
</li>
<li class="level1">
<div class="li"><strong>fixed-address</strong> fixed-address address [, address … ]; Permet assignar una o més adreces IP a un client.</div>
</li>
<li class="level1">
<div class="li"><strong>hardware</strong> hardware hardware-type hardware-address; Indica el tipus i el valor de l’adreça Mac d’un client. Aquest mecanisme és necessari per poder identificar un client de manera única, per exemple en una clàusula <em>host</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>max-lease-time</strong> max-lease-time time; Indica el temps màxim per a les concessions en segons.</div>
</li>
<li class="level1">
<div class="li"><strong>min-lease-time</strong> min-lease-time time; Indica el temps mínim que han de durar les concessions.</div>
</li>
<li class="level1">
<div class="li"><strong>next-server</strong> next-server server-name; Indica el nom o l’adreça IP del servidor TFTP del qual el client s’ha de descarregar el fitxer d’inicialització (o <em>boot</em>) indicat pel paràmetre <em>filename</em>. Si no s’indica s’utilitza el propi servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
</ul>
</div>
<h4><a id="opcions_de_configuracio"></a>Opcions de configuració</h4>
<div class="level4">
<p>Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> reben del servidor la configuració de xarxa. Usualment parlem de l’adreça IP i la màscara, però de fet poden rebre gran quantitat</p>
<p>de paràmetres de configuració de xarxa i informació sobre diversos serveis de xarxa disponibles. El client per la seva part pot sol·licitar paràmetres concrets al servidor. L’administrador de xarxa, quan configura el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, no ha d’especificar totes les opcions possibles (de fet són moltíssimes), sinó només aquelles que siguin necessàries per a cada client. Algunes opcions prenen valors per defecte i no cal especificar-les, d’altres no poden ser alterades pel servidor.</p>
<p>En aquest apartat es farà la llista de la majoria de paràmetres que corresponen a opcions globals de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Alguns paràmetres són indicats pel client, d’altres pel servidor i n’hi ha que són per defecte i no es poden modificar.</p>
<ul>
<li class="level1">
<div class="li"><strong>option bootfile-name</strong> bootfile-name text; Indica el nom del fitxer que el client s’ha de descarregar per tal d’iniciar el procés d’arrancada o <em>boot</em>. El fitxer es descarrega via TFTP del mateix servidor o de l’indicat amb l’opció <em>next-server</em>. Fa la mateixa funció que la sentència <em>filename</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>option dhcp-lease-time</strong> dhcp-lease-time uint32; Aquesta opció permet al client demanar al servidor la concessió per a un període concret de temps.</div>
</li>
<li class="level1">
<div class="li"><strong>option dhcp-message-type</strong> dhcp-message-type uint8; Indica el tipus de missatge <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que s’està enviant, tant pel client com pel servidor. Els tipus possibles són:</div>
<ul>
<li class="level2">
<div class="li">DHCPDISCOVER</div>
</li>
<li class="level2">
<div class="li">DHCPOFFER</div>
</li>
<li class="level2">
<div class="li">DHCPREQUEST</div>
</li>
<li class="level2">
<div class="li">DHCPDECLINE</div>
</li>
<li class="level2">
<div class="li">DHCPACK</div>
</li>
<li class="level2">
<div class="li">DHCPNAK</div>
</li>
<li class="level2">
<div class="li">DHCPRELEASE</div>
</li>
<li class="level2">
<div class="li">DHCPINFORM</div>
</li>
</ul>
</li>
<li class="level1">
<div class="li"><strong>option domain-name</strong> domain-name text; Indica el nom de domini que el client ha d’utilitzar per fer resolucions <acronym title="Domain Name System">DNS</acronym>.</div>
</li>
<li class="level1">
<div class="li"><strong>option domain-name-servers</strong> domain-name-servers ip-address [, ip-address… ]; Especifica la llista de servidors de noms de domini que el client ha d’utilitzar.</div>
</li>
<li class="level1">
<div class="li"><strong>option host-name</strong> host-name string; Especifica el nom del client.</div>
</li>
<li class="level1">
<div class="li"><strong>option netbios-name-servers</strong> netbios-name-servers ip-address [, ip-address…]; L’opció NetBios name server (NBNS) especifica una llista de servidors <acronym title="Request for Comments">RFC</acronym> 1001/1002 NBNS name servers en ordre de preferència. És a dir, indica la llista de servidors NetBios a usar pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option nis-servers</strong> nis-servers ip-address [, ip-address… ]; Especifica una llista de servidors <acronym title="Network Information Service">NIS</acronym> disponibles pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option ntp-servers</strong> ntp-servers ip-address [, ip-address… ]; Indica una llista de servidors NTP disponibles pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option routers</strong> routers ip-address [, ip-address… ]; Especifica una llista de routers disponibles pel client en la seva pròpia subxarxa.</div>
</li>
<li class="level1">
<div class="li"><strong>option tftp-server-name</strong> tftp-server-name text; Indica el nom del servidor TFTP.</div>
</li>
</ul>
</div>
<h3><a id="expressions"></a>Expressions</h3>
<div class="level3">
<p>Una de les grans potències que proporciona <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és poder configurar les opcions de xarxa en funció de qui i com és el client. És a dir, en funció de la informació que proporciona el client assignar-li una o altra configuració de xarxa. Fixeu-vos que no es tracta d’entrades <em>host</em> estàtiques per a cada client, sinó que un mateix client tindrà una o altra configuració segons la informació que proporcioni.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Avaluar expressions</p>
<p>Per obtenir més informació sobre expressions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i mecanismes d’avaluació cal consultar la pàgina de manual dhcp.eval(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>Per poder fer això cal poder avaluar expressions i condicions basades en la informació del mateix client. Existeix, doncs, tot un llenguatge per escriure expressions i avaluar-les.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El mecanisme per definir expressions és:</p>
<pre class="code">paràmetre = expressió ;</pre>
</div>
</div>
<p>Un exemple que mostra com definir el paràmetre ddns-hostname (que defineix el nom del client a usar en l’actualització dinàmica de <acronym title="Domain Name System">DNS</acronym>) usant part de l’adreça MAC del client:</p>
<ol>
<li class="li1">
<div class="de1">ddns-hostname = binary-to-ascii <span class="br0">(</span><span class="nu0">16</span>, <span class="nu0">8</span>, <span class="st0">"-"</span>, substring <span class="br0">(</span>hardware, <span class="nu0">1</span>, <span class="nu0">6</span><span class="br0">)</span><span class="br0">)</span>;</div>
</li>
</ol>
<p>Es poden construir expressions similars a les dels llenguatges de programació. Per fer-ho es disposa d’estructures condicionals i de diversos tipus d’operadors. Anem a analitzar-ne uns quants:</p>
<ul>
<li class="level1">
<div class="li"><strong>Estructures condicionals</strong> (<em>Conditional behaviour</em>). Permeten realitzar definicions segons sigui el valor d’una opció (o d’una expressió). Utilitza les conegudes estructures <em>if</em>, <em>elsif</em> i <em>else</em>.</div>
</li>
</ul>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Exemple de sentència condicional en el servidor</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#Extret de la pàgina de manual dhcpd.eval(5)</span></div>
</li>
<li class="li1">
<div class="de1"><span class="kw1">if</span> option dhcp-user-class = <span class="st0">"accounting"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"accounting.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.accounting.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.accounting.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> elsif option dhcp-user-class = <span class="st0">"sales"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"sales.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.sales.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.sales.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> elsif option dhcp-user-class = <span class="st0">"engineering"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"engineering.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.engineering.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.engineering.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"misc.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.misc.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.misc.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<div class="iocimportant">
<div class="ioccontent">
<p>En aquest exemple es defineixen les opcions <em>max-lease-time</em>, <em>domain-name</em> i <em>domain-name-servers</em> de manera diferent segons sigui el valor de l’opció <em>dhcp-user-class</em> enviat pel client.</p>
<p>Les definicions condicionals també es poden fer en la part client. L’exemple següent mostra que si el client no ha rebut el paràmetre <em>domain-name</em>, ell mateix autodefineix el valor del paràmetre <em>domain-name-servers</em> al <em>loopback</em>.</p>
</div>
</div>
<p>Exemple de sentència condicional en el servidor</p>
<p></p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Extret de la pàgina de manual dhcpd.eval(5)</span></div>
</li>
<li class="li1">
<div class="de1"><span class="kw1">if</span> not option domain-name = <span class="st0">"example.org"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">prepend domain-name-servers 127.0.0.1;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<ul>
<li class="level1">
<div class="li"><strong>Expressions booleanes</strong> (<em>Boolean expressions</em>). Igual que passa en els llenguatges de programació, permeten definir expressions utilitzant els operadors booleans clàssics: <em>=</em>, <em>and</em>, <em>or</em>, <em>not</em>, <em>exists</em>. També els operadors <em>known</em> i <em>static</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Expressions de tractament de text</strong> (<em>Data expressions</em>). Són similars a les típiques funcions de tractament de cadenes dels llenguatges de programació. Corresponen a: <em>substring</em>, <em>suffix</em>, <em>option</em>, <em>config-option</em>, <em>hardware</em>, <em>packet</em>, <em>concat</em>, <em>reverse</em>, <em>leased-address</em>, <em>binary-to-ascii</em>,<em>encode-int</em>, <em>pick-first-value</em> i <em>host-decl-name</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Expressions numèriques</strong> (<em>Numeric expressions</em>). Les expressions numèriques realitzen la seva avaluació retornant un enter. Són exemples d’aquesta categoria: <em>extract-int</em>, <em>lease-time</em> i <em>client-state</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Monitoratge</strong> (<em>Logging</em>). Es permeten definir expressions que s’enregistraran en els fitxers de monitoratge del sistema. És molt útil si es treballa amb definicions condicionals i expressions perquè permet fer un seguiment (com un <em>debug</em>) de com s’ha avaluat l’expressió o la condició.</div>
</li>
</ul>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Exemple de log</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#log (priority, data-expr) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#Les prioritats poden ser: fatal, error, info, debug</span></div>
</li>
<li class="li1">
<div class="de1">log <span class="br0">(</span>info, concat<span class="br0">(</span>hardware, <span class="kw2">hostname</span><span class="br0">)</span></div>
</li>
</ol>
<div class="iocimportant">
<div class="ioccontent">
<p>Aquest exemple generarà una entrada en el fitxer de <em>log</em> mostrant l’adreça Mac del client i el seu nom de <em>host</em>.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Actualitzacions <acronym title="Domain Name System">DNS</acronym> dinàmiques</strong> (<em>dynamic <acronym title="Domain Name System">DNS</acronym> updates</em>). El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot interactuar amb el servei <acronym title="Domain Name System">DNS</acronym> de manera que les concessions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> s’actualitzin automàticament en la base de dades <acronym title="Domain Name System">DNS</acronym>. Aquesta funció la poden fer tant els clients com els servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quan parlem d’actualitzacions dinàmiques del <acronym title="Domain Name System">DNS</acronym> estem parlant de DDNS (<em>dynamic domain name system</em>). Com cal fer aquestes actualitzacions i quina informació cal posar al <acronym title="Domain Name System">DNS</acronym> és el que es pot personalitzar amb aquestes opcions.</div>
</li>
</ul>
<div class="iocnote">
<div class="ioccontent">
<p>Per saber més de les actualitzacions dinàmiques de <acronym title="Domain Name System">DNS</acronym> consulteu l’<acronym title="Request for Comments">RFC</acronym> 2136.</p>
</div>
</div>
</div>
<h2><a id="configuracio_dels_parametres_de_xarxa_del_client"></a>Configuració dels paràmetres de xarxa del client</h2>
<div class="level2">
<p>Els clients de xarxa o bé tenen una configuració estàtica on es defineix cada paràmetre en el client o bé reben la configuració via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. El procés de configurar un client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és tan senzill com activar aquesta última opció usant algun dels mètodes adients.</p>
<p>La configuració dels clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> consisteix en el següent:</p>
<ul>
<li class="level1">
<div class="li">Observar la configuració de xarxa actual del client.</div>
</li>
<li class="level1">
<div class="li">Configurar el client per rebre dinàmicament una adreça IP. Es tracta d’activar/desactivar la configuració de xarxa dinàmica o estàtica.</div>
</li>
<li class="level1">
<div class="li">Sol·licitar/renegociar una nova IP al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar/fer la llista del fitxer de registre de les concessions client rebudes.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de xarxa en el client.</div>
</li>
</ul>
</div>
<h3><a id="observar_la_configuracio_de_xarxa_actual"></a>Observar la configuració de xarxa actual</h3>
<div class="level3">
<p>L’administrador ha de tenir la precaució d’observar quina és la configuració de xarxa actual abans d’establir-ne una de nova. Si cal ha de deixar anotada la configuració anterior per tal de poder restablir-la. La configuració de xarxa bàsica consisteix en l’adreça IP, la màscara de xarxa, la porta d’enllaç per defecte i el servidor <acronym title="Domain Name System">DNS</acronym> a utilitzar. També s’hi pot incloure el nom de l’equip, les rutes i multitud d’altres paràmetres.</p>
<p>Es pot fer la llista de la configuració de les interfícies ethernet i observar les adreces IP, l’estat de les interfícies (UP o DOWN) i les rutes definides fent:</p>
<p>Fer la llista de les adreces MAC i IP i les dades de les interfícies</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># ip address show</span></div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">1</span>: lo: <span class="sy0">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="sy0">&gt;</span> mtu <span class="nu0">16436</span> qdisc noqueue</div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div>
</li>
<li class="li1">
<div class="de1">inet 127.0.0.1<span class="sy0">/</span><span class="nu0">8</span> scope host lo</div>
</li>
<li class="li1">
<div class="de1">inet6 ::<span class="nu0">1</span><span class="sy0">/</span><span class="nu0">128</span> scope host</div>
</li>
<li class="li1">
<div class="de1">valid_lft forever preferred_lft forever</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">2</span>: eth0: <span class="sy0">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="sy0">&gt;</span> mtu <span class="nu0">1500</span> qdisc pfifo_fast qlen <span class="nu0">1000</span></div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>ether 00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e brd ff:ff:ff:ff:ff:ff</div>
</li>
<li class="li1">
<div class="de1">inet 192.168.1.34<span class="sy0">/</span><span class="nu0">24</span> brd 192.168.1.255 scope global eth0</div>
</li>
<li class="li1">
<div class="de1">inet6 fe80::<span class="nu0">217</span>:31ff:fe15:807e<span class="sy0">/</span><span class="nu0">64</span> scope <span class="kw2">link</span></div>
</li>
<li class="li1">
<div class="de1">valid_lft forever preferred_lft forever</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3</span>: sit0: <span class="sy0">&lt;</span>NOARP<span class="sy0">&gt;</span> mtu <span class="nu0">1480</span> qdisc noop</div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>sit 0.0.0.0 brd 0.0.0.0</div>
</li>
</ol>
<p>Fer la llista de les rutes definides en el host:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># ip route show</span></div>
</li>
<li class="li1">
<div class="de1">192.168.1.0<span class="sy0">/</span><span class="nu0">24</span> dev eth0 proto kernel scope <span class="kw2">link</span> src 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">169.254.0.0<span class="sy0">/</span><span class="nu0">16</span> dev eth0 scope <span class="kw2">link</span></div>
</li>
<li class="li1">
<div class="de1">default via 192.168.1.1 dev eth0</div>
</li>
</ol>
<p>Si s’observen els fitxers de configuració de les interfícies de xarxa, es pot veure si els paràmetres de xarxa estan definits estàticament o dinàmicament. En la llista següent es pot veure que la interfície <em>loopback</em> es configura estàticament i la interfície <em>eth0</em> es configura via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=eth0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BOOTPROTO</span>=dhcp</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">TYPE</span>=Ethernet</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-lo</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=lo</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">IPADDR</span>=127.0.0.1</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NETMASK</span>=255.0.0.0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NETWORK</span>=127.0.0.0</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># If you're having problems with gated making 127.0.0.0/8 a martian, </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># you can change this to something else (255.255.255.255, for example) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BROADCAST</span>=127.255.255.255</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NAME</span>=loopback</div>
</li>
</ol>
<p>Un error usual és creure que el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> no funciona correctament quan de fet el que passa és que el client no té el servei de xarxa activat. Es pot comprovar l’estat del servei de xarxa fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service NetworkManager status </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service network status </span></div>
</li>
<li class="li1">
<div class="de1">Dispositius configurats:</div>
</li>
<li class="li1">
<div class="de1">lo eth0</div>
</li>
<li class="li1">
<div class="de1">Dispositius actius actualment:</div>
</li>
<li class="li1">
<div class="de1">lo eth0</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Activar i desactivar el servei de xarxa:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># /etc/init.d/network stop</span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant la interficie eth0: [ FET ]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està aturant la interficie loopback: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># /etc/init.d/network start</span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està activant la interficie loopback: [ FET ]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està activant la interficie eth0:</div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està determinant la informació de la IP per a eth0... fet [FET]</span></div>
</li>
</ol>
</div>
<h3><a id="configurar_el_client_com_a_client_dinamic"></a>Configurar el client com a client dinàmic</h3>
<div class="level3">
<p>Tot equip client de xarxa necessita una configuració apropiada. Si aquesta configuració es defineix element per element en el mateix equip, s’anomena configuració estàtica. Si és així, no cal per res un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. És quan els clients reben la configuració de xarxa externament que parlem de configuració dinàmica i ens cal un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que la proporcioni.</p>
<p>La configuració del client es pot fer en mode text editant directament els fitxers de configuració de les interfícies de xarxa, utilitzant interfícies en mode text o utilitzant interfícies gràfiques (<em>applets</em>). Vegem cada un d’aquests mètodes.</p>
</div>
<h4><a id="editar_els_fitxers_de_configuracio"></a>Editar els fitxers de configuració</h4>
<div class="level4">
<p>Es pot editar directament el fitxer de configuració de la interfície pertinent i establir l’opció <em>BOOTPROTO</em> al valor <em>dhcp</em> per tal d’activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Si per exemple es configura la interfície <em>eth0</em> seria un fitxer similar al següent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=eth0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BOOTPROTO</span>=dhcp</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">TYPE</span>=Ethernet</div>
</li>
</ol>
</div>
<h4><a id="menus_amb_interficie_de_text"></a>Menús amb interfície de text</h4>
<div class="level4">
<p>Un altre mecanisme per activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és utilitzar alguna utilitat de menús en entorn de text (varien segons el sistema i n’hi ha de disponibles per Internet).</p>
<p>Una eina força utilitzada és la utilitat <em>setup</em> que es pot observar en la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura2"><span>figura</span>.2</a></span>, que mostra una configuració de client de xarxa estàtica i es pot veure que la casella que permet activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està desactivada.</p>
<div class="iocfigure"><a name="Figura2"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Configuració estàtica del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im2.png" alt="" /></figure>
<p></p>
</div>
<p>Observeu que senzill que és el procediment per activar el client de xarxa <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. N’hi ha prou d’activar l’opció pertinent, tal com es mostra en la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura3"><span>figura</span>.3</a></span>.</p>
<div class="iocfigure"><a name="Figura3"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Activació del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> usant menús de text</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im3.png" alt="" /></figure>
<p></p>
</div>
</div>
<h4><a id="menus_en_mode_grafic"></a>Menús en mode gràfic</h4>
<div class="level4">
<p>En mode gràfic el sistema també proporciona mecanismes per configurar les interfícies de xarxa i establir el mode d’activació a <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura4"><span>figura</span>.4</a></span> es pot observar que la configuració de la interfície <em>eth0</em> té activada l’opció per rebre la configuració de xarxa via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<div class="iocfigure"><a name="Figura4"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Activació del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> usant l’entorn gràfic</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im4.png" alt="" /></figure>
<p></p>
</div>
</div>
<h3><a id="demanar_una_nova_adreca_ip"></a>Demanar una nova adreça IP</h3>
<div class="level3">
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot alliberar l’adreça que utilitza quan ho creu pertinent. En fer-ho el servidor anota el fi de la concessió i si es tracta d’una adreça dinàmica d’interval aquesta torna a estar disponible per assignar-la a un altre client. Quan a un client se li està acabant el temps de la concessió ha de tornar a negociar una adreça amb el servidor. De totes maneres si el client vol, pot tornar a sol·licitar-ne una en un moment o altre.</p>
<p>El client pot alliberar una adreça (<em>release</em>) que està en ús un moment o altre, pot forçar-ho fent, per exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># dhclient -r </span></div>
</li>
<li class="li1">
<div class="de1">Internet Systems Consortium DHCP Client V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">DHCPRELEASE on eth0 to 192.168.1.1 port <span class="nu0">67</span></div>
</li>
</ol>
<p>Per forçar el client a demanar una nova adreça per a la interfície ethernet <em>eth0</em> es pot fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># dhclient eth0 </span></div>
</li>
<li class="li1">
<div class="de1">Internet Systems Consortium DHCP Client V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on Socket<span class="sy0">/</span>fallback</div>
</li>
<li class="li1">
<div class="de1">DHCPDISCOVER on eth0 to 255.255.255.255 port <span class="nu0">67</span> interval <span class="nu0">5</span></div>
</li>
<li class="li1">
<div class="de1">DHCPOFFER from 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">DHCPREQUEST on eth0 to 255.255.255.255 port <span class="nu0">67</span></div>
</li>
<li class="li1">
<div class="de1">DHCPACK from 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">bound to 192.168.1.34 <span class="re5">--</span> renewal <span class="kw1">in</span> <span class="nu0">38975</span> seconds.</div>
</li>
</ol>
</div>
<h3><a id="observar_el_registre_client_de_les_concessions_rebudes"></a>Observar el registre client de les concessions rebudes</h3>
<div class="level3">
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> porta un registre de les concessions rebudes, d’aquesta manera pot tornar a demanar una concessió abans que expiri l’actual. També pot servir per demanar al servidor preferentment una adreça IP concreta. Les concessions o <em>leases</em> del client es desen en un fitxer anomenat <em>/var/lib/dhclient/dhclient.leases</em>. Podem veure’n el contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># cat /var/lib/dhclient/dhclient.leases </span></div>
</li>
<li class="li1">
<div class="de1">lease <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">interface <span class="st0">"eth0"</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 192.168.1.34;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-lease-time <span class="nu0">86400</span>;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-message-type <span class="nu0">5</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 80.58.61.250,80.58.61.254;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-server-identifier 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"local.lan"</span>;</div>
</li>
<li class="li1">
<div class="de1">renew <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> 04:05:<span class="nu0">49</span>;</div>
</li>
<li class="li1">
<div class="de1">rebind <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> <span class="nu0">15</span>:<span class="nu0">12</span>:<span class="nu0">57</span>;</div>
</li>
<li class="li1">
<div class="de1">expire <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> <span class="nu0">18</span>:<span class="nu0">12</span>:<span class="nu0">57</span>;</div>
</li>
</ol>
</div>
<h2><a id="comprovacio_del_funcionament_dhcp"></a>Comprovació del funcionament DHCP</h2>
<div class="level2">
<p>La millor manera de comprovar el funcionament <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és simplement posant-lo en pràctica, és a dir, crear una xarxa amb diversos clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i un servidor que els atengui. Com es pot saber si funciona? Fàcil, mirant un a un cada client i comprovant que han rebut la configuració de xarxa correcta. El problema, però, és què fem si els clients no es configuren correctament.</p>
<p>Els passos més usuals a seguir per a la resolució de problemes són:</p>
<ul>
<li class="level1">
<div class="li">Comprovar que la xarxa està correctament connectada físicament, és a dir cables, connectors, interfícies, etc.</div>
</li>
<li class="level1">
<div class="li">Mirar si existeix connectivitat entre els equips, per exemple usant una configuració estàtica. Això permetrà descartar que els problemes siguin deguts a altres causes. Si el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> no va és que no està configurat correctament.</div>
</li>
<li class="level1">
<div class="li">Repassar la configuració del client i del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, especialment la del servidor. Es pot començar fent la configuració tan senzilla com sigui possible. Un cop funciona es pot anar avançant en la seva complexitat.</div>
</li>
<li class="level1">
<div class="li">Examinar els fitxers de concessions, tant el del client com el del servidor, per detectar-hi anomalies.</div>
</li>
<li class="level1">
<div class="li">Quan la comunicació client/servidor no funciona correctament i no sabem el perquè és molt útil monitorar el trànsit de xarxa mitjançant alguna eina d’anàlisi dels paquets que viatgen per la xarxa.</div>
</li>
</ul>
<p>Centrem-nos, doncs, en la monitoratge del trànsit de xarxa per tal d’analitzar que el diàleg entre el client i el servidor és l’apropiat. Existeixen moltes eines al mercat (que podeu trobar per Internet) que fan aquesta funció. Un de les més recomanables és l’aplicació <em>wireshark</em>. Amb aquesta eina hem de poder observar l’intercanvi dels paquets <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Discover</em>, <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Offer</em>, <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Request</em> i <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Ack</em> que es produeix quan tot el procés <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> funciona correctament. Si aquest intercanvi no es produeix és que existeix algun problema.</p>
<div class="iocreference">
<div class="ioccontent">
<p>En l’apartat “El model funcional del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>” podeu observar detalladament com és el diàleg entre el client i el servidor.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>En l’apartat “Demanar una nova adreça IP” es pot observar com forçar el client a demanar una nova configuració.</p>
</div>
</div>
<p>En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura5"><span>figura</span>.5</a></span> podeu observar una captura de trànsit <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> feta amb <em>Wireshark</em>. La captura s’ha fet al servidor i el client s’ha forçat a demanar de nou una configuració de xarxa amb la utilitat <em>dhclient</em>.</p>
<div class="iocfigure"><a name="Figura5"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Captura d’un diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client/servidor</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im5.png" alt="" /></figure>
<p></p>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>Podeu manipular vosaltres mateixos la captura del trànsit de xarxa <acronym title="Domain Name System">DNS</acronym> carregant el fitxer de captura del <em>wireshark</em> que es lliura com a material complementari. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.</p>
</div>
</div>
<p>A continuació es pot observar la llista de text de les quatre trames capturades amb el <em>wireshark</em> que s’han exportat en format text. Això permet veure detalladament tot el diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ol>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">1</span> <span class="nu0">0.000000</span> 0.0.0.0 255.255.255.255 DHCP DHCP Discover -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">1</span> <span class="br0">(</span><span class="nu0">590</span> bytes on wire, <span class="nu0">590</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span>, Dst Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Request <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Discover</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">57</span>,<span class="re2">l</span>=<span class="nu0">2</span><span class="br0">)</span> Maximum DHCP Message Size = <span class="nu0">548</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">55</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Parameter Request List</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">12</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Host Name = <span class="st0">"box"</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">2</span> <span class="nu0">0.000351</span> 192.168.1.34 192.168.1.254 DHCP DHCP Offer -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">2</span> <span class="br0">(</span><span class="nu0">342</span> bytes on wire, <span class="nu0">342</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: AsustekC_15:<span class="nu0">80</span>:7e <span class="br0">(</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="br0">)</span>, Dst: CadmusCo_b2:8b:ec</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 192.168.1.34 <span class="br0">(</span>192.168.1.34<span class="br0">)</span>, Dst: 192.168.1.254 <span class="br0">(</span>192.168.1.254<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span>, Dst Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Reply <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 192.168.1.254 <span class="br0">(</span>192.168.1.254<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Offer</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">54</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Server Identifier = 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">1</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Subnet Mask = 255.255.255.0</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">3</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Router = 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">6</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Domain Name Server = 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">15</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Domain Name = <span class="st0">"domain.org"</span></div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3</span> <span class="nu0">0.009004</span> 0.0.0.0 255.255.255.255 DHCP DHCP Request -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">3</span> <span class="br0">(</span><span class="nu0">590</span> bytes on wire, <span class="nu0">590</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span>, Dst Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Request <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Request</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">57</span>,<span class="re2">l</span>=<span class="nu0">2</span><span class="br0">)</span> Maximum DHCP Message Size = <span class="nu0">548</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">55</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Parameter Request List</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">12</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Host Name = <span class="st0">"box"</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">54</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Server Identifier = 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">50</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Requested IP Address = 192.168.1.254</div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">4</span> <span class="nu0">0.010712</span> 192.168.1.1 255.255.255.255 DHCP DHCP NAK -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">4</span> <span class="br0">(</span><span class="nu0">342</span> bytes on wire, <span class="nu0">342</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: XaviTech_7b:ff:1d <span class="br0">(</span>00:01:<span class="nu0">38</span>:7b:ff:1d<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 192.168.1.1 <span class="br0">(</span>192.168.1.1<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span>, Dst Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Reply <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x8000 <span class="br0">(</span>Broadcast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 192.168.1.1 <span class="br0">(</span>192.168.1.1<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP NAK</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">56</span>,<span class="re2">l</span>=<span class="nu0">31</span><span class="br0">)</span> Message = <span class="st0">"requested address not available"</span></div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
</ol>
</div>
<h2><a id="realitzar_documentacio_de_suport_a_l_usuari"></a>Realitzar documentació de suport a l'usuari</h2>
<div class="level2">
<p>Una de les facetes més ignorades en el camp de la informàtica és la confecció de manuals i documentació de suport. Com a clients molt sovint ens queixem que falta informació o que està mal redactada. Com a administradors de xarxa no trobem mai temps per anotar les coses. Mentre les tenim al cap no creiem necessari fer la documentació, quan no ho tenim al cap, ja ens és impossible fer-ho, i sovint, és just quan en faria falta haver-ho fet! Fem un repàs de la informació necessària que cal documentar, tant per a l’usuari com per a l’administrador.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Un altre exemple de captura <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es lliura com a material complementari. En aquesta captura hi ha dos servidors dhcp diferents en la xarxa i es poden observar paquets NACK. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.</p>
</div>
</div>
<p>El client ha de saber:</p>
<ul>
<li class="level1">
<div class="li">Com contactar amb el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quin programari ha d’utilitzar i com l’ha de configurar per fer ús del servei.</div>
</li>
<li class="level1">
<div class="li">Quina és la informació que s’obtindrà via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Cal saber visualitzar, consultar aquesta informació i saber què significa, per a què serveix.</div>
</li>
</ul>
<p>Així doncs, la documentació de l’usuari descriurà el procés per activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, amb captures de pantalla que facilitin aquest procés. Cal també exemples de llista de concessions rebudes, on són i com es poden consultar aquestes concessions. La part més important és mostrar un exemple de configuració de xarxa rebuda on es detalli el significat de cada element i explicar a l’usuari com fer aquesta consulta.</p>
<p>Un exemple d’informació a proporcionar podria ser el següent:</p>
<pre class="code">L'usuari pot consultar la concessió de xarxa amb l'ordre:
C:\&gt;ifconfig /all
Configuración IP de Windows
        Nombre del host . . . . . . . . . : nombre-29b9943f
        Sufijo DNS principal  . . . . . . : 
        Tipo de nodo. . . . . . . . . . . : híbrido
        Enrutamiento habilitado. . . . . .: No
        Proxy WINS habilitado. . . . .    : No
        Lista de búsqueda de sufijo DNS:    local.lan

Adaptador Ethernet Conexiones de red inalámbricas          :
        Estado de los medios. . . .: medios desconectados
        Descripción. . . . . . . . . . .  : Intel(R) PRO/Wireless 3945ABG Net Connection
        Dirección física. . . . . . . . . : 00-31-02-44-9F-5A

Adaptador Ethernet Conexión de área local          :
        Sufijo de conexión específica DNS : local.lan
        Descripción. . . . . . . . . . .  : Realtek RTL8168/8111 PCI-E Gigabit Ether NIC
        Dirección física. . . . . . . . . : 00-21-32-80-23-7D
        DHCP habilitado. . . . . . . . .  : No
        Autoconfiguración habilitada. . . : Sí
        Dirección IP. . . . . . . . . . . : 192.168.1.33
        Máscara de subred . . . . . . . . : 255.255.255.0
        Puerta de enlace predeterminada   : 192.168.1.1
        Servidor DHCP . . . . . . . . . . : 192.168.1.1
        Servidores DNS . . . . . . . . . .: 80.58.61.250
                                            80.58.61.254
        Concesión obtenida . . . . . . .  : jueves, 24 de septiembre de 2009 12:09:16
        Concesión expira . . . . . . . . .: jueves, 24 de septiembre de 2009 13:09:16</pre>
<p>Els principals valors de xarxa a destacar són: Adreça IP, màscara de xarxa, el router o porta d’enllaç predeterminada, el servidor dhcp amb el qual s’ha contactat, els servidors de noms <acronym title="Domain Name System">DNS</acronym> que s’utilitzen i quan expira la concessió.</p>
</div>
</div>
<div style="overflow: hidden; position: absolute; top: -5000px; height: 1px;">
<h1><a id="instal_lacio_de_serveis_de_configuracio_dinamica_de_sistemes"></a>Instal·lació de serveis de configuració dinàmica de sistemes</h1>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">DHCP</p>
<p><em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></em> és l’acrònim de <em>dynamic host configuration protocol</em>, en català, protocol de configuració dinàmica d’equips.</p>
</div>
</div>
<p>El servei <strong><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></strong> permet la configuració d’adreces IP, màscares, passarel·les per defecte i moltes altres opcions de configuració de manera totalment dinàmica.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Què fa el DHCP?</p>
<p>Una forma planera d’entendre el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten “que hi ha algú?”, “qui sóc jo?”. El servidor de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.</p>
</div>
</div>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Identificació dels equips de xarxa</p>
<p>L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.</p>
<p>Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina feixuga i repetitiva si no es disposa de serveis de xarxa que la facilitin.</p>
</div>
</div>
<h2><a id="el_servei_dhcp"></a>El servei DHCP</h2>
<div class="level2">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-se.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Avantatges DHCP</p>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> té diversos avantatges:</p>
<ul>
<li class="level1">
<div class="li">Evita errors i conflictes IP.</div>
</li>
<li class="level1">
<div class="li">Centralitza l’administració.</div>
</li>
<li class="level1">
<div class="li">Estalvia temps.</div>
</li>
<li class="level1">
<div class="li">Simplifica l’administració.</div>
</li>
</ul>
</div>
</div>
<p>Els principals avantatges d’utilitzar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són: d’una banda, evitar conflictes d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>; i, d’altra banda, poder fer l’administració centralitzada representa un estalvi de temps i de feina.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> simplifica l’administració de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.</p>
</div>
</div>
<p>La concessió dinàmica d’adreces IP i altres paràmetres de configuració de xarxa es realitza per a un període de temps determinat, que varia en funció de les necessitats del client i del servidor.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Exemples d'ús del servei DHCP</p>
<p>Els següents són alguns exemples d’ús del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li">En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduït, per exemple, minuts.</div>
</li>
<li class="level1">
<div class="li">Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (<acronym title="Internet Service Provider">ISP</acronym>) tindrà una concessió que segurament serà per hores.</div>
</li>
<li class="level1">
<div class="li">En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, els equips rebran concessions dinàmiques per períodes de temps molt llargs, per exemple, dies.</div>
</li>
</ul>
</div>
</div>
</div>
<h3><a id="configuracio_d_un_equip_de_xarxa"></a>Configuració d'un equip de xarxa</h3>
<div class="level3">
<p>Qualsevol equip que pertany a una xarxa requereix que es configuri amb uns paràmetres mínims, que són l’adreça IP, la màscara i la porta d’enllaç per defecte. L’adreça IP identifica l’equip de manera única, i la màscara permet determinar la xarxa o subxarxa en què es troba l’equip. Amb aquests dos paràmetres n’hi ha prou per tenir connectivitat en la xarxa. Si es vol disposar d’accés fora de la xarxa pròpia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir també la porta d’enllaç predeterminada. A part de la configuració bàsica, els equips poden necessitar (i de fet ho necessiten) més paràmetres de configuració com, per exemple: el nom del <em>host</em>, el servidor <acronym title="Domain Name System">DNS</acronym>, el fitxer d’iniciació a baixar, etc.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Tot equip de xarxa necessita disposar d’una <strong>adreça IP</strong> que l’identifica de manera única a la xarxa. Cal també una <strong>màscara</strong> per poder separar de l’adreça IP quina és la part d’<strong>adreça de xarxa</strong> i quina la part d’<strong>adreça de host</strong>. Finalment, és imprescindible disposar de l’adreça de la <strong>porta d’enllaç predeterminada</strong> o passarel·la per defecte (o <em>gateway</em>), per disposar d’accés a xarxes externes.</p>
</div>
</div>
<div class="iocexample">
<div class="ioccontent">
<p class="ioctitle">Exemple de configuració de xarxa d'un equip de casa:</p>
<p>La majoria d’usuaris disposen a casa d’un equip (o més) connectats a un router que proporciona l’accés a Internet. Aquest equip està configurat com a client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i en iniciar-se rep la configuració de xarxa del router. Podeu comprovar a casa quina configuració teniu. Una configuració d’exemple podria ser:</p>
<pre class="code">Dirección IP. . . . . . . . . . . : 192.168.1.33
Máscara de subred . . . . . . . . : 255.255.255.0
Puerta de enlace predeterminada   : 192.168.1.1
Servidor DHCP . . . . . . . . . . : 192.168.1.1
Servidores DNS . . . . . . . . . .: 80.58.61.250
                                    80.58.61.254</pre>
</div>
</div>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">L'inconvenient de la configuració estàtica</p>
<p>La configuració estàtica implica configurar els equips un a un. Fins i tot encara que es tingui accés remot als equips (per Telnet o <acronym title="Secure Shell">SSH</acronym>), com que cal modificar la configuració de xarxa no es pot fer assegut des de l’equip de l’administrador, sinó que cal anar equip per equip a modificar la configuració.</p>
</div>
</div>
<p>Aquest procés de configuració cal que es faci per a cada equip de la xarxa. Fer-lo manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les màscares. Qualsevol canvi en l’estructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. És evident que tota aquesta feinada no és agradable per a l’administrador de xarxa (i és molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una solució que permeti automatitzar la configuració de xarxa de cada equip de manera centralitzada.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Les opcions de configuració de xarxa es poden assignar a cada equip <strong>estàticament</strong> o es poden configurar de manera <strong>dinàmica</strong> utilitzant <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
</div>
<p>Com a administradors de xarxa, la gestió centralitzada que ens proporciona <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ens permet modificar la xarxa afegint, eliminant i redefinint, equips amb un cost mínim.</p>
</div>
<h3><a id="tipus_d_assignacions_d_adreces_ip"></a>Tipus d'assignacions d'adreces IP</h3>
<div class="level3">
<p>Cada equip de xarxa té assignada una adreça IP que l’identifica de manera única dins la xarxa. La composició de l’adreça IP i la màscara determina la xarxa o subxarxa a la qual pertany. A més a més, es configuren altres paràmetres de xarxa com la porta d’enllaç predeterminada, servidors <acronym title="Domain Name System">DNS</acronym>, etc. Això es pot configurar manualment anant equip per equip i introduint aquesta informació.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Reconfiguració d'una xarxa</p>
<p>Imagineu la diversió de l’administrador d’una xarxa corporativa de 1.000 equips amb adreces estàtiques quan cal reconfigurar-la en un cap de setmana!</p>
</div>
</div>
<div class="iocimportant">
<div class="ioccontent">
<p>Quan l’adreça IP i els altres paràmetres necessaris de configuració de la xarxa es configuren equip per equip, manualment, es diu que tenen <strong>IP estàtica</strong>.</p>
</div>
</div>
<p>Quan la configuració de xarxa d’un equip no es fa manualment i localment en l’equip sinó que es rep per mitjà d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, es diu que l’equip utilitza una <strong>IP dinàmica</strong>. Per realitzar configuracions de xarxa dinàmicament caldran un o més servidors de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (a manera de redundància) que proporcionaran la configuració als equips clients (els que cal configurar). Per tant, serà una estructura client-servidor. Les adreces IP dinàmiques que rep el client les podem classificar en dues categories: <strong>assignació dinàmica d’interval</strong> i <strong>assignació fixa</strong>.</p>
<p>El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> disposa d’un interval d’adreces que pot assignar als clients que demanen una adreça IP. Quan el servidor assigna una adreça qualsevol de l’interval al client (a l’atzar) es tracta d’una assignació dinàmica d’interval. El client no sap quina adreça IP tindrà i no hi ha manera de predir quina adreça se li concedirà en una futura configuració. A cada nova assignació l’adreça IP pot ser diferent.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">MAC</p>
<p>Cada interfície de xarxa s’identifica de manera única físicament per l’adreça MAC (<em>media acces control</em>, adreça d’accés al medi).</p>
</div>
</div>
<p>Una assignació fixa es produeix quan el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sempre assigna la mateixa adreça al client. Per assignar sempre la mateixa adreça IP al client</p>
<p>cal que el servidor pugui identificar inequívocament el client (per l’adreça MAC). El servidor disposa d’una taula amb les correspondències entre les adreces MAC i les adreces IP fixes.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Quan la configuració de xarxa d’un equip es rep per mitjà d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es diu que utilitza una adreça IP <strong>dinàmica</strong>. Aquesta adreça pot variar dins d’un <strong>interval</strong> d’adreces disponibles per al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> o pot ser <strong>fixa</strong>.</p>
</div>
</div>
<p>Els avantatges de disposar d’una IP fixa són que la vostra identificació a Internet (la vostra adreça IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips, els clients us identifiquen sempre amb la mateixa adreça sense haver de recordar en cada moment quina adreça IP teniu avui (com passa en el cas d’una IP dinàmica).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">DNS dinàmic</p>
<p>Hi ha serveis de <acronym title="Domain Name System">DNS</acronym> dinàmic (DDNS) que permeten assignar un nom de domini a equips amb adreça IP dinàmica.</p>
</div>
</div>
</div>
<h2><a id="el_protocol_dhcp_i_els_seus_components"></a>El protocol DHCP i els seus components</h2>
<div class="level2">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ve descrit, com la majoria de protocols de xarxa, per un document <em>oficial</em> anomenat <acronym title="Request for Comments">RFC</acronym>. Al llarg dels anys ha sofert diverses evolucions per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diàleg entre els equips que hi intervenen, ens caldrà doncs analitzar quin és i com es produeix aquest diàleg. Finalment es descriurà el significat de termes tan usuals en <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> com <em>intervals</em>, <em>exclusions</em>, <em>concessions</em> i <em>reserves</em>.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Què són els RFC?</p>
<p>Els Request for Comments (<acronym title="Request for Comments">RFC</acronym>) són memoràndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies d’Internet. Quan els publica l’IETF (Internet Engineering Task Force) defineixen a escala mundial els protocols i les seves revisions. És a dir, són les publicacions oficials que descriuen els protocols.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>Per trobar especificacions dels protocols d’Internet, vegeu la secció “Més informació” del web d’aquest mòdul.</p>
</div>
</div>
</div>
<h3><a id="evolucio_del_protocol_dhcp"></a>Evolució del protocol DHCP</h3>
<div class="level3">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un servei del tipus client-servidor que proporciona la configuració de xarxa als clients que ho sol·liciten. Proporciona els paràmetres bàsics de xarxa com l’adreça IP, la màscara de xarxa, la porta d’enllaç i també d’altres paràmetres necessaris per a una connexió en una xarxa IP. Es tracta d’un protocol de la capa d’aplicació del model TCP/IP.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està basat en l’arquitectura de serveis client-servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>L’<acronym title="Request for Comments">RFC</acronym> 951 és el document base que descriu el protocol BOOTP.</p>
</div>
</div>
<p>La configuració dinàmica d’equips de xarxa es va iniciar amb el protocol BOOTP (BOOT <em>strap protocol</em>, protocol d’arrencada). Un protocol més bàsic que principalment permetia definir l’adreça IP, la màscara de xarxa i la passarel·la per defecte per al client. El protocol BOOTP (<acronym title="Request for Comments">RFC</acronym> 951, any 1985) és un protocol pensat per proporcionar automàticament la IP a clients de xarxa en el procés d’arrencada. Originàriament s’utilitzava per a estacions de treball sense disc que obtenien la configuració de xarxa del protocol BOOTP i també obtenien el nom d’un fitxer d’arrencada que s’havia de baixar per mitjà del TFTP, que usualment era el sistema operatiu.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">RFC de DHCP</p>
<p>Principals <acronym title="Request for Comments">RFC</acronym> dedicades a <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 2131. Març 1997. <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>dynamic host configuration protocol</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 2132. <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>options</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 3396. <em>Encoding long options</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 4361. <em>No especific client identifications for dhcpv4.</em></div>
</li>
<li class="level1">
<div class="li"><acronym title="Request for Comments">RFC</acronym> 3315. DHCPv6 <em>dinamic host configuration protocol</em> <em>Ipv6.</em></div>
</li>
</ul>
</div>
</div>
<p>El BOOTP va donar pas al protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, que n’és una evolució amb moltes més prestacions. El <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sorgeix l’octubre del 1993 a través de l’<acronym title="Request for Comments">RFC</acronym> 1531. Ràpidament evoluciona per mitjà de diverses <acronym title="Request for Comments">RFC</acronym>, com l’<acronym title="Request for Comments">RFC</acronym> 1541 el mateix any 1993, que serà substituïda per l’<acronym title="Request for Comments">RFC</acronym> 2131 el març del 1997. Aquest document és la base del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> actual. A grans trets, el protocol es descriu en l’<acronym title="Request for Comments">RFC</acronym> 2131 per a xarxes Ipv4, el conjunt d’opcions de configuració de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es descriuen en l’<acronym title="Request for Comments">RFC</acronym> 2132, i l’especificació de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a xarxes Ipv6 és en l’<acronym title="Request for Comments">RFC</acronym> 3315.</p>
</div>
<h3><a id="el_model_funcional_del_protocol_dhcp"></a>El model funcional del protocol DHCP</h3>
<div class="level3">
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Ports DHCP</p>
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza UDP en la capa de transport. Utilitza dos ports:</p>
<ul>
<li class="level1">
<div class="li">Port 67, on escolta el servidor.</div>
</li>
<li class="level1">
<div class="li">Port 68, on escolta el client.</div>
</li>
</ul>
</div>
</div>
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> descriu el diàleg que es produeix entre client i servidor per a la concessió de configuracions IP. En una xarxa amb configuració d’equips dinàmica, un o més servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> escoltaran les peticions dels clients en el port 67. Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sol·licitaran al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> una configuració IP, i començarà un procés de negociació que ha d’acabar (si tot va bé) amb la concessió d’una adreça IP al client. Els servidors parlen al port 68 dels clients.</p>
<p>La negociació que s’estableix es pot definir a grans trets de la manera següent:</p>
<ol>
<li class="level1">
<div class="li">El client sol·licita una adreça IP (de fet, una configuració de xarxa).</div>
</li>
<li class="level1">
<div class="li">El servidor mira les adreces IP disponibles dins de l’interval d’adreces dinàmiques de què disposa per concedir i n’ofereix una al client.</div>
</li>
<li class="level1">
<div class="li">Si el client l’accepta, envia una sol·licitud al servidor per fer-la seva.</div>
</li>
<li class="level1">
<div class="li">Si al servidor li sembla bé, accepta la petició del client i li confirma que pot utilitzar aquesta IP, que la hi concedeix per un període de temps limitat.</div>
</li>
</ol>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">UDP en les transmissions DHCP</p>
<p>L’intercanvi d’informació entre client i servidor no és gaire gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). És per això que el protocol que s’utilitza en les transmissions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és l’UDP.</p>
</div>
</div>
<p>La concessió de l’adreça IP és per un període de temps establert pel servidor. Això significa que, transcorregut aquest període, el client haurà de renegociar la concessió en un procés similar al descrit anteriorment. En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura1"><span>figura</span>.1</a></span> es pot veure el diàleg de quatre fases client-servidor.</p>
<p>El procés real, però, és més detallat. El podem repassar: consta principalment de quatre parts: la petició del client o <em>discovery</em>, l’oferta del servidor o <em>offer</em>, l’acceptació de l’adreça IP pel client o <em>request</em>, i la confirmació del servidor o <em>acknowledgement</em>. A part d’aquest tipus de missatges, el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en defineix d’altres com el de petició d’informació o <em>information</em> i el d’alliberament de l’adreça IP o <em>releasing</em>.</p>
<div class="iocfigure"><a name="Figura1"></a>
<p></p>
<figure>
<figcaption style="width: 355px; max-width: 75%;"><span class="figuretitle">Figura</span> Model funcional del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im1.png" alt="" /></figure>
<p></p>
</div>
<p>Els següents són els tipus de paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ul>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discover</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>ack</em> / <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>nack</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>decline</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>release</em>.</div>
</li>
<li class="level1">
<div class="li"><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em>.</div>
</li>
</ul>
</div>
<h4><a id="dhcp_discover"></a>DHCP discover</h4>
<div class="level4">
<p>En un procés de configuració IP d’un client de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> el paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discover</em> és el primer que s’envia. L’envia el client per tal de demanar una configuració IP a algun servidor. Generalment, el client s’acaba d’inicialitzar i vol obtenir una configuració dinàmica de xarxa. El client no sap a quina xarxa pertany (no té adreça IP ni màscara de xarxa) i tampoc sap quins servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> hi ha en la xarxa (si n’hi ha cap).</p>
<div class="iocnote">
<div class="ioccontent">
<p>Una difusió o broadcast s’adreça a la IP 255.255.255.255 o a l’adreça MAC FF:FF:FF:FF, que és acceptada per tots els equips.</p>
</div>
</div>
<p>Per tant, el client genera un paquet de difusió (<em>broadcast</em>) destinat a tots els equips de la xarxa on sol·licita una configuració IP. En la xarxa pot haver-hi cap, un o més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per atendre aquesta petició. És responsabilitat de l’administrador de xarxes configurar correctament l’estructura i els serveis de xarxa de forma que si defineix clients de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> hi hagi servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que atenguin les seves peticions.</p>
</div>
<h4><a id="dhcp_offer"></a>DHCP offer</h4>
<div class="level4">
<p>En rebre una sol·licitud de configuració d’un client (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>), un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> mira d’atendre-la proporcionant una IP de l’interval d’adreces dinàmiques que gestiona (hi pot haver més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en la mateixa xarxa).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Diversos servidors DHCP</p>
<p>Es pot configurar més d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, tant per a còpia de seguretat o <em>backup</em> com per incrementar el rendiment en compartir la càrrega de les peticions.</p>
</div>
</div>
<p>El servidor tracta d’assignar una IP del conjunt o interval (també anomenat <em>pool</em>) d’adreces dinàmiques que gestiona. Per fer-ho, ha de mirar quines de les adreces li queden lliures i disponibles per concedir al client. Cada vegada que el servidor concedeix una IP a un client, ho anota en un fitxer de registre de les concessions efectuades. Cada vegada que finalitza una concessió, el servidor pot tornar a utilitzar la IP per a un altre client.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Tota <strong>concessió</strong> (o <em>lease</em>) <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és per un període determinat de temps i un cop transcorregut cal renovar-la.</p>
</div>
</div>
<p>El mecanisme que utilitza el servidor per escollir la IP dins del conjunt d’adreces IP disponibles varia en funció del programa de servidor que s’utilitzi. A més a més es poden configurar innumerables opcions del servidor per establir com s’han de fer les concessions. Un cas típic és el de les adreces fixes. A un determinat client sempre se li assigna la mateixa IP. Per això cal disposar de la llista d’adreces MAC dels clients als quals es vol assignar una IP fixa.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Tipus d'adreçament</p>
<p>Hi ha diversos tipus d’adreçament:</p>
<ul>
<li class="level1">
<div class="li">Unidestinació o <em>unicast</em>: a un equip</div>
</li>
<li class="level1">
<div class="li">Multidestinació <em>multicast</em>: a un conjunt d’equips</div>
</li>
<li class="level1">
<div class="li">De difusió o <em>broadcast</em>: a tothom.</div>
</li>
</ul>
</div>
</div>
<p>El servidor selecciona una IP disponible i la reserva per al client (encara no està assignada). Tot seguit envia un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em> (unidestinació o <em>unicast</em>) al client amb tota la informació de configuració requerida. L’adreça IP i MAC origen identifiquen el servidor que fa l’oferta. El destinatari s’indica per la seva adreça MAC (que és coneguda). El camp IP del destinatari és l’adreça IP que el servidor ofereix (penseu que el client encara no té IP). Un altre concepte important és per quant de temps es realitza la concessió. El paquet inclou més camps per completar la resta de configuració de xarxa, per exemple, la porta d’enllaç per defecte, els servidors <acronym title="Domain Name System">DNS</acronym>, etc.</p>
</div>
<h4><a id="dhcp_request"></a>DHCP request</h4>
<div class="level4">
<p>Quan el client rep una oferta de configuració IP per part d’un servidor, la pot acceptar o rebutjar. Si el client no accepta l’oferta, simplement realitzarà un <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em> de nou. Això és suficient perquè el servidor s’adoni que l’oferta ha estat rebutjada.</p>
<p>Si el client accepta l’oferta, ho ha de comunicar al servidor. El mecanisme per fer-ho és mitjançant un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em> enviat un altre cop per difusió. A hores d’ara, el client encara no disposa de l’adreça IP per utilitzar-la. El servidor l’ha reservat, però encara no ha donat el sí definitiu perquè sigui concedida al client.</p>
<p>El motiu pel qual el client demana quedar-se la concessió (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>) que ha rebut utilitzant difusió és fer públic a tothom de la xarxa que ha acceptat una oferta d’un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> concret. Recordeu que la petició del client es fa per difusió i, per tant, pot rebre ofertes de diferents servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pública quina oferta accepta, la resta de servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> entenen que la seva oferta s’ha rebutjat.</p>
</div>
<h4><a id="dhcp_ack_dhcp_nack"></a>DHCP ack/DHCP nack</h4>
<div class="level4">
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">ACK i NACK</p>
<p>ACK i NACK són dos acrònims usuals en el món de la informàtica que signifiquen confirmació (acceptació) i no-conformitat (refús) respectivament.</p>
</div>
</div>
<p>L’últim pas en una negociació <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> bàsica el realitza el servidor quan finalment autoritza la concessió enviant el paquet DHCPACK (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>akcnowledgement</em>). A partir d’aquest moment, el client sí pot fer ús de l’adreça IP i de la configuració de xarxa rebuda. DHCPACK inclou tota la informació referent a la durada de la concessió i les dades necessàries per gestionar quan expira.</p>
<p>El servidor anotarà en el registre de concessions la que acaba de realitzar i detallarà tots els aspectes d’aquesta, en especial el temps de concessió. El paquet d’acceptació de la concessió DHCPACK és un paquet unidestinació adreçat a la MAC del client. Recordeu que el client encara no disposa d’una adreça IP vàlida, en disposarà en rebre el DHCPACK.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Exemple de mala configuració d'un equip</p>
<p>Un exemple de mala configuració és la d’un equip que s’ha engegat amb una adreça IP estàtica errònia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si l’adreça IP ja està essent utilitzada és fer un ping. Si ningú no respon és que està lliure (segurament).</p>
</div>
</div>
<p>Quan un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> detecta que la IP que havia reservat per a un client i que li anava a concedir ja està en ús, el servidor envia al client un paquet DHCPNACK i indica la no-autorització de la concessió. El client que rep un DHCPNACK ha de tornar a iniciar tot el procés de negociació començant un altre cop pel <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>.</p>
<p>Com és possible que algun equip de la xarxa utilitzi una adreça IP que forma part del conjunt d’adreces IP dinàmiques que reparteix el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>? La resposta és senzilla: perquè hi ha algun equip mal configurat.</p>
</div>
<h4><a id="dhcp_decline"></a>DHCP decline</h4>
<div class="level4">
<p>Per la seva part, el client també pot examinar l’adreça IP oferta pel servidor per comprovar si està en ús o no. Pot fer altres proves per veure si li sembla correcta o no l’oferta rebuda del servidor. Per exemple, en el cas de renovació d’una IP el client pot rebre una IP diferent a la que utilitza i no li interessa. En aquests casos, el client pot enviar un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>decline</em> al servidor per indicar que la seva oferta ha estat rebutjada.</p>
</div>
<h4><a id="dhcp_release"></a>DHCP release</h4>
<div class="level4">
<p>Quan un client ja no necessita més l’ús de la configuració IP que ha rebut, la pot alliberar enviant al servidor un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>release</em>. En fer-ho, el servidor afegeix l’adreça IP al conjunt d’adreces dinàmiques que té disponibles. També fa l’anotació pertinent en el registre de concessions (<em>leases</em>) per indicar que ha finalitzat l’ús de l’adreça. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquè és apagat per l’usuari sense deixar temps al sistema per alliberar la IP.</p>
</div>
<h4><a id="dhcp_information"></a>DHCP information</h4>
<div class="level4">
<p>En tot moment el client pot sol·licitar més informació sobre la configuració de xarxa al servidor utilitzant un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em>. En el paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>offer</em> que el servidor envia al client, consten les informacions generals de configuració de xarxa que es trameten en l’oferta: adreça IP, màscara de xarxa, porta d’enllaç predeterminada, servidor <acronym title="Domain Name System">DNS</acronym>, fitxer a baixar i molts altres paràmetres que poden estar configurats per enviar-se en l’oferta. El client pot tornar a demanar al servidor la informació d’aquests paràmetres o pot sol·licitar informació per a la configuració d’altres paràmetres (WINS, NetBIOS, <em>hostname</em>, etc.). El client només pot realitzar una petició d’informació <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>information</em> al servidor un cop ja està configurat.</p>
</div>
<h4><a id="peticio_de_renovacio_concessio_d_una_ip_concreta"></a>Petició de renovació/concessió d'una IP concreta</h4>
<div class="level4">
<p>El procés de quatre fases usuals de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> consistent en <em>discovery/offer/request/ack</em> es produeix quan el client sol·licita una IP de nou. Sabem que les concessions són per a un interval de temps passat, la renovació de la qual cal que el client la demani. Existeix, doncs, un procés de renovació simplificat. El client demana continuar usant la mateixa IP amb un paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>request</em>, i el servidor li concedeix o no amb els paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ACK/NACK.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Macchange</p>
<p>L’ordre GNU permet (<em>mascarade</em>) emmascarar l’adreça MAC pròpia. Compte! No feu dolenteries.</p>
</div>
</div>
<p>Un altre cas és un client que demana usar (renovar) una adreça IP que el servidor no li pot concedir (està en ús, no és de l’interval que gestiona, etc.). En aquesta situació, el servidor envia un <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> NACK.</p>
</div>
<h3><a id="atacs_al_funcionament_de_dhcp_i_conflictes_d_adreces_ip"></a>Atacs al funcionament de DHCP i conflictes d'adreces IP</h3>
<div class="level3">
<p>vei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em> fingint que són clients diferents (emmascarant la seva MAC) amb la intenció d’esgotar les adreces IP disponibles del servidor o simplement amb la intenció de sobrecarregar-lo amb tantes peticions que no doni a l’abast a atendre-les o que ho faci lentament.</p>
<p>Un altre tipus d’atac consisteix a falsejar la informació que s’envia al client. Recordem que el client fa una sol·licitud d’IP en forma de difusió (<em>broadcast</em>) i la seva petició pot ser atesa per un o més servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Un dels servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot ser un atacant que intentarà proporcionar informació de configuració falsa al client. Per exemple indicant un servidor <acronym title="Domain Name System">DNS</acronym> també maliciós. Aquest pot falsejar les identitats de les màquines de la xarxa i, quan el client s’adreça a la seva entitat bancària, el servidor <acronym title="Domain Name System">DNS</acronym> en realitat li ha proporcionat una IP d’una màquina que falseja la de l’entitat bancària. Perillós, oi?</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Tipus d'atacs DNS</p>
<p>Clients no autoritzats: accés a servidors <acronym title="Domain Name System">DNS</acronym> per part de clients no autoritzats. Servidors no autoritzats: servidors <acronym title="Domain Name System">DNS</acronym> impostors que suplanten els vertaders servidors.</p>
</div>
</div>
<p></p>
<p>Per posar remei a la inseguretat en la comunicació client-servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, el protocol permet utilitzar mecanismes d’autenticació i xifratge. Aquests mecanismes queden fora de l’abast d’aquesta explicació.</p>
</div>
<h4><a id="conflictes_amb_les_adreces_ip"></a>Conflictes amb les adreces IP</h4>
<div class="level4">
<p>Un dels principals motius per utilitzar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és simplificar el procés de configuració de xarxa i minimitzar els conflictes per encavalcament d’adreces IP. Per desgràcia, això no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en què dues màquines diferents tinguin la mateixa IP per una simple mala configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Un altre cas típic és el d’un client que s’ha configurat ell mateix una IP estàtica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreça IP assignada pel servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Un problema habitual per als administradors poc experimentats és definir una configuració de xarxa local al client (<em>hostname</em>, servidor <acronym title="Domain Name System">DNS</acronym>, porta d’enllaç a utilitzar, etc.), però demanar l’adreça IP dinàmicament. La configuració dinàmica no és solament la IP i la màscara, sinó que el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot proporcionar altres paràmetres de xarxa que sobreescriuran els que el client tenia definits localment (aquest és l’objectiu de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>!).</p>
<div class="iocreference">
<div class="ioccontent">
<p>La configuració rebuda per <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sobreescriu la configuració local del client.</p>
</div>
</div>
</div>
<h3><a id="intervals_exclusions_concessions_i_reserves"></a>Intervals, exclusions, concessions i reserves</h3>
<div class="level3">
<p>Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> obtenen del servidor una configuració de xarxa. Descrivim ara alguns dels termes que tenen lloc durant aquest procés, i que formen part de la configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ul>
<li class="level1">
<div class="li"><strong>Interval</strong>: anomenen <em>interval d’adreces IP</em> el conjunt d’adreces dinàmiques que el servidor té disponibles per assignar als clients. Les adreces IP disponibles s’agrupen per oferir-se a les diverses subxarxes que atén el servidor. Una mateixa subxarxa pot disposar de diversos intervals. Segurament s’entendrà més fàcilment amb un exemple:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
              range 140.220.191.150 140.220.191.249;
            }

  subnet 239.252.197.0 netmask 255.255.255.0 {
              range 239.252.197.10 239.252.197.107;
              range 239.252.197.113 239.252.197.250;
            }</pre>
<div class="iocimportant">
<div class="ioccontent">
<p>En l’exemple anterior s’observa que la primera subxarxa disposa d’un interval de 100 adreces dinàmiques (de la 140.220.191.150 al 250). La segona subxarxa permet assignar dinàmicament dos intervals d’adreces no correlatius.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Exclusions</strong>: entenem per <em>exclusions</em> aquelles adreces IP que no s’ofereixen dinàmicament per part del servidor. És a dir, que no formen part de cap interval.</div>
</li>
<li class="level1">
<div class="li"><strong>Concessions</strong>: l’assignació d’una adreça IP i la resta de paràmetres de xarxa a un client per part del servidor, és una concessió (o <em>leasse</em>). Els clients reben les concessions per períodes de temps finits, que en finalitzar, cal renegociar. Tant el client com el servidor s’anoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessió el servidor pot decidir revocar-la o ampliar-ne la concessió.</div>
</li>
</ul>
<div class="iocimportant">
<div class="ioccontent">
<p>El client tothora pot decidir renunciar a la concessió. Si el client vol allargar la concessió inicia un diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> abreujat amb el servidor que pot acabar amb una renovació o amb la pèrdua de la concessió (sempre pot tornar a començar el procés). Tant el servidor com el client normalment miren les concessions que s’han efectuat entre ells amb anterioritat per tal de, si és possible, repetir la mateixa assignació.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Reserves</strong>: anomenem <em>reserves</em> aquelles adreces IP que s’assignen via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> però de manera fixa. És a dir, són adreces que s’assignen dinàmicament però sempre i únicament a un <em>host</em> determinat. Fixeu-vos que tot i ser una adreça dinàmica només s’utilitza si el <em>host</em> associat en fa ús. Si el <em>host</em> està apagat l’adreça no es pot usar per a altres <em>hosts</em>, està reservada. Un exemple podria ser:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
       host iocserver {
           hardware ethernet 08:00:2b:4c:59:23;
           fixed-address 140.220.191.1;
       }
      range 140.220.191.150 140.220.191.249;
       }</pre>
<div class="iocimportant">
<div class="ioccontent">
<p>En aquest exemple es pot veure que l’adreça <em>140.220.191.1</em> és una adreça reservada exclusivament per al <em>host</em> iocserver, que s’identifica mitjançant la seva adreça MAC.</p>
</div>
</div>
</div>
<h3><a id="dhcp_un_servei_client_servidor"></a>DHCP un servei client/servidor</h3>
<div class="level3">
<div class="iocreference">
<div class="ioccontent">
<p>Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.</p>
</div>
</div>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un més dels serveis de xarxa que tenen l’estructura client /servidor. Els servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són els equips que tenen en execució el programa servidor. És el programa encarregat d’atendre les peticions dels clients i oferir-los la configuració de xarxa, tot portant el registre de les IP que concedeix i el registre de totes les accions que realitza. Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són aquells equips que realitzen peticions per obtenir una configuració de xarxa a un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
<h4><a id="el_client_dhcp"></a>El client DHCP</h4>
<div class="level4">
<p>Un equip client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un equip que sol·licita la IP i altres paràmetres de configuració de xarxa a un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en lloc de tenir-los definits localment en l’equip.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">ISP</p>
<p><acronym title="Internet Service Provider">ISP</acronym>: <em>Internet service provider</em> o proveïdor de servei/accés a Internet. Ho són per exemple les empreses Ono, Vodafone, Jazztel, etc.</p>
</div>
</div>
<p>Si connecteu el vostre equip informàtic a la xarxa Internet per mitjà d’un <acronym title="Internet Service Provider">ISP</acronym> (<em>Internet service provider</em> o proveïdor de servei/accés a Internet), segurament rebreu una IP dinàmica del vostre proveïdor. Quan es realitzava una trucada telefònica amb mòdem i usant el protocol PPP (<em>point to point protocol</em>, protocol punt a punt), el proveïdor proporcionava una adreça IP dinàmica. Si utilitzeu ADSL i un encaminador o <em>router</em>, segurament l’encaminador us proporciona una adreça IP dinàmica privada a l’ordinador de casa. Al mateix temps, l’encaminador obté una IP dinàmica pública del proveïdor. Aquestes adreces IP dinàmiques són fixes (sempre les mateixes) o dinàmiques d’interval (pot ser qualsevol IP del conjunt d’adreces IP que té disponibles per concedir el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>).</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">IP pública / IP privada</p>
<p>La diferència entre una IP pública i una IP privada és que la pública és visible per a tots els equips d’Internet, mentre que la privada és visible només dins de la mateixa xarxa local.</p>
</div>
</div>
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> ha de tenir en funcionament un dimoni (<em>daemon</em>) encarregat de la gestió de les tasques <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per part del client. El programa client realitza la part de negociació encarregada al client (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> <em>discovery</em>, <em>request</em>) i també porta un registre de les concessions (<em>leases</em>) rebudes. Aquest registre és el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessió el programa client queda “adormit”, pendent de tornar-se a executar automàticament quan calgui renegociar la concessió. Sense intervenció de l’usuari, el programa client s’activa i segueix el procediment necessari per renegociar l’adreça IP cada cop que el temps de la concessió s’exhaureix.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Configuració client</p>
<p>Usualment les configuracions clients es poden fer de tres maneres diferents:</p>
<ul>
<li class="level1">
<div class="li">fitxer de text: editar directament els fitxers de configuració.</div>
</li>
<li class="level1">
<div class="li">menús en mode text: usant algun programa de menús amb interfície de text.</div>
</li>
<li class="level1">
<div class="li">aplicació gràfica: usant una aplicació de finestres en l’entorn gràfic.</div>
</li>
</ul>
</div>
</div>
<p>Els programes client varien d’un sistema operatiu a un altre i la manera d’executar-los també. Generalment es disposa d’un client executable en mode text o ordres i d’una interfície gràfica (<acronym title="Graphical User Interface">GUI</acronym>, <em>graphics user interface</em> o interfície gràfica d’usuari) per a la configuració. No cal dir que els sistemes Windows tendeixen a la configuració gràfica usant finestres i a la configuració i execució interna d’amagat de l’usuari. Normalment, en els sistemes GNU/Linux, la configuració es fa usant fitxers de text o com a opcions en l’ordre d’execució. La interfície gràfica acostuma a ser un frontal (<em>front-end</em>) per cridar l’ordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de <em>leasses</em>, més o menys detalladament.</p>
<p>Generalment el programa client es pot configurar per definir-ne el comportament en la comunicació amb el servidor: informació a demanar, informació a proporcionar al servidor, opcions per defecte, etc.</p>
</div>
<h3><a id="el_servidor_dhcp"></a>El servidor DHCP</h3>
<div class="level3">
<p>L’administrador de xarxa és l’encarregat de pensar la ubicació del servidor o servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en l’estructura corporativa. Com més complicada sigui la topologia de la xarxa, més difícil en serà la gestió. Una xarxa corporativa bàsica pot disposar d’un únic servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, però totes amb connectivitat amb el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Aquest també pot ser l’esquema d’una xarxa privada a casa, on un encaminador (el de l’<acronym title="Internet Service Provider">ISP</acronym>, per exemple) proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> a tots els ordinadors de la casa.</p>
<p>Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs les unes de les altres, la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es complica. Si es vol continuar amb un únic servidor per a tota la xarxa, caldrà que els tallafocs (<em>firewalls</em>) deixin passar els paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> entre les subxarxes i el servidor. Una altra opció és posar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a cada subxarxa o grups de subxarxes. Fent-ho així, l’administració de cada servidor és més senzilla però hi ha més servidors a administrar. Una xarxa amb una casuística completa és la que té diversos servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Si el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és l’encarregat de donar adreces IP als clients, qui li proporciona una adreça IP a ell? O bé un altre servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (i podríem tornar a fer la mateixa pregunta indefinidament) o bé l’administrador. Usualment, en una xarxa corporativa el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza una IP estàtica definida per l’administrador. Això li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre d’un altre servidor extern.</p>
<p>Hi ha diversos programes servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>: en mode text, en mode gràfic, en mode “màgic” (no es veu què fan) i en mode Unix (tot basat en fitxers de text). Cada administrador treballa amb les seves eines preferides. Les tasques bàsiques per aprendre a utilitzar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són observar/fer una llista de la configuració actual, activar/aturar el servei, modificar la configuració, monitorar els <em>logs</em> (registre de successos del servei) i, evidentment, saber instal·lar i desinstal·lar l’aplicació servidor.</p>
<div class="iocnote">
<div class="ioccontent">
<p>Els fitxers de logs (successos) recullen els esdeveniments que es volen monitorar.</p>
</div>
</div>
<p>Com la majoria de serveis de xarxa, el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és un servei que s’executa en segon pla en forma de dimoni. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> sempre està engegat escoltant en el port 67 les peticions que rep dels clients. Quan rep una petició entrant, el programa executable del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> la processa i posa en marxa tot el mecanisme <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultàniament (segons la configuració).</p>
<p>Els fitxers del registre del servei, on s’anoten les concessions, permeten mantenir la informació encara que el servei s’aturi o que el servidor s’apagui. En tornar a engegar es llegiran de nou els fitxers de registres per tal de saber quines són les concessions que s’havien realitzat.</p>
<div class="iocnote">
<div class="ioccontent">
<p>Els fitxers de concessions permeten mantenir la coherència de l’assignació d’adreces IP entre aturades del servei.</p>
</div>
</div>
</div>
<h2><a id="instal_lacio_d_un_servei_dhcp"></a>Instal·lació d'un servei DHCP</h2>
<div class="level2">
<p>El servei de xarxa <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està estructurat en forma de servei client / servidor; per tant, caldrà disposar del programari apropiat per fer cada un d’aquests rols. El programari que fa la funció de client usualment ja està integrat en el sistema operatiu (la part que gestiona la xarxa). És a dir, per disposar de la part client del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> normalment no cal instal·lar res, ja forma part del servei de xarxa.</p>
<p>Així doncs, quan parlem d’instal·lar un servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> fem referència al procés d’instal·lació i configuració del programari del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Evidentment també caldrà configurar els clients adequadament per fer ús d’aquest servei.</p>
<p>La instal·lació del programari que proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es fa de manera molt similar (per no dir idèntica) al programari d’altres serveis de xarxa com els serveis <acronym title="Domain Name System">DNS</acronym>, <acronym title="Hyper Text Transfer Protocol">HTTP</acronym>, <acronym title="File Transfer Protocol">FTP</acronym>, etc. Es tracta d’instal·lar el programari de l’aplicació servidor i fer-ne la configuració apropiada. Senzill oi?</p>
<p>Per fer això cal plantejar-se els passos següents:</p>
<ol>
<li class="level1">
<div class="li">Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?</div>
</li>
<li class="level1">
<div class="li">Obtenir l’aplicació que proporciona el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar l’estat de la xarxa actual. Està el servei ja en funcionament? Existeix ja una configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> activa?</div>
</li>
<li class="level1">
<div class="li">Instal·lar l’aplicació servidor.</div>
</li>
<li class="level1">
<div class="li">Comprovar que la instal·lació s’ha efectuat correctament.</div>
</li>
<li class="level1">
<div class="li">Configurar el servei en el servidor i activar els clients perquè l’utilitzin.</div>
</li>
<li class="level1">
<div class="li">Comprovar que el servei funciona correctament.</div>
</li>
</ol>
</div>
<h3><a id="aplicacions_servidor_dhcp"></a>Aplicacions servidor DHCP</h3>
<div class="level3">
<p>Sempre que l’administrador vol posar en funcionament un nou servei de xarxa cal que primerament analitzi quines aplicacions hi ha al mercat que ofereixen aquest servei. És feina seva estudiar les característiques de les diverses aplicacions, com per exemple: avaluar-ne l’eficiència, el cost, el que en diuen els altres… La manera més fàcil de fer això és navegar per Internet, consultar les revistes especialitzades o demanar consell a un dels gurus informàtics coneguts.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Usualment l’administrador s’informa a través del seu cercador preferit, per exemple Google, i de webs com la Viquipèdia. Podeu cercar <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> o <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server al Google i a la wiki (en anglès).</p>
</div>
</div>
<p>Usualment, però, l’administrador acaba utilitzant l’aplicació servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que li proporciona el mateix sistema operatiu. Si utilitzeu el sistema operatiu Windows l’empresa Microsoft disposa d’una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment si utilitzeu GNU/Linux segurament la mateixa distribució ja proporciona un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. De totes maneres en podeu obtenir d’altres també a Internet.</p>
</div>
<h3><a id="instal_lar_l_aplicacio_servidor"></a>Instal·lar l'aplicació servidor</h3>
<div class="level3">
<p>Tot seguit es descriurà el procés per instal·lar el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en un entorn GNU/Linux. Un cop feta la instal·lació cal observar què s’ha instal·lat, quins programes executables, on són els fitxers de configuració, els de monitoratge, etc.</p>
<p>Els usuaris GNU/Linux poden buscar fàcilment per Internet quins paquets del client i del servidor dhcp usant eines com yum, apt-get o wget, a part dels repositoris de programari usuals o del mateix Google.</p>
<p>Llista de paquets <em>rpm</em> que contenen exactament el text <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># yum list dhcp </span></div>
</li>
<li class="li1">
<div class="de1">fedora <span class="nu0">100</span><span class="sy0">%</span> <span class="sy0">|</span>===================================================<span class="sy0">|</span> <span class="nu0">2.3</span> kB 00:00</div>
</li>
<li class="li1">
<div class="de1">Installed Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 installed</div>
</li>
</ol>
<p>Llista de paquets que contenen la cadena <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># yum list dhcp* </span></div>
</li>
<li class="li1">
<div class="de1">Installed Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 installed</div>
</li>
<li class="li1">
<div class="de1">dhcpv6_client.i386 <span class="nu0">0.10</span>-<span class="nu0">44</span>.fc7 installed</div>
</li>
<li class="li1">
<div class="de1">Available Packages</div>
</li>
<li class="li1">
<div class="de1">dhcp-devel.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 updates</div>
</li>
<li class="li1">
<div class="de1">dhcp-forwarder.i386 <span class="nu0">0.7</span>-<span class="nu0">12</span>.fc7 fedora</div>
</li>
<li class="li1">
<div class="de1">dhcp-forwarder-sysv.i386 <span class="nu0">0.7</span>-<span class="nu0">12</span>.fc7 fedora</div>
</li>
<li class="li1">
<div class="de1">dhcp-static.i386 <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7 updates</div>
</li>
<li class="li1">
<div class="de1">dhcpv6.i386 <span class="nu0">0.10</span>-<span class="nu0">44</span>.fc7 updates</div>
</li>
</ol>
<p>Instal·lar el paquet <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># yum install dhcp</span></div>
</li>
</ol>
<p>Fer la llista dels paquets <em>dhcp</em> instal·lats. Si el sistema ja els té instal·lats o volem comprovar-ho podem consultar els paquets instal·lats:</p>
<pre class="code">[root@portatil ~]# rpm -qa | grep dhcp 
libdhcp6client-0.10-44.fc7 
libdhcp4client-3.0.5-42.fc7 
dhcp-3.0.5-42.fc7 
dhcpv6_client-0.10-44.fc7 
libdhcp-1.24-6.fc7</pre>
<p>Obtenir informació del paquet del servei <em>dhcp</em> instal·lat:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qi dhcp </span></div>
</li>
<li class="li1">
<div class="de1">Name : dhcp Relocations: <span class="br0">(</span>not relocatable<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Version : 3.0.5 Vendor: Fedora Project</div>
</li>
<li class="li1">
<div class="de1">Release : <span class="nu0">42</span>.fc7 Build Date: dl <span class="nu0">12</span> nov <span class="nu0">2007</span> <span class="nu0">17</span>:<span class="nu0">37</span>:<span class="nu0">56</span> CET</div>
</li>
<li class="li1">
<div class="de1">Install Date: <span class="kw2">dc</span> <span class="nu0">23</span> gen <span class="nu0">2008</span> <span class="nu0">19</span>:<span class="nu0">14</span>:<span class="nu0">18</span> CET Build Host: xenbuilder4.fedora.phx.redhat.com</div>
</li>
<li class="li1">
<div class="de1">Group : System Environment<span class="sy0">/</span>Daemons Source RPM: dhcp-3.0.5-<span class="nu0">42</span>.fc7.src.rpm</div>
</li>
<li class="li1">
<div class="de1">Size : <span class="nu0">2162920</span> License: ISC</div>
</li>
<li class="li1">
<div class="de1">Signature : DSA<span class="sy0">/</span>SHA1, dl <span class="nu0">14</span> gen <span class="nu0">2008</span> <span class="nu0">19</span>:<span class="nu0">35</span>:<span class="nu0">22</span> CET, Key ID b44269d04f2a6fd2</div>
</li>
<li class="li1">
<div class="de1">Packager : Fedora Project</div>
</li>
<li class="li1">
<div class="de1">URL : http:<span class="sy0">//</span>isc.org<span class="sy0">/</span>products<span class="sy0">/</span>DHCP<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Summary : DHCP <span class="br0">(</span>Dynamic Host Configuration Protocol<span class="br0">)</span> server and relay agent</div>
</li>
<li class="li1">
<div class="de1">Description :</div>
</li>
<li class="li1">
<div class="de1">El DHCP <span class="br0">(</span>protocol de configuració dinàmica de màquines<span class="br0">)</span> és un protocol</div>
</li>
<li class="li1">
<div class="de1">que permet a dispositius individuals d<span class="st_h">'una xarxa IP obtenir la seva </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">informació de configuració de xarxa (adreça IP, màscara de subxarxa, </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">adreça de difusió, etc) d'</span>un servidor DHCP. El propòsit del DHCP és</div>
</li>
<li class="li1">
<div class="de1">fer més senzilla l<span class="st_h">'administració d'</span>una xarxa gran. El paquet dhcp</div>
</li>
<li class="li1">
<div class="de1">inclou el servei DHCP i l<span class="st_h">'agent de repetició de l'</span>ISC.</div>
</li>
<li class="li1">
<div class="de1">Per usar DHCP a la vostra xarxa, instal·leu un servei DHCP <span class="br0">(</span>o agent</div>
</li>
<li class="li1">
<div class="de1">de repetició<span class="br0">)</span> i als clients executeu un dimoni client DHCP. El paquet</div>
</li>
<li class="li1">
<div class="de1">dhcp proporciona servei DHCP i l<span class="st_h">'agent de repetició de l'</span>ISC.</div>
</li>
</ol>
</div>
<h3><a id="observar_els_components_del_programari_instal_lat"></a>Observar els components del programari instal·lat</h3>
<div class="level3">
<p>Sovint passa que els usuaris instal·len programes als ordinadors però no saben quins fitxers han instal·lat ni on són. Un administrador curiós ha de fer un repàs a tot allò que s’ha afegit de nou al sistema.</p>
<p>Fer la llista dels components del paquet <em>dhcp</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>omshell</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5</div>
</li>
<li class="li1">
<div class="de1">... output suprimit ....</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc951.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man1<span class="sy0">/</span>omshell.1.gz</div>
</li>
<li class="li1">
<div class="de1">... output suprimit ...</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcrelay.8.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
</ol>
<p>En funció del directori on s’ubiquen els fitxers podem intuir si són executables, de configuració o de documentació. També podem mirar de filtrar la sortida en cada cas:</p>
<p>Fitxers de configuració (usualment en el directori <em>/etc</em>):</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qc dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep etc </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
</ol>
<p>Fitxers de documentació:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -qd dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>IANA-arp-parameters</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>README</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>README.ldap</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>RELNOTES</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>3.0b1-lease-convert</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>dhcp.spec</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>dhcpd-conf-to-ldap</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>Registry.perlmodule</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>ms2isc.pl</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>ms2isc<span class="sy0">/</span>readme.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>sethostname.sh</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>__fedora_contrib<span class="sy0">/</span>solaris.init</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>api+protocol</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>dhcpd.conf.sample</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-authentication-<span class="nu0">14</span>.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-dhcp-dns-<span class="nu0">12</span>.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-failover-07.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>draft-ietf-dhc-ldap-schema-01.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc1542.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2131.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2132.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2485.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc2489.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>rfc951.txt</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man1<span class="sy0">/</span>omshell.1.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcp-eval.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcp-options.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcpd.conf.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man5<span class="sy0">/</span>dhcpd.leases.5.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcpd.8.gz</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>man<span class="sy0">/</span>man8<span class="sy0">/</span>dhcrelay.8.gz</div>
</li>
</ol>
<p>Podem mirar de filtrar quins són els executables tenint en compte que usualment estaran en un directori de nom <em>bin</em> o <em>sbin</em>:</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Arxius executables</p>
<p>En GNU/Linux els fitxers executables per l’administrador es troben usualment a i a . Els executables d’usuari normalment són a i .</p>
</div>
</div>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep bin </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>omshell <span class="sy0">/</span>sbin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd <span class="sy0">/</span>usr<span class="sy0">/</span>sbin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>bin</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcrelay <span class="sy0">/</span>usr<span class="sy0">/</span>bin</div>
</li>
</ol>
<p></p>
<p>En resum:</p>
<ul>
<li class="level1">
<div class="li">Els fitxers de documentació es troben generalment a: <em>/usr/share/doc</em> i a <em>/usr/share/man</em>.</div>
</li>
<li class="level1">
<div class="li">Els fitxers de configuració es troben a: <em>/etc</em>, i a <em>/etc/sysconfig</em>.</div>
</li>
<li class="level1">
<div class="li">El dimoni del servei es troba a: <em>/usr/sbin/dhcpd</em>.</div>
</li>
<li class="level1">
<div class="li">El fitxer de configuració del dimoni del servei és: <em>/etc/dhcpd.conf</em>.</div>
</li>
<li class="level1">
<div class="li">El fitxer de govern del servei és: <em>/etc/rc.d/init.d/dhcpd</em>.</div>
</li>
</ul>
</div>
<h4><a id="activar_desactivar_el_servei_i_nivells_d_arrancada"></a>Activar/desactivar el servei i nivells d'arrancada</h4>
<div class="level4">
<p>Un cop feta la instal·lació física de l’aplicació servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> (els fitxers) cal posar-lo en marxa, engegar-lo, o comprovar que ja ho està.</p>
<div class="ioctextl">
<div class="ioccontent">
<p class="ioctitle">Serveis de xarxa: stand alone o xinetd</p>
<p>En la majoria de serveis de xarxa el servidor pot funcionar com un servei per si mateix (<em>stand alone</em>) o pot estar configurat per funcionar dins d’un superservei de xarxa com per exemple <em>inetd</em> i <em>xinetd</em>. Si funciona en mode de servei propi és el servidor qui escolta les connexions entrants i les atén. Si s’executa dins del superservei de xarxa, aquest és qui detecta les connexions entrants i activa el dimoni del servei per tal que les atengui, un cop ateses el dimoni del servei acaba i torna a ser el superservidor de xarxa qui es queda escoltant.</p>
<p>En un primer moment molts serveis funcionaven en mode <em>stand alone</em>, però això es va mostrar poc eficient a nivell de recursos. Fixeu-vos que si es vol oferir n serveis de xarxa, cal tenir engegats els n servidors corresponents. Aquests ocupen memòria i CPU, tot i que no atenguin cap client. Estan engegats només “per si” un client els demana.</p>
<p>Un model més eficient és engegar un únic procés que fa la tasca de superservidor de xarxa (<em>inetd o xinetd</em>) i només quan es rep una petició d’un client, s’executa el servei apropiat.</p>
<p>Usualment els serveis que funcionen en mode xinetd disposen de fitxers de configuració lligats al xinetd. Els serveis que actuen indivudualment disposen dels fitxers de configuració propis al etc rc.dinit.d/.</p>
<p>Molt sovint és decisió de l’administrador configurar en quin mode de funcionament vol que treballi el servei. Per exemple el servei de pàgines web (<em>httpd</em>), el servei <em>ssh</em> i molts d’altres, funcionen individualment. Serveis més bàsics com <em>telnet</em>, <em>finger</em>, <em>tftp</em>, etc funcionen usualment dins del <em>xinetd</em>.</p>
</div>
</div>
<p>Primerament cal saber si el servidor instal·lat funciona en mode <em>stand-alone</em> o dins del superdimoni de xarxa <em>xinetd</em> o <em>initd</em>. Si existeixen fitxers de configuració dins del directori <em>/etc/xinetd.d/&lt;nom-servei&gt;</em> es tracta d’un servei dins del <em>xinetd</em>. Si existeixen fitxers de configuració dins del directori <em>/etc/rc.d/init.d/&lt;nom-servei&gt;</em> es tracta d’un servei <em>stand-alone</em>. Podem fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># rpm -ql dhcp | grep /etc </span></div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>dhcpd.conf</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>openldap<span class="sy0">/</span>schema<span class="sy0">/</span>dhcp.schema</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcrelay</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="sy0">/</span>etc<span class="sy0">/</span>sysconfig<span class="sy0">/</span>dhcrelay</div>
</li>
</ol>
<p>Com podem observar es tracta d’un servei <em>stand-alone</em>. També es pot consultar el tipus de servei amb l’ordre chkconfig i observar si surt en la llista d’un tipus o de l’altre:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list | grep dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>Per facilitar buscar els serveis “stand-alone” podem fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>L’estat del servei pot ser en execució (<em>running</em>) o aturat (<em>stopped</em>). Es pot consultar l’estat amb l’opció <em>status</em> de l’ordre <em>service</em> o del mateix executable del servei:</p>
<ol>
<li class="li1">
<div class="de1">Es pot saber l<span class="st_h">'estat del servei amb l'</span>opció status de les ordres:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcp status </span></div>
</li>
<li class="li1">
<div class="de1">dhcp està aturat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># /etc/rc.d/init.d/dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcp està aturat</div>
</li>
</ol>
<p>La gestió de l’estat d’un servei normalment inclou les opcions <em>start</em>, <em>stop</em>, <em>status</em>, <em>restart</em> i <em>reload</em>. Aquestes són les més usuals, però cada servei pot definir les que cregui oportunes. Aquests són exemples de gestió de l’estat del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<p>Es pot arrancar el servei amb l’opció start de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està iniciant el servei dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Es pot aturar el servei amb l’opció stop de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd stop </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd stop </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està aturant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Es pot iniciar de nou el servei (recarregar) amb l’opció reload o restart de les ordres:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># /etc/rc.d/init.d/dhcpd restart </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el servei dhcpd: [Incorrecte] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd reload </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant el servei dhcpd: [ FET ] </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està iniciant el servei dhcpd: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
</ol>
<p>Per saber les opcions possibles d’un servei es pot fer el truc:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd patapum </span></div>
</li>
<li class="li1">
<div class="de1">Forma d<span class="st_h">'ús: /etc/init.d/dhcpd {start|stop|restart|condrestart|status} </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# /etc/rc.d/init.d/dhcpd pimpam </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">Forma d'</span>ús: <span class="sy0">/</span>etc<span class="sy0">/</span>rc.d<span class="sy0">/</span>init.d<span class="sy0">/</span>dhcpd <span class="br0">{</span>start<span class="sy0">|</span>stop<span class="sy0">|</span>restart<span class="sy0">|</span>condrestart<span class="sy0">|</span>status<span class="br0">}</span></div>
</li>
</ol>
<p></p>
<p>Que un servei del sistema estigui engegat no significa que en arrancar de nou el sistema torni a estar engegat. Cal comprovar que sigui així o assegurar-se de definir-ho correctament. Els serveis (usualment dimonis executables) es poden configurar per arrancar automàticament en determinats nivells d’execució. Les màquines GNU/Linux tenen 7 nivells d’execució com es pot veure del fitxer <em>/etc/inittab</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># head -20 /etc/inittab </span></div>
</li>
<li class="li1">
<div class="de1">... output suprimit ...</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Default runlevel. The runlevels used by RHS are: </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 0 - halt (Do NOT set initdefault to this) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 1 - Single user mode </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 2 - Multiuser, without NFS (The same as 3, if you do not have networking) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 3 - Full multiuser mode </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 4 - unused </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 5 - X11 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># 6 - reboot (Do NOT set initdefault to this) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># ... output suprimit ...</span></div>
</li>
</ol>
<p>Per configurar a quins nivells es vol que s’executi un servei s’utilitza l’ordre chkconfig, que permet activar/desactivar el servei pels nivells indicats. L’exemple següent mostra l’ús d’aquesta ordre, dóna la llista de l’estat actual del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> en tots els nivells i el configura per executar-se en els nivells 3, 4 i 5:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --help </span></div>
</li>
<li class="li1">
<div class="de1">chkconfig versió 1.3.34 - Copyright <span class="br0">(</span>C<span class="br0">)</span> <span class="nu0">1997</span>-<span class="nu0">2000</span> Red Hat, Inc.</div>
</li>
<li class="li1">
<div class="de1">Aquest programari es pot distribuir lliurement d<span class="st_h">'acord amb els termes de la Llicència </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">Pública General GNU. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">forma d'</span>ús: chkconfig <span class="re5">--list</span> <span class="br0">[</span>nom<span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--add</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--del</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="re5">--override</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1">chkconfig <span class="br0">[</span>--level <span class="sy0">&lt;</span>nivells<span class="sy0">&gt;</span><span class="br0">]</span> <span class="sy0">&lt;</span>nom<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>on<span class="sy0">|</span>off<span class="sy0">|</span>reset<span class="sy0">|</span>resetpriorities<span class="sy0">&gt;</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:apagat <span class="nu0">4</span>:apagat <span class="nu0">5</span>:apagat <span class="nu0">6</span>:apagat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --level 345 dhcpd on </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># chkconfig --list | grep dhcpd </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="nu0">0</span>:apagat <span class="nu0">1</span>:apagat <span class="nu0">2</span>:apagat <span class="nu0">3</span>:engegat <span class="nu0">4</span>:engegat <span class="nu0">5</span>:engegat <span class="nu0">6</span>:apagat</div>
</li>
</ol>
<p>Fixeu-vos que definir els nivells d’execució no significa que el servei estigui ara mateix engegat. Significa que quan arranqui el sistema de nou s’engegarà en els nivells corresponents. Podem ara estar al nivell 5 i tenir el servei aturat perquè encara no l’hem engegat. Per exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># runlevel </span></div>
</li>
<li class="li1">
<div class="de1">N <span class="nu0">5</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd està aturat</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd start </span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està iniciant el servei dhcpd [ FET ]</span></div>
</li>
</ol>
</div>
<h2><a id="comprovacio_del_funcionament_basic"></a>Comprovació del funcionament bàsic</h2>
<div class="level2">
<p></p>
<p>Comprovar que el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està en funcionament és un procés ben senzill, n’hi ha prou de comprovar que el servei està engegat. Això no vol dir, en cap cas, que el servei estigui funcionant correctament. Potser el servidor està engegat però no està correctament configurat. De fet, la configuració és la part realment important de l’administració d’un servei, i també del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>A part de comprovar l’estat del servei (amb l’opció <em>status</em>), l’administrador pot assegurar-se que el dimoni del servei està en execució buscant el seu PID (<em>process identifier</em> o indicador de número de procés). Una altra activitat a fer és monitorar el registre d’activitats del servei (els <em>logs</em>). Tot el trànsit <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és trànsit de xarxa TCP/IP; per tant també es pot observar l’estat dels ports i analitzar el trànsit que s’hi produeix.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Comprovació DHCP</p>
<p>L’administrador pot verificar el funcionament del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> observant:</p>
<ul>
<li class="level1">
<div class="li">l’estat del servei (on, off)</div>
</li>
<li class="level1">
<div class="li">el PID del servei (ha d’estar running).</div>
</li>
<li class="level1">
<div class="li">el registre de <em>logs</em>.</div>
</li>
<li class="level1">
<div class="li">monitorar el trànsit de xarxa amb una eina tipus <em>wireshark</em>.</div>
</li>
<li class="level1">
<div class="li">l’estat dels ports.</div>
</li>
</ul>
</div>
</div>
<p>Tot procés en el sistema té un identificador de procés. El PID dels serveis usualment es desen en el sistema de fitxers (al directori <em>/var/run</em>) en forma de fitxer que conté un valor numèric (en text) corresponent al PID del procés. Amb el servei en marxa sempre es pot observar el PID del servidor amb:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ps ax | grep dhcp </span></div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3610</span> ? Ss <span class="nu0">0</span>:00 <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>dhcpd</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service dhcpd status </span></div>
</li>
<li class="li1">
<div class="de1">dhcpd <span class="br0">(</span>pid <span class="nu0">3610</span><span class="br0">)</span> s<span class="st_h">'està executant...</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# ll /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">-rw-r--r-- 1 root root 5 29 jun 14:17 /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">[root@portatil ~]# cat /var/run/dhcpd.pid </span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">3610</span></div>
</li>
</ol>
<p>Un cop iniciat el servei es crea un fitxer de bloqueig o <em>lock</em> amb el nom del servei per evitar iniciar-ne una altra instància. Els fitxers de <em>lock</em> usualment es troben a <em>/var/lock</em> i són un simple fitxer de text buit on la seva pròpia existència ja marca que el servei està en marxa. En parar el servei el fitxer s’elimina. Podem observar això fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lock/subsys/dhcpd </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /var/lock/subsys/dhcpd </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">0</span> <span class="nu0">1</span> jun <span class="nu0">18</span>:<span class="nu0">26</span> <span class="sy0">/</span>var<span class="sy0">/</span>lock<span class="sy0">/</span>subsys<span class="sy0">/</span>dhhcpd</div>
</li>
</ol>
<p>Tots els serveis del sistema normalment es monitoren anotant en fitxers de text un registre de totes les accions que realitzen, són els fitxers coneguts com a fitxers de <em>log</em>. Tant es pot utilitzar un fitxer genèric pel sistema com un fitxer independent per a un servei determinat. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> utilitza el fitxer de monitoratge estàndard <em>/var/log/messages</em>. En aquest fitxer s’enregistra cada cop que el servei s’engega i s’atura.</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/log/messages | grep dhcp </span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">16</span>:<span class="nu0">53</span> portatil yum: Installed: dhcp - <span class="nu0">12</span>:3.0.5-<span class="nu0">42</span>.fc7.i386</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Internet Systems Consortium DHCP Server V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: WARNING: Host declarations are global. They are not limited</div>
</li>
<li class="li1">
<div class="de1">to the scope you declared them in.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> deleted host decls to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> new dynamic host decls to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Wrote <span class="nu0">0</span> leases to leases file.</div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="sy0">/</span>192.168.1<span class="sy0">/</span><span class="nu0">24</span></div>
</li>
<li class="li1">
<div class="de1">Jun <span class="nu0">29</span> <span class="nu0">14</span>:<span class="nu0">17</span>:<span class="nu0">33</span> portatil dhcpd: Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="sy0">/</span>192.168.1<span class="sy0">/</span><span class="nu0">24</span></div>
</li>
</ol>
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> desa la informació de registre de les concessions que efectua en un fitxer de <em>leasses</em>. Això li permet seguir la pista de les adreces IP que ha concedit i ser coherent entre diverses arrancades del mateix servidor. Es pot observar aquest fitxer a <em>/var/lib/dhcpd/dhcpd.leases</em>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">473</span> <span class="nu0">29</span> jun <span class="nu0">14</span>:<span class="nu0">17</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dhcpd<span class="sy0">/</span>dhcpd.leases</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># All times in this file are in UTC (GMT), not your local timezone. This is </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># not a bug, so please don't ask about it. There is no portable way to </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># store leases in the local timezone, so please don't request this as a </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># feature. If this is inconvenient or confusing to you, we sincerely </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># apologize. Seriously, though - don't ask. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># The format of this file is documented in the dhcpd.leases(5) manual page. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># This lease file was written by isc-dhcp-V3.0.5-RedHat</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Sovint l’administrador vol comprovar que els ports que utilitza el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> estan oberts. En GNU/Linux es pot fer una llista fàcilment dels serveis associats a cada port mitjançant el fitxer <em>/etc/services</em>. Algunes utilitats com nmap permeten detectar els ports oberts. Per exemple podem fer:</p>
<ol>
<li class="li1">
<div class="de1">Llista dels ports que inclouen alguna referència DHCP:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/services | grep DHCP </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>tcp dhcpc <span class="co0"># BOOTP client </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>udp dhcpc</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-client <span class="nu0">546</span><span class="sy0">/</span>tcp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-client <span class="nu0">546</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-server <span class="nu0">547</span><span class="sy0">/</span>tcp</div>
</li>
<li class="li1">
<div class="de1">dhcpv6-server <span class="nu0">547</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">dhcp-failover <span class="nu0">647</span><span class="sy0">/</span>tcp <span class="co0"># DHCP Failover </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover <span class="nu0">647</span><span class="sy0">/</span>udp <span class="co0"># DHCP Failover </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover2 <span class="nu0">847</span><span class="sy0">/</span>tcp <span class="co0"># dhcp-failover 2 </span></div>
</li>
<li class="li1">
<div class="de1">dhcp-failover2 <span class="nu0">847</span><span class="sy0">/</span>udp <span class="co0"># dhcp-failover 2 </span></div>
</li>
<li class="li1">
<div class="de1">qip-qdhcp <span class="nu0">2490</span><span class="sy0">/</span>tcp <span class="co0"># qip_qdhcp </span></div>
</li>
<li class="li1">
<div class="de1">qip-qdhcp <span class="nu0">2490</span><span class="sy0">/</span>udp <span class="co0"># qip_qdhcp </span></div>
</li>
</ol>
<p>Si ens hi fixem veurem que de fet el protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és anomenat BOOTP. Podem fer la llista de les entrades que corresponen a aquest protocol:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/services | grep bootp </span></div>
</li>
<li class="li1">
<div class="de1">bootps <span class="nu0">67</span><span class="sy0">/</span>tcp <span class="co0"># BOOTP server </span></div>
</li>
<li class="li1">
<div class="de1">bootps <span class="nu0">67</span><span class="sy0">/</span>udp</div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>tcp dhcpc <span class="co0"># BOOTP client </span></div>
</li>
<li class="li1">
<div class="de1">bootpc <span class="nu0">68</span><span class="sy0">/</span>udp dhcpc</div>
</li>
<li class="li1">
<div class="de1">nuts_bootp <span class="nu0">4133</span><span class="sy0">/</span>tcp <span class="co0"># NUTS Bootp Server </span></div>
</li>
<li class="li1">
<div class="de1">nuts_bootp <span class="nu0">4133</span><span class="sy0">/</span>udp <span class="co0"># NUTS Bootp Server</span></div>
</li>
</ol>
<p>Es pot observar que el port usat pel client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és el port 68 (bootpc) i el port usat pel servidor és el port 67 (bootps).</p>
</div>
<h2><a id="configuracio_dhcp"></a>Configuració DHCP</h2>
<div class="level2">
<p>Per configurar el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> primer cal saber observar i manipular la configuració de xarxa existent, i això consisteix a saber:</p>
<ul>
<li class="level1">
<div class="li">Observar/fer la llista de la configuració de xarxa actual.</div>
</li>
<li class="level1">
<div class="li">Comprovar l’estat del servei de xarxa.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de xarxa.</div>
</li>
<li class="level1">
<div class="li">Monitorar el servei i el procés del servidor.</div>
</li>
</ul>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Exemples de configuració</p>
<p>En GNU/Linux és molt usual que el paquet que proporciona un servei inclogui un fitxer d’exemple de configuració. El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> incorpora el fitxer d’exemple <em>dhcpd..conf</em> i la pàgina de manual del mateix nom.</p>
</div>
</div>
<p>Les tasques principals per configurar un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són les següents:</p>
<ul>
<li class="level1">
<div class="li">Instal·lar el programari del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar/fer la llista de la configuració actual del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Modificar la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Monitorar els <em>logs</em> del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i els fitxers de registre de les concessions (<em>leases</em>).</div>
</li>
</ul>
<p>Per tant, abans d’endinsar-nos en la configuració del servei és molt útil observar una configuració ja existent. Un exemple de fitxer de configuració del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és el que es mostra a continuació:</p>
<p></p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># a) opcions globals del servidor DHCP (usuals)</span></div>
</li>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># b) definició de la xarxa a la qual s'ofereix el servei DHCP</span></div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># opcions genèriques per a tots els equips de la xarxa</span></div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.0.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># definició de l'interval d'ips dinàmiques a usar </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># i dels temps de les concessions</span></div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.0.128 192.168.0.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># c) Opcions d'equips individuals</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># el servidor ns obté sempre una adreça fixa basada en MAC</span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest fitxer de configuració es pot veure que hi ha tres àmbits diferents de definició:</p>
<ol>
<li class="level1">
<div class="li"><strong>Opcions globals en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</strong> Són opcions que indiquen al servidor la seva manera d’actuar. També són opcions generals que cal aplicar a totes les concessions que es realitzin, independentment de la xarxa o equip que siguin.</div>
</li>
<li class="level1">
<div class="li"><strong>Definicions i opcions de xarxa.</strong> Es defineixen tantes xarxes diferents com subxarxes ha d’atendre el servidor. Cada definició de subxarxa consta de la IP de la xarxa i la màscara corresponent. Entre claus s’indiquen totes les opcions específiques per a les concessions de les adreces IP corresponents a aquesta subxarxa. Una opció característica és indicar l’interval (o <em>pool</em>) d’adreces dinàmiques a usar, la porta d’enllaç predeterminada, el servidor de noms, etc.</div>
</li>
<li class="level1">
<div class="li"><strong>Opcions d’equips individuals.</strong> Dins d’una subxarxa es poden definir opcions per a equips individuals. Cal identificar els equips per la seva adreça MAC i, entre claus, indicar les opcions que els són específiques. Això permet assignar adreces fixes dinàmicament (equivalent al protocol BOOTP) usant les opcions de maquinari Ethernet i <em>fixed-address</em>.</div>
</li>
</ol>
<p>Les opcions globals de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es poden redefinir amb valors diferents dins d’un bloc de xarxa concret. Dins d’un equip també es poden definir opcions amb valors diferents als definits per la xarxa o globalment. Tal com passa en els llenguatges de programació preval el valor més intern, el de <em>host</em> sobre el de xarxa i el de xarxa per sobre del global.</p>
</div>
<h3><a id="configuracio_basica"></a>Configuració bàsica</h3>
<div class="level3">
<p>Per fer funcionar el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> cal configurar-lo prèviament. Per poder arrancar li cal saber a quina xarxa donarà servei i quin és l’interval d’adreces IP que pot usar dinàmicament per a les concessions als clients.</p>
<p>El paquet <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> conté un fitxer d’exemple al directori <em> /user/share/doc/dhcp*/dhcpd.conf.sample</em>. Aquest fitxer es pot copiar a <em> /etc/dhcpd.conf</em> i passarà a ser la configuració bàsica del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Podem veure el seu contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># ll /usr/share/doc/dhcp-3.0.5/dhcpd.conf.sample </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">852</span> <span class="nu0">12</span> nov <span class="nu0">2007</span> <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>doc<span class="sy0">/</span>dhcp-3.0.5<span class="sy0">/</span>dhcpd.conf.sample</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/dhcpd.conf </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># DHCP Server Configuration file. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># see /usr/share/doc/dhcp*/dhcpd.conf.sample </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#a) opcions globals</span></div>
</li>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#b) opcions genèriques per a una subxarxa concreta</span></div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.1.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># --- default gateway </span></div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option nis-domain <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option time-offset <span class="re5">-18000</span>; <span class="co0"># Eastern Standard Time </span></div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.1.128 192.168.1.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#c) we want the nameserver to appear at a fixed address </span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En la configuració per defecte es poden analitzar els diversos elements que es configuren:</p>
<ul>
<li class="level1">
<div class="li">Opcions globals: indiquen al servidor que ignori les actualitzacions dels clients i el tipus de DDNS a usar (actualitzacions dinàmiques de <acronym title="Domain Name System">DNS</acronym>).</div>
</li>
<li class="level1">
<div class="li">Definició de subxarxa: cal definir tants blocs de subxarxa com subxarxes atengui el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Opcions genèriques de subxarxa: per a una subxarxa es poden indicar opcions genèriques per als equips d’aquesta subxarxa. Evidentment poden diferir de les opcions d’altres subxarxes.</div>
</li>
<li class="level1">
<div class="li">Les principals opcions de xarxa a descriure són el router, la màscara de xarxa, el domini, etc.</div>
</li>
<li class="level1">
<div class="li">Les principals opcions a descriure del servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són definir l’interval d’adreces IP dinàmiques a usar pel servidor i el temps màxim de concessió d’aquestes adreces IP.</div>
</li>
<li class="level1">
<div class="li">Per tal que un <em>host</em> determinat tingui sempre la mateixa adreça IP es poden fer entrades individualitzades per a <em>hosts</em> concrets. Els <em>hosts</em> s’identifiquen per la seva adreça MAC.</div>
</li>
<li class="level1">
<div class="li">A un <em>host</em> concret (descrit en una entrada <em>host</em>) se li poden aplicar opcions individualitzades, com per exemple definir el seu nom. Les opcions individuals prevalen sobre les genèriques.</div>
</li>
</ul>
</div>
<h3><a id="configuracio_avancada"></a>Configuració avançada</h3>
<div class="level3">
<p>El protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> permet configuracions d’una certa complexitat. Podeu consultar la documentació de <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i les pàgines de manual del dimoni <em>dhcpd</em> i del fitxer de configuració <em>dhcpd.conf</em>.</p>
<p>Les principals característiques que s’hi descriuen són l’agrupació d’entrades en grups i classes i la possibilitat que el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es comuniqui amb el <acronym title="Domain Name System">DNS</acronym> (actualitzacions DDNS) per crear entrades <acronym title="Domain Name System">DNS</acronym> quan un equip rep una configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<p>Un exemple de configuració amb opcions més avançades:</p>
<ol>
<li class="li1">
<div class="de1">ddns-update-style interim;</div>
</li>
<li class="li1">
<div class="de1">ignore client-updates;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 192.168.1.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># --- default gateway</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">option nis-domain <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"domain.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option time-offset-<span class="nu0">18000</span>;<span class="co0"># Eastern Standard Time </span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">range dynamic-bootp 192.168.1.128 192.168.1.254;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">21600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">43200</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># we want the nameserver to appear at a fixed address </span></div>
</li>
<li class="li1">
<div class="de1">host ns <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">next-server marvin.redhat.com;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet <span class="nu0">12</span>:<span class="nu0">34</span>:<span class="nu0">56</span>:<span class="nu0">78</span>:AB:CD;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 207.175.42.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"Xncd19r"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">49</span>:2b:<span class="nu0">57</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">80</span>:<span class="kw3">fc</span>:<span class="nu0">32</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd8 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">22</span>:<span class="nu0">46</span>:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 10.0.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option routers 10.0.0.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Unknown clients get this pool. </span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers bogus.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">300</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.200 10.0.0.253;</div>
</li>
<li class="li1">
<div class="de1">allow unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Known clients get this pool. </span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.example.com, ns2.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">28800</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.5 10.0.0.199;</div>
</li>
<li class="li1">
<div class="de1">deny unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h3><a id="base_de_dades_de_concessions_fetes_pel_servidor"></a>Base de dades de concessions fetes pel servidor</h3>
<div class="level3">
<p>El servidor desa en una base de dades local (de fet són fitxers de text) les concessions (<em>leases</em>) que realitza. D’aquesta manera en pot seguir la pista en tot moment. Generalment, les té a memòria (per permetre un accés més ràpid), però en manté una còpia a disc. Si, per exemple, el sistema o el servei es reinicia, pot saber quines són les concessions que encara estan actives (i per tant quines adreces IP no té disponibles).</p>
<p>Usualment el fitxer de concessions és a <em>/var/lib/dhcpd</em>. Podem veure’n el contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /var/lib/dhcpd/dhcpd.leases </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># All times in this file are in UTC (GMT), not your local timezone. This is </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># not a bug, so please don't ask about it. There is no portable way to </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># store leases in the local timezone, so please don't request this as a </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># feature. If this is inconvenient or confusing to you, we sincerely </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># apologize. Seriously, though - don't ask. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># The format of this file is documented in the dhcpd.leases(5) manual page. </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># This lease file was written by isc-dhcp-V3.0.5-RedHat </span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:03:<span class="nu0">41</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.254 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">1</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">30</span> 04:<span class="nu0">19</span>:<span class="nu0">30</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:b2:8b:ec;</div>
</li>
<li class="li1">
<div class="de1">client-hostname <span class="st0">"box"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">lease 192.168.1.253 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">starts <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">16</span>:<span class="nu0">27</span>:<span class="nu0">16</span>;</div>
</li>
<li class="li1">
<div class="de1">ends <span class="nu0">0</span> <span class="nu0">2008</span><span class="sy0">/</span>06<span class="sy0">/</span><span class="nu0">29</span> <span class="nu0">22</span>:<span class="nu0">27</span>:<span class="nu0">16</span>;</div>
</li>
<li class="li1">
<div class="de1">binding state active;</div>
</li>
<li class="li1">
<div class="de1">next binding state <span class="kw2">free</span>;</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:<span class="nu0">27</span>:8e:<span class="nu0">72</span>:de;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h3><a id="opcions_de_configuracio_del_servidor_i_ambit_d_aplicacio"></a>Opcions de configuració del servidor i àmbit d'aplicació</h3>
<div class="level3">
<p>Les opcions de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són múltiples i comprenen molts àmbits. Algunes permeten compatibilitat amb sistemes antics, d’altres amb altres tipus de xarxes, etc. No és imaginable que un administrador de xarxes les conegui totes a fons. Normalment farà ús d’un conjunt reduït d’opcions que serà més que suficient per administrar la majoria de xarxes.</p>
<p>La configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es pot definir tant al client com al servidor, tot i que usualment es farà en el servidor. Entenem com a tasca principal la de configurar un servidor per tal de proporcionar les opcions apropiades a cada subxarxa. De totes maneres, però, un client també pot disposar d’un fitxer de configuració on es defineixen quins són els seus requeriments i com ha de realitzar el diàleg amb el servidor. Per exemple es defineixen quines opcions ha de sol·licitar, valors per defecte a determinades opcions (per si el servidor no en proporciona un valor). El client també pot definir informació que proporcionarà al servidor per tal que aquest prengui decisions dinàmicament.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Podeu fer un repàs més extens de la configuració del servidor consultant la secció d’annexos del web d’aquest mòdul.</p>
</div>
</div>
<p>Caldrà, doncs, entendre quins són els àmbits (scope) de definició de sentències i opcions, com s’agrupen les subxarxes i els <em>hosts</em>, quines són les opcions globals, com es realitzen definicions condicionals i molts altres detalls.</p>
</div>
<h4><a id="ambit_de_definicio"></a>Àmbit de definició</h4>
<div class="level4">
<p>Els clients es poden agrupar en diversos àmbits per tal de definir les opcions que han de rebre. El mateix servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot actuar de manera diferent segons sigui l’àmbit de definició.</p>
<p>Alguns dels conceptes a tractar són:</p>
<ul>
<li class="level1">
<div class="li"><em>Subnets</em>.</div>
</li>
<li class="level1">
<div class="li">Període de concessió.</div>
</li>
<li class="level1">
<div class="li">Adreces fixes o reservades: identificació de <em>host</em>.</div>
</li>
<li class="level1">
<div class="li">PXE: Protocol d’arrencada via xarxa.</div>
</li>
<li class="level1">
<div class="li">Àmbit d’aplicació.</div>
</li>
<li class="level1">
<div class="li"><em>Pool</em>.</div>
</li>
</ul>
</div>
<h4><a id="subnets"></a>Subnets</h4>
<div class="level4">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> permet fer assignació dinàmica d’adreces IP per diferents subxarxes sense que es requereixi un servidor específic per a cada subxarxa. Fins i tot el servei es pot oferir a xarxes “llunyanes”, és a dir, que han de creuar almenys un router per accedir al servidor. En aquest cas es parla del concepte <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Relaying.</p>
<p>Per oferir el servei a una subxarxa cal conèixer l’adreça de la xarxa i la seva màscara corresponent. Per cada subxarxa el servidor pot disposar d’un o més intervals d’adreces dinàmiques de les quals obtindrà l’adreça a concedir al client. Uns exemples bàsics poden ser:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># subxarxa amb un interval d'adreces dinàmiques:</span></div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># subxarxa amb dos intervals d'adreces dinàmiques:</span></div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.107;</div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.113 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
</div>
<h4><a id="periode_de_concessio"></a>Període de concessió</h4>
<div class="level4">
<p>Les concessions d’adreces s’efectuen per períodes de temps determinats. Un cop exhaurit aquest temps, cal procedir a renegociar la concessió (que es pot renovar o cancel·lar). De fet les concessions es poden efectuar per períodes des de zero segons a un temps infinit. El temps apropiat en cada cas dependrà del tipus de client i servei que s’ofereix; és diferent un client wireless a l’aeroport que l’estació de treball del supercap executiu de la corporació.</p>
<p>Des del punt de vista de la configuració del servidor es poden establir dos tipus de temps, el <em>default-lease-time</em> i el <em>max-lease-time</em>. El primer permet definir el temps màxim per defecte que es concedeix als clients quan aquests no han sol·licitat cap període de temps concret. El segon estableix el temps màxim de concessió en aquesta subxarxa. Podem veure un exemple d’aquestes opcions:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0"># el temps màxim d'una concessió són 7200 segons, a cap client se li pot concedir més temps. Si el client no ha demanat cap temps concret, se li assigna una concessió de 600 segons.</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.107;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Els períodes de concessió es poden definir globalment per a totes les subxarxes a les quals es proporciona servei, però és més usual fer-ho per cada subxarxa quan aquestes tenen requeriments diferents.</p>
</div>
<h4><a id="adreces_reservades"></a>Adreces reservades</h4>
<div class="level4">
<p>A part de l’assignació dinàmica d’adreces d’interval el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> també pot fer assignacions dinàmiques fixes. És a dir, assignar a un equip sempre la mateixa dreça IP. En aquest cas parlem d’adreça reservada. L’equip ‘consumeix’ aquesta adreça tant si està engegat com si està apagat. Per poder assignar a un <em>host</em> concret sempre la mateixa adreça cal identificar-lo de manera única i inequívoca. Això es pot fer mitjançant la seva adreça MAC. Un exemple pot ser:</p>
<ol>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>Es pot observar que l’opció hardware permet identificar el <em>host</em> iocserver a través de la seva adreça MAC.</p>
</div>
<h4><a id="pxeprotocol_d_arrencada_via_xarxa"></a>PXE: protocol d'arrencada via xarxa</h4>
<div class="level4">
<p>Molts sistemes i targetes de xarxa permeten arrencar clients de xarxa ‘tontos’. És a dir, equips que arranquen sense disposar de sistema operatiu i que el carreguen via xarxa. PXE és un protocol àmpliament utilitzar per a aquest fi. El client rep via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> el nom d’un fitxer que caldrà que descarregui via TFTP. Aquest fitxer acostuma a ser el sistema operatiu o el programari que ha de carregar per inicialitzar-se. L’opció <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que comunica el nom del fitxer a descarregar és l’opció <em>filename</em>.</p>
<ol>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/kernel_ioc.boot"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple s’indica el fitxer <em>kernel_ioc.boot</em> per descarregar per TFTP si s’utilitza un protocol d’arrencada via xarxa com el PXE.</p>
</div>
<h4><a id="opcions_generals"></a>Opcions generals</h4>
<div class="level4">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> proveeix el client no només de l’adreça IP, màscara i gateway, sinó de molts altres paràmetres de configuració de xarxa. Alguns d’aquests paràmetres són molt usuals (<acronym title="Domain Name System">DNS</acronym>, <em>routers</em>, etc) i d’altres molt específics (rars fins i tot).</p>
<p>Tots aquests paràmetres es passen al client en forma d’<em>options</em>. Les opcions poden ser d’àmbit general (per a totes les subxarxes), d’àmbit per a una subxarxa i d’àmbit concret d’un sol <em>host</em>. L’ordre de precedència és de l’àmbit més concret al més general. Un exemple seria:</p>
<div class="iocnote">
<div class="ioccontent">
<p>Per saber més de les opcions específiques es pot consultar la pàgina del manual dhcp-options(5) en un sistema GNU/Linux.</p>
</div>
</div>
<ol>
<li class="li1">
<div class="de1">subnet 239.252.197.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">range 239.252.197.10 239.252.197.250;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option broadcast-address 239.252.197.255;</div>
</li>
<li class="li1">
<div class="de1">option routers 239.252.197.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 239.252.197.2, 239.252.197.3;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"isc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">host iocserver <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 239.252.197.9;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/kernel_ioc.boot"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 192.5.5.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"vix.com"</span>;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En l’exemple anterior s’observa que es defineixen les opcions <em>subnetmask</em>, <em>broadcast-address</em>, <em>routers</em>, <em>domain-name-servers</em> i <em>domain-name</em> per a tots els equips de la subxarxa 239.252.197.0/24. Hi ha dues opcions, però, que es redefineixen amb valors diferents per al <em>host iocserver</em>. Són les opcions <em>domain-name-servers</em> i <em>domain-name</em>.</p>
</div>
<h4><a id="ambit_d_aplicaciosubnet"></a>Àmbit d'aplicació: subnet</h4>
<div class="level4">
<p>Les topologies de xarxa s’estructuren usualment en subxarxes, el mateix passa en la configuració del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Usualment els clients s’agrupen en la subxarxa a la qual pertanyen. S’utilitza la sentència <em>subnet</em> per definir les opcions d’una subxarxa concreta. Si els clients de la subxarxa han de rebre adreces dinàmiques d’interval, cal com a mínim una sentència <em>range</em>.</p>
<p></p>
<p>De vegades convé agrupar subxarxes diferents en un sol bloc d’opcions de configuració. Això passa per exemple quan una sola xarxa física que es vol tractar de la mateixa manera tota ella està dividida en dues subxarxes lògiques. La sentència <em>shared-network</em> s’utilitza en aquestes ocasions.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>Les sentències d’àmbit d’aplicació més usuals són subnet i host, que permeten identificar una subxarxa i un host concret respectivament.</p>
<p>Les subxarxes es poden agrupar en shared-network, els clients es poden agrupar usant la sentència <strong>group</strong>.</p>
<p>Les opcions es poden definir en funció de determinats requisits que compleixi el client mitjançant la sentència <strong>class</strong> i les <strong>declaracions</strong> <strong>condicionals</strong>.</p>
</div>
</div>
<p>Quan els clients han de rebre una adreça IP dinàmica fixa, és a dir, han de rebre sempre la mateixa IP reservada, cal especificar la sentència <em>host</em>. Si es vol que tots els clients siguin únicament equips identificats cal fer una sentència <em>host</em> per a cada equip.</p>
<p>A vegades es vol establir configuracions que afecten equips i xarxes que no tenen una agrupació en forma de subxarxa clara. En aquests casos es pot optar per utilitzar la sentència <em>group</em>. Amb aquesta sentència es poden fer agrupacions d’elements diversos als quals se’ls assignen opcions comunes.</p>
<p>Una altra situació que es pot produir és voler agrupar clients segons determinades condicions que acompleixi el client (no únicament segons la seva MAC). La sentència class permet agrupar opcions segons la informació que envia el mateix client. A més a més, es poden utilitzar declaracions condicionals, és a dir, segons es compleixi o no una determinada condició aplicar unes declaracions o unes altres.</p>
<p>El següent és un exemple de l’esquema bàsic d’un fitxer de configuració dhcp:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">global parameters...</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"ioc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.ioc.org, ns2.ioc.org;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">7200</span>;</div>
</li>
<li class="li1">
<div class="de1">default-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.0 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.1;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.10 204.254.239.30;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.32 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.33;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.42 204.254.239.62;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">subnet 204.254.239.64 netmask 255.255.255.224 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">subnet-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option routers 204.254.239.65;</div>
</li>
<li class="li1">
<div class="de1">range 204.254.239.74 204.254.239.90;</div>
</li>
<li class="li1">
<div class="de1">host grouxo <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">hardware ethernet 08:00:2b:4c:<span class="nu0">59</span>:<span class="nu0">23</span>;</div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"/tftpboot/grouxo.img"</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 204.254.239.91;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">group-specific parameters...</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"marxbrothers.ioc.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">120</span>;</div>
</li>
<li class="li1">
<div class="de1">host zappo.test.isc.org <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host harpo.test.isc.org <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">host-specific parameters...</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple podem observar que:</p>
<ul>
<li class="level1">
<div class="li">es defineixen opcions globals per a totes les xarxes, com per exemple el nom del domini, els servidors de noms (<acronym title="Domain Name System">DNS</acronym>) i els temps de les concessions.</div>
</li>
<li class="level1">
<div class="li">per a cada subxarxa es defineixen opcions específiques com poden ser per exemple l’interval d’adreces disponibles, el router de la subxarxa, etc. També es pot observar que en la subxarxa 204.254.239.64/27 es defineixen opcions particulars per al <em>host grouxo</em>. Concretament obté una adreça IP de l’interval fixa i un fitxer d’inicialització via TFTP.</div>
</li>
<li class="level1">
<div class="li">finalment l’exemple mostra com es poden definir opcions per agrupacions amb la sentència <em>group</em>. Els <em>hosts harpo</em> i <em>zappo</em> estan agrupats i reben un nom de domini particular, diferent al definit en les opcions globals. També se’ls defineix un valor de temps màxim de concessió diferent al global.</div>
</li>
</ul>
<p>Tot seguit es mostra un altre exemple d’estructura de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> on s’agrupen <em>hosts</em> en grups d’afinitats:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osOficines"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">49</span>:2b:<span class="nu0">57</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">80</span>:<span class="kw3">fc</span>:<span class="nu0">32</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd8 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">22</span>:<span class="nu0">46</span>:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osProfessorat"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server ncd-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd2 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">88</span>:2d:<span class="nu0">81</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd3 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:00:<span class="nu0">14</span>:<span class="nu0">11</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">group <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">filename <span class="st0">"osAlumnes"</span>;</div>
</li>
<li class="li1">
<div class="de1">next-server alumni-booter;</div>
</li>
<li class="li1">
<div class="de1">host ncd1 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">11</span>:<span class="nu0">90</span>:<span class="nu0">23</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">host ncd4 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="nu0">91</span>:a7:<span class="nu0">8</span>; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1">...output suprimt ...</div>
</li>
<li class="li1">
<div class="de1">host ncd80 <span class="br0">{</span> hardware ethernet <span class="nu0">0</span>:c0:c3:<span class="kw2">cc</span>:a:8f; <span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple s’han creat tres grups diferents segons si es tracta d’equips de les oficines, del professorat o dels alumnes. S’ha indicat individualment equip per equip mitjançant la sentència <em>host</em>. A cada grup se’ls assigna les opcions que els són comunes (en lloc de fer-ho repetidament dins de cada <em>host</em>). En aquest cas representa que els equips són terminals “ximples” que carreguen el sistema operatiu des de la xarxa. Cada grup carrega un sistema operatiu diferent. Oficines i professors el descarreguen del mateix servidor, mentre que els alumnes ho fan d’un altre anomenat <em>alumni-booter</em>.</p>
<p>Existeix un altre mecanisme per agrupar declaracions anomenat <em>pool</em> i que permet fer agrupacions d’adreces. Cada agrupació d’adreces o <em>pool</em> pot ser tractat de manera diferent. Es poden definir diferents pool dins d’una mateixa subxarxa (<em>subnet</em>). Possiblement, la millor manera d’entendre com funciona és mitjançant un exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#exemple extret de la pàgina de configuració del dhcpd.conf(5)</span></div>
</li>
<li class="li1">
<div class="de1">subnet 10.0.0.0 netmask 255.255.255.0 <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option routers 10.0.0.254;</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Unknown clients get this pool.</span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers noexisteixo.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">300</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.200 10.0.0.253;</div>
</li>
<li class="li1">
<div class="de1">allow unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># Known clients get this pool.</span></div>
</li>
<li class="li1">
<div class="de1">pool <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.example.com, ns2.example.com;</div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">28800</span>;</div>
</li>
<li class="li1">
<div class="de1">range 10.0.0.5 10.0.0.199;</div>
</li>
<li class="li1">
<div class="de1">deny unknown-clients;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<p>En aquest exemple la subxarxa 10.0.0.0/8 es divideix en dos <em>pool</em> d’adreces per ser tractats de manera diferent. En el primer s’assignen dinàmicament adreces IP de la 200 a la 253 i s’assigna també un servidor de noms inexistent. Seran clients d’aquest <em>pool</em> els equips que siguin no identificats (<em>unknown-clients</em>). En el segon pool s’accepten només clients coneguts, als quals s’assignen adreces IP de la 5 a la 199 i dos servidors de noms existents.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Polítiques d'accés</p>
<p>Per saber més de les polítiques d’accés es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>D’aquest exemple podem observar que la sentència <em>pool</em> permet establir polítiques d’accés (<em>permit lists</em>) definint quins clients poden accedir al <em>pool</em> i quins no. El tractament de les polítiques d’accés queda fora de l’abast d’aquest llibre, però és molt intuïtiu. La clàusula <em>allow</em> indica els clients amb accés i la clàusula <em>deny</em> els clients que no podran accedir al <em>pool</em>.</p>
</div>
<h4><a id="class"></a>Class</h4>
<div class="level4">
<p>Una de les eines més potents per agrupar clients és la sentència class. Els clients es poden tractar de manera diferent segons a quina classe pertanyin. Per determinar la classe del client es poden usar les dades que el mateix client proporciona. S’utilitzen sentències condicionals i tractament d’expressions (<em>conditional, match statement</em>) que s’avaluen per determinar si el client pertany o no a una classe. Per exemple es pot crear una classe amb tots aquells clients que contenen l’identificador “IOC”:</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Classes</p>
<p>Per saber més de les classes es pot consultar la pàgina de manual del dhcpd.conf(5) en un sistema GNU/Linux. Per saber com tractar i avaluar expressions es pot consultar el manual dhcp-eval(5) en un sistema GNU/Linux. Per saber més de les opcions específiques es pot consultar el manual dhcp-options(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>Les classes es poden subdividir en subclasses que corresponen a valors específics que satisfan l’expressió de la classe. El tractament de les classes, condicions i expressions queda fora de l’abast d’aquest material. Per conèixer bé les classes cal conèixer el tractament d’expressions i les opcions específiques del <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
</div>
<h3><a id="sentencies_i_opcions_de_configuracio"></a>Sentències i opcions de configuració</h3>
<div class="level3">
<p>El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es pot configurar amb multitud de sentències que es poden repassar de l’<acronym title="Request for Comments">RFC</acronym> 2131 i de la pàgina de manual dhcpd.conf(5). Examinem tot seguit alguna d’aquestes sentències.</p>
</div>
<h4><a id="declaracions"></a>Declaracions</h4>
<div class="level4">
<ul>
<li class="level1">
<div class="li"><strong>Include:</strong> include “filename”; Permet carregar el fitxer indicat i processar-lo com a fitxer de configuració. És una tècnica usual per dividir la configuració en mòduls.</div>
</li>
<li class="level1">
<div class="li"><strong>Shared-network:</strong> shared-network name { [ parameters ] [ declarations ] } Permet agrupar diverses subxarxes (subnet) en una mateixa declaració. S’utilitza quan una mateixa xarxa física es compon de diverses subxarxes lògiques.</div>
</li>
<li class="level1">
<div class="li"><strong>Subnet:</strong> subnet subnet-number netmask netmask { [ parameters ] [ declarations ] } Permet definir opcions per a una subxarxa concreta. És la sentència més usual en les definicions de configuració del servidor dhcp.</div>
</li>
<li class="level1">
<div class="li"><strong>Range:</strong> range [ dynamic-bootp ] low-address [ high-address]; Indica l’interval d’adreces dinàmiques disponibles per assignar. El servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> extreu les adreces dinàmiques d’aquest interval d’adreces.</div>
</li>
<li class="level1">
<div class="li"><strong>Host:</strong> host hostname { [ parameters ] [ declarations ] } Proporciona un àmbit de definició per a un equip concret. Les opcions que es defineixen dins d’una sentència <em>host</em> afecten únicament l’equip indicat. Es requereix una sentència <em>host</em> per poder fer assignacions dinàmiques fixes (assignar sempre la mateixa adreça IP basant-se en l’adreça MAC).</div>
</li>
<li class="level1">
<div class="li"><strong>Group:</strong> group { [ parameters ] [ declarations ] } S’utilitza per agrupar declaracions de manera que les opcions definides afectin el grup d’elements que conté. Aquests poden ser <em>shared-networks</em>, <em>subnets</em>, <em>hosts</em> i fins i tot altres grups.</div>
</li>
</ul>
</div>
<h4><a id="parametres"></a>Paràmetres</h4>
<div class="level4">
<p>Tot seguit es mostren alguns dels paràmetres que es poden definir en el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ul>
<li class="level1">
<div class="li"><strong>authoritative</strong> authoritative; not authoritative; Indica si les respostes del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> són autoritatives o no. Si ho són el servidor revocarà les adreces IP que ell no ha concedit.</div>
</li>
<li class="level1">
<div class="li"><strong>ddns-update-style</strong> ddns-update-style style; Pot ser <em>ad-hoc</em> o <em>interim</em> o <em>none</em>. Indica el tipus de <em>dynamyc <acronym title="Domain Name System">DNS</acronym></em> que s’utilitza.</div>
</li>
<li class="level1">
<div class="li"><strong>default-lease-time</strong> default-lease-time time; Indica el temps per defecte de les concessions. És el temps que es concedeix quan el client no requereix un període de temps concret.</div>
</li>
<li class="level1">
<div class="li"><strong>fixed-address</strong> fixed-address address [, address … ]; Permet assignar una o més adreces IP a un client.</div>
</li>
<li class="level1">
<div class="li"><strong>hardware</strong> hardware hardware-type hardware-address; Indica el tipus i el valor de l’adreça Mac d’un client. Aquest mecanisme és necessari per poder identificar un client de manera única, per exemple en una clàusula <em>host</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>max-lease-time</strong> max-lease-time time; Indica el temps màxim per a les concessions en segons.</div>
</li>
<li class="level1">
<div class="li"><strong>min-lease-time</strong> min-lease-time time; Indica el temps mínim que han de durar les concessions.</div>
</li>
<li class="level1">
<div class="li"><strong>next-server</strong> next-server server-name; Indica el nom o l’adreça IP del servidor TFTP del qual el client s’ha de descarregar el fitxer d’inicialització (o <em>boot</em>) indicat pel paràmetre <em>filename</em>. Si no s’indica s’utilitza el propi servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
</ul>
</div>
<h4><a id="opcions_de_configuracio"></a>Opcions de configuració</h4>
<div class="level4">
<p>Els clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> reben del servidor la configuració de xarxa. Usualment parlem de l’adreça IP i la màscara, però de fet poden rebre gran quantitat</p>
<p>de paràmetres de configuració de xarxa i informació sobre diversos serveis de xarxa disponibles. El client per la seva part pot sol·licitar paràmetres concrets al servidor. L’administrador de xarxa, quan configura el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, no ha d’especificar totes les opcions possibles (de fet són moltíssimes), sinó només aquelles que siguin necessàries per a cada client. Algunes opcions prenen valors per defecte i no cal especificar-les, d’altres no poden ser alterades pel servidor.</p>
<p>En aquest apartat es farà la llista de la majoria de paràmetres que corresponen a opcions globals de configuració <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Alguns paràmetres són indicats pel client, d’altres pel servidor i n’hi ha que són per defecte i no es poden modificar.</p>
<ul>
<li class="level1">
<div class="li"><strong>option bootfile-name</strong> bootfile-name text; Indica el nom del fitxer que el client s’ha de descarregar per tal d’iniciar el procés d’arrancada o <em>boot</em>. El fitxer es descarrega via TFTP del mateix servidor o de l’indicat amb l’opció <em>next-server</em>. Fa la mateixa funció que la sentència <em>filename</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>option dhcp-lease-time</strong> dhcp-lease-time uint32; Aquesta opció permet al client demanar al servidor la concessió per a un període concret de temps.</div>
</li>
<li class="level1">
<div class="li"><strong>option dhcp-message-type</strong> dhcp-message-type uint8; Indica el tipus de missatge <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que s’està enviant, tant pel client com pel servidor. Els tipus possibles són:</div>
<ul>
<li class="level2">
<div class="li">DHCPDISCOVER</div>
</li>
<li class="level2">
<div class="li">DHCPOFFER</div>
</li>
<li class="level2">
<div class="li">DHCPREQUEST</div>
</li>
<li class="level2">
<div class="li">DHCPDECLINE</div>
</li>
<li class="level2">
<div class="li">DHCPACK</div>
</li>
<li class="level2">
<div class="li">DHCPNAK</div>
</li>
<li class="level2">
<div class="li">DHCPRELEASE</div>
</li>
<li class="level2">
<div class="li">DHCPINFORM</div>
</li>
</ul>
</li>
<li class="level1">
<div class="li"><strong>option domain-name</strong> domain-name text; Indica el nom de domini que el client ha d’utilitzar per fer resolucions <acronym title="Domain Name System">DNS</acronym>.</div>
</li>
<li class="level1">
<div class="li"><strong>option domain-name-servers</strong> domain-name-servers ip-address [, ip-address… ]; Especifica la llista de servidors de noms de domini que el client ha d’utilitzar.</div>
</li>
<li class="level1">
<div class="li"><strong>option host-name</strong> host-name string; Especifica el nom del client.</div>
</li>
<li class="level1">
<div class="li"><strong>option netbios-name-servers</strong> netbios-name-servers ip-address [, ip-address…]; L’opció NetBios name server (NBNS) especifica una llista de servidors <acronym title="Request for Comments">RFC</acronym> 1001/1002 NBNS name servers en ordre de preferència. És a dir, indica la llista de servidors NetBios a usar pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option nis-servers</strong> nis-servers ip-address [, ip-address… ]; Especifica una llista de servidors <acronym title="Network Information Service">NIS</acronym> disponibles pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option ntp-servers</strong> ntp-servers ip-address [, ip-address… ]; Indica una llista de servidors NTP disponibles pel client.</div>
</li>
<li class="level1">
<div class="li"><strong>option routers</strong> routers ip-address [, ip-address… ]; Especifica una llista de routers disponibles pel client en la seva pròpia subxarxa.</div>
</li>
<li class="level1">
<div class="li"><strong>option tftp-server-name</strong> tftp-server-name text; Indica el nom del servidor TFTP.</div>
</li>
</ul>
</div>
<h3><a id="expressions"></a>Expressions</h3>
<div class="level3">
<p>Una de les grans potències que proporciona <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és poder configurar les opcions de xarxa en funció de qui i com és el client. És a dir, en funció de la informació que proporciona el client assignar-li una o altra configuració de xarxa. Fixeu-vos que no es tracta d’entrades <em>host</em> estàtiques per a cada client, sinó que un mateix client tindrà una o altra configuració segons la informació que proporcioni.</p>
<div class="ioctext">
<div class="ioccontent">
<p class="ioctitle">Avaluar expressions</p>
<p>Per obtenir més informació sobre expressions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i mecanismes d’avaluació cal consultar la pàgina de manual dhcp.eval(5) en un sistema GNU/Linux.</p>
</div>
</div>
<p>Per poder fer això cal poder avaluar expressions i condicions basades en la informació del mateix client. Existeix, doncs, tot un llenguatge per escriure expressions i avaluar-les.</p>
<div class="iocimportant">
<div class="ioccontent">
<p>El mecanisme per definir expressions és:</p>
<pre class="code">paràmetre = expressió ;</pre>
</div>
</div>
<p>Un exemple que mostra com definir el paràmetre ddns-hostname (que defineix el nom del client a usar en l’actualització dinàmica de <acronym title="Domain Name System">DNS</acronym>) usant part de l’adreça MAC del client:</p>
<ol>
<li class="li1">
<div class="de1">ddns-hostname = binary-to-ascii <span class="br0">(</span><span class="nu0">16</span>, <span class="nu0">8</span>, <span class="st0">"-"</span>, substring <span class="br0">(</span>hardware, <span class="nu0">1</span>, <span class="nu0">6</span><span class="br0">)</span><span class="br0">)</span>;</div>
</li>
</ol>
<p>Es poden construir expressions similars a les dels llenguatges de programació. Per fer-ho es disposa d’estructures condicionals i de diversos tipus d’operadors. Anem a analitzar-ne uns quants:</p>
<ul>
<li class="level1">
<div class="li"><strong>Estructures condicionals</strong> (<em>Conditional behaviour</em>). Permeten realitzar definicions segons sigui el valor d’una opció (o d’una expressió). Utilitza les conegudes estructures <em>if</em>, <em>elsif</em> i <em>else</em>.</div>
</li>
</ul>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Exemple de sentència condicional en el servidor</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#Extret de la pàgina de manual dhcpd.eval(5)</span></div>
</li>
<li class="li1">
<div class="de1"><span class="kw1">if</span> option dhcp-user-class = <span class="st0">"accounting"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"accounting.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.accounting.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.accounting.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> elsif option dhcp-user-class = <span class="st0">"sales"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"sales.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.sales.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.sales.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> elsif option dhcp-user-class = <span class="st0">"engineering"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">17600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"engineering.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.engineering.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.engineering.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span> <span class="kw1">else</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">max-lease-time <span class="nu0">600</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"misc.example.org"</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers ns1.misc.example.org,</div>
</li>
<li class="li1">
<div class="de1">ns2.misc.example.org;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<div class="iocimportant">
<div class="ioccontent">
<p>En aquest exemple es defineixen les opcions <em>max-lease-time</em>, <em>domain-name</em> i <em>domain-name-servers</em> de manera diferent segons sigui el valor de l’opció <em>dhcp-user-class</em> enviat pel client.</p>
<p>Les definicions condicionals també es poden fer en la part client. L’exemple següent mostra que si el client no ha rebut el paràmetre <em>domain-name</em>, ell mateix autodefineix el valor del paràmetre <em>domain-name-servers</em> al <em>loopback</em>.</p>
</div>
</div>
<p>Exemple de sentència condicional en el servidor</p>
<p></p>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Extret de la pàgina de manual dhcpd.eval(5)</span></div>
</li>
<li class="li1">
<div class="de1"><span class="kw1">if</span> not option domain-name = <span class="st0">"example.org"</span> <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">prepend domain-name-servers 127.0.0.1;</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">}</span></div>
</li>
</ol>
<ul>
<li class="level1">
<div class="li"><strong>Expressions booleanes</strong> (<em>Boolean expressions</em>). Igual que passa en els llenguatges de programació, permeten definir expressions utilitzant els operadors booleans clàssics: <em>=</em>, <em>and</em>, <em>or</em>, <em>not</em>, <em>exists</em>. També els operadors <em>known</em> i <em>static</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Expressions de tractament de text</strong> (<em>Data expressions</em>). Són similars a les típiques funcions de tractament de cadenes dels llenguatges de programació. Corresponen a: <em>substring</em>, <em>suffix</em>, <em>option</em>, <em>config-option</em>, <em>hardware</em>, <em>packet</em>, <em>concat</em>, <em>reverse</em>, <em>leased-address</em>, <em>binary-to-ascii</em>,<em>encode-int</em>, <em>pick-first-value</em> i <em>host-decl-name</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Expressions numèriques</strong> (<em>Numeric expressions</em>). Les expressions numèriques realitzen la seva avaluació retornant un enter. Són exemples d’aquesta categoria: <em>extract-int</em>, <em>lease-time</em> i <em>client-state</em>.</div>
</li>
<li class="level1">
<div class="li"><strong>Monitoratge</strong> (<em>Logging</em>). Es permeten definir expressions que s’enregistraran en els fitxers de monitoratge del sistema. És molt útil si es treballa amb definicions condicionals i expressions perquè permet fer un seguiment (com un <em>debug</em>) de com s’ha avaluat l’expressió o la condició.</div>
</li>
</ul>
<ol>
<li class="li1">
<div class="de1"><span class="co0">#Exemple de log</span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#log (priority, data-expr) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0">#Les prioritats poden ser: fatal, error, info, debug</span></div>
</li>
<li class="li1">
<div class="de1">log <span class="br0">(</span>info, concat<span class="br0">(</span>hardware, <span class="kw2">hostname</span><span class="br0">)</span></div>
</li>
</ol>
<div class="iocimportant">
<div class="ioccontent">
<p>Aquest exemple generarà una entrada en el fitxer de <em>log</em> mostrant l’adreça Mac del client i el seu nom de <em>host</em>.</p>
</div>
</div>
<ul>
<li class="level1">
<div class="li"><strong>Actualitzacions <acronym title="Domain Name System">DNS</acronym> dinàmiques</strong> (<em>dynamic <acronym title="Domain Name System">DNS</acronym> updates</em>). El servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot interactuar amb el servei <acronym title="Domain Name System">DNS</acronym> de manera que les concessions <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> s’actualitzin automàticament en la base de dades <acronym title="Domain Name System">DNS</acronym>. Aquesta funció la poden fer tant els clients com els servidors <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quan parlem d’actualitzacions dinàmiques del <acronym title="Domain Name System">DNS</acronym> estem parlant de DDNS (<em>dynamic domain name system</em>). Com cal fer aquestes actualitzacions i quina informació cal posar al <acronym title="Domain Name System">DNS</acronym> és el que es pot personalitzar amb aquestes opcions.</div>
</li>
</ul>
<div class="iocnote">
<div class="ioccontent">
<p>Per saber més de les actualitzacions dinàmiques de <acronym title="Domain Name System">DNS</acronym> consulteu l’<acronym title="Request for Comments">RFC</acronym> 2136.</p>
</div>
</div>
</div>
<h2><a id="configuracio_dels_parametres_de_xarxa_del_client"></a>Configuració dels paràmetres de xarxa del client</h2>
<div class="level2">
<p>Els clients de xarxa o bé tenen una configuració estàtica on es defineix cada paràmetre en el client o bé reben la configuració via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. El procés de configurar un client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és tan senzill com activar aquesta última opció usant algun dels mètodes adients.</p>
<p>La configuració dels clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> consisteix en el següent:</p>
<ul>
<li class="level1">
<div class="li">Observar la configuració de xarxa actual del client.</div>
</li>
<li class="level1">
<div class="li">Configurar el client per rebre dinàmicament una adreça IP. Es tracta d’activar/desactivar la configuració de xarxa dinàmica o estàtica.</div>
</li>
<li class="level1">
<div class="li">Sol·licitar/renegociar una nova IP al servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</div>
</li>
<li class="level1">
<div class="li">Observar/fer la llista del fitxer de registre de les concessions client rebudes.</div>
</li>
<li class="level1">
<div class="li">Activar/desactivar el servei de xarxa en el client.</div>
</li>
</ul>
</div>
<h3><a id="observar_la_configuracio_de_xarxa_actual"></a>Observar la configuració de xarxa actual</h3>
<div class="level3">
<p>L’administrador ha de tenir la precaució d’observar quina és la configuració de xarxa actual abans d’establir-ne una de nova. Si cal ha de deixar anotada la configuració anterior per tal de poder restablir-la. La configuració de xarxa bàsica consisteix en l’adreça IP, la màscara de xarxa, la porta d’enllaç per defecte i el servidor <acronym title="Domain Name System">DNS</acronym> a utilitzar. També s’hi pot incloure el nom de l’equip, les rutes i multitud d’altres paràmetres.</p>
<p>Es pot fer la llista de la configuració de les interfícies ethernet i observar les adreces IP, l’estat de les interfícies (UP o DOWN) i les rutes definides fent:</p>
<p>Fer la llista de les adreces MAC i IP i les dades de les interfícies</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># ip address show</span></div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">1</span>: lo: <span class="sy0">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="sy0">&gt;</span> mtu <span class="nu0">16436</span> qdisc noqueue</div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div>
</li>
<li class="li1">
<div class="de1">inet 127.0.0.1<span class="sy0">/</span><span class="nu0">8</span> scope host lo</div>
</li>
<li class="li1">
<div class="de1">inet6 ::<span class="nu0">1</span><span class="sy0">/</span><span class="nu0">128</span> scope host</div>
</li>
<li class="li1">
<div class="de1">valid_lft forever preferred_lft forever</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">2</span>: eth0: <span class="sy0">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="sy0">&gt;</span> mtu <span class="nu0">1500</span> qdisc pfifo_fast qlen <span class="nu0">1000</span></div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>ether 00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e brd ff:ff:ff:ff:ff:ff</div>
</li>
<li class="li1">
<div class="de1">inet 192.168.1.34<span class="sy0">/</span><span class="nu0">24</span> brd 192.168.1.255 scope global eth0</div>
</li>
<li class="li1">
<div class="de1">inet6 fe80::<span class="nu0">217</span>:31ff:fe15:807e<span class="sy0">/</span><span class="nu0">64</span> scope <span class="kw2">link</span></div>
</li>
<li class="li1">
<div class="de1">valid_lft forever preferred_lft forever</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3</span>: sit0: <span class="sy0">&lt;</span>NOARP<span class="sy0">&gt;</span> mtu <span class="nu0">1480</span> qdisc noop</div>
</li>
<li class="li1">
<div class="de1">link<span class="sy0">/</span>sit 0.0.0.0 brd 0.0.0.0</div>
</li>
</ol>
<p>Fer la llista de les rutes definides en el host:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># ip route show</span></div>
</li>
<li class="li1">
<div class="de1">192.168.1.0<span class="sy0">/</span><span class="nu0">24</span> dev eth0 proto kernel scope <span class="kw2">link</span> src 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">169.254.0.0<span class="sy0">/</span><span class="nu0">16</span> dev eth0 scope <span class="kw2">link</span></div>
</li>
<li class="li1">
<div class="de1">default via 192.168.1.1 dev eth0</div>
</li>
</ol>
<p>Si s’observen els fitxers de configuració de les interfícies de xarxa, es pot veure si els paràmetres de xarxa estan definits estàticament o dinàmicament. En la llista següent es pot veure que la interfície <em>loopback</em> es configura estàticament i la interfície <em>eth0</em> es configura via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=eth0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BOOTPROTO</span>=dhcp</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">TYPE</span>=Ethernet</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-lo</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=lo</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">IPADDR</span>=127.0.0.1</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NETMASK</span>=255.0.0.0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NETWORK</span>=127.0.0.0</div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># If you're having problems with gated making 127.0.0.0/8 a martian, </span></div>
</li>
<li class="li1">
<div class="de1"><span class="co0"># you can change this to something else (255.255.255.255, for example) </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BROADCAST</span>=127.255.255.255</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">NAME</span>=loopback</div>
</li>
</ol>
<p>Un error usual és creure que el servei <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> no funciona correctament quan de fet el que passa és que el client no té el servei de xarxa activat. Es pot comprovar l’estat del servei de xarxa fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service NetworkManager status </span></div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># service network status </span></div>
</li>
<li class="li1">
<div class="de1">Dispositius configurats:</div>
</li>
<li class="li1">
<div class="de1">lo eth0</div>
</li>
<li class="li1">
<div class="de1">Dispositius actius actualment:</div>
</li>
<li class="li1">
<div class="de1">lo eth0</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Activar i desactivar el servei de xarxa:</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># /etc/init.d/network stop</span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està aturant la interficie eth0: [ FET ]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està aturant la interficie loopback: <span class="br0">[</span> FET <span class="br0">]</span></div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># /etc/init.d/network start</span></div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està activant la interficie loopback: [ FET ]</span></div>
</li>
<li class="li1">
<div class="de1"><span class="st_h">S'</span>està activant la interficie eth0:</div>
</li>
<li class="li1">
<div class="de1">S<span class="st_h">'està determinant la informació de la IP per a eth0... fet [FET]</span></div>
</li>
</ol>
</div>
<h3><a id="configurar_el_client_com_a_client_dinamic"></a>Configurar el client com a client dinàmic</h3>
<div class="level3">
<p>Tot equip client de xarxa necessita una configuració apropiada. Si aquesta configuració es defineix element per element en el mateix equip, s’anomena configuració estàtica. Si és així, no cal per res un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. És quan els clients reben la configuració de xarxa externament que parlem de configuració dinàmica i ens cal un servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> que la proporcioni.</p>
<p>La configuració del client es pot fer en mode text editant directament els fitxers de configuració de les interfícies de xarxa, utilitzant interfícies en mode text o utilitzant interfícies gràfiques (<em>applets</em>). Vegem cada un d’aquests mètodes.</p>
</div>
<h4><a id="editar_els_fitxers_de_configuracio"></a>Editar els fitxers de configuració</h4>
<div class="level4">
<p>Es pot editar directament el fitxer de configuració de la interfície pertinent i establir l’opció <em>BOOTPROTO</em> al valor <em>dhcp</em> per tal d’activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Si per exemple es configura la interfície <em>eth0</em> seria un fitxer similar al següent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">DEVICE</span>=eth0</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">ONBOOT</span>=<span class="kw2">yes</span></div>
</li>
<li class="li1">
<div class="de1"><span class="re2">BOOTPROTO</span>=dhcp</div>
</li>
<li class="li1">
<div class="de1"><span class="re2">TYPE</span>=Ethernet</div>
</li>
</ol>
</div>
<h4><a id="menus_amb_interficie_de_text"></a>Menús amb interfície de text</h4>
<div class="level4">
<p>Un altre mecanisme per activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és utilitzar alguna utilitat de menús en entorn de text (varien segons el sistema i n’hi ha de disponibles per Internet).</p>
<p>Una eina força utilitzada és la utilitat <em>setup</em> que es pot observar en la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura2"><span>figura</span>.2</a></span>, que mostra una configuració de client de xarxa estàtica i es pot veure que la casella que permet activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> està desactivada.</p>
<div class="iocfigure"><a name="Figura2"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Configuració estàtica del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym></figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im2.png" alt="" /></figure>
<p></p>
</div>
<p>Observeu que senzill que és el procediment per activar el client de xarxa <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. N’hi ha prou d’activar l’opció pertinent, tal com es mostra en la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura3"><span>figura</span>.3</a></span>.</p>
<div class="iocfigure"><a name="Figura3"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Activació del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> usant menús de text</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im3.png" alt="" /></figure>
<p></p>
</div>
</div>
<h4><a id="menus_en_mode_grafic"></a>Menús en mode gràfic</h4>
<div class="level4">
<p>En mode gràfic el sistema també proporciona mecanismes per configurar les interfícies de xarxa i establir el mode d’activació a <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura4"><span>figura</span>.4</a></span> es pot observar que la configuració de la interfície <em>eth0</em> té activada l’opció per rebre la configuració de xarxa via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<div class="iocfigure"><a name="Figura4"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Activació del client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> usant l’entorn gràfic</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im4.png" alt="" /></figure>
<p></p>
</div>
</div>
<h3><a id="demanar_una_nova_adreca_ip"></a>Demanar una nova adreça IP</h3>
<div class="level3">
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> pot alliberar l’adreça que utilitza quan ho creu pertinent. En fer-ho el servidor anota el fi de la concessió i si es tracta d’una adreça dinàmica d’interval aquesta torna a estar disponible per assignar-la a un altre client. Quan a un client se li està acabant el temps de la concessió ha de tornar a negociar una adreça amb el servidor. De totes maneres si el client vol, pot tornar a sol·licitar-ne una en un moment o altre.</p>
<p>El client pot alliberar una adreça (<em>release</em>) que està en ús un moment o altre, pot forçar-ho fent, per exemple:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># dhclient -r </span></div>
</li>
<li class="li1">
<div class="de1">Internet Systems Consortium DHCP Client V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">DHCPRELEASE on eth0 to 192.168.1.1 port <span class="nu0">67</span></div>
</li>
</ol>
<p>Per forçar el client a demanar una nova adreça per a la interfície ethernet <em>eth0</em> es pot fer:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>portatil ~<span class="br0">]</span><span class="co0"># dhclient eth0 </span></div>
</li>
<li class="li1">
<div class="de1">Internet Systems Consortium DHCP Client V3.0.5-RedHat</div>
</li>
<li class="li1">
<div class="de1">Copyright <span class="nu0">2004</span>-<span class="nu0">2006</span> Internet Systems Consortium.</div>
</li>
<li class="li1">
<div class="de1">All rights reserved.</div>
</li>
<li class="li1">
<div class="de1">For info, please visit http:<span class="sy0">//</span>www.isc.org<span class="sy0">/</span>sw<span class="sy0">/</span>dhcp<span class="sy0">/</span></div>
</li>
<li class="li1">
<div class="de1">Listening on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on LPF<span class="sy0">/</span>eth0<span class="sy0">/</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e</div>
</li>
<li class="li1">
<div class="de1">Sending on Socket<span class="sy0">/</span>fallback</div>
</li>
<li class="li1">
<div class="de1">DHCPDISCOVER on eth0 to 255.255.255.255 port <span class="nu0">67</span> interval <span class="nu0">5</span></div>
</li>
<li class="li1">
<div class="de1">DHCPOFFER from 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">DHCPREQUEST on eth0 to 255.255.255.255 port <span class="nu0">67</span></div>
</li>
<li class="li1">
<div class="de1">DHCPACK from 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">bound to 192.168.1.34 <span class="re5">--</span> renewal <span class="kw1">in</span> <span class="nu0">38975</span> seconds.</div>
</li>
</ol>
</div>
<h3><a id="observar_el_registre_client_de_les_concessions_rebudes"></a>Observar el registre client de les concessions rebudes</h3>
<div class="level3">
<p>El client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> porta un registre de les concessions rebudes, d’aquesta manera pot tornar a demanar una concessió abans que expiri l’actual. També pot servir per demanar al servidor preferentment una adreça IP concreta. Les concessions o <em>leases</em> del client es desen en un fitxer anomenat <em>/var/lib/dhclient/dhclient.leases</em>. Podem veure’n el contingut fent:</p>
<ol>
<li class="li1">
<div class="de1"><span class="br0">[</span>root<span class="sy0">@</span>pc<span class="br0">]</span><span class="co0"># cat /var/lib/dhclient/dhclient.leases </span></div>
</li>
<li class="li1">
<div class="de1">lease <span class="br0">{</span></div>
</li>
<li class="li1">
<div class="de1">interface <span class="st0">"eth0"</span>;</div>
</li>
<li class="li1">
<div class="de1">fixed-address 192.168.1.34;</div>
</li>
<li class="li1">
<div class="de1">option subnet-mask 255.255.255.0;</div>
</li>
<li class="li1">
<div class="de1">option routers 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-lease-time <span class="nu0">86400</span>;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-message-type <span class="nu0">5</span>;</div>
</li>
<li class="li1">
<div class="de1">option domain-name-servers 80.58.61.250,80.58.61.254;</div>
</li>
<li class="li1">
<div class="de1">option dhcp-server-identifier 192.168.1.1;</div>
</li>
<li class="li1">
<div class="de1">option domain-name <span class="st0">"local.lan"</span>;</div>
</li>
<li class="li1">
<div class="de1">renew <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> 04:05:<span class="nu0">49</span>;</div>
</li>
<li class="li1">
<div class="de1">rebind <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> <span class="nu0">15</span>:<span class="nu0">12</span>:<span class="nu0">57</span>;</div>
</li>
<li class="li1">
<div class="de1">expire <span class="nu0">3</span> <span class="nu0">2007</span><span class="sy0">/</span><span class="nu0">12</span><span class="sy0">/</span><span class="nu0">19</span> <span class="nu0">18</span>:<span class="nu0">12</span>:<span class="nu0">57</span>;</div>
</li>
</ol>
</div>
<h2><a id="comprovacio_del_funcionament_dhcp"></a>Comprovació del funcionament DHCP</h2>
<div class="level2">
<p>La millor manera de comprovar el funcionament <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> és simplement posant-lo en pràctica, és a dir, crear una xarxa amb diversos clients <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> i un servidor que els atengui. Com es pot saber si funciona? Fàcil, mirant un a un cada client i comprovant que han rebut la configuració de xarxa correcta. El problema, però, és què fem si els clients no es configuren correctament.</p>
<p>Els passos més usuals a seguir per a la resolució de problemes són:</p>
<ul>
<li class="level1">
<div class="li">Comprovar que la xarxa està correctament connectada físicament, és a dir cables, connectors, interfícies, etc.</div>
</li>
<li class="level1">
<div class="li">Mirar si existeix connectivitat entre els equips, per exemple usant una configuració estàtica. Això permetrà descartar que els problemes siguin deguts a altres causes. Si el <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> no va és que no està configurat correctament.</div>
</li>
<li class="level1">
<div class="li">Repassar la configuració del client i del servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, especialment la del servidor. Es pot començar fent la configuració tan senzilla com sigui possible. Un cop funciona es pot anar avançant en la seva complexitat.</div>
</li>
<li class="level1">
<div class="li">Examinar els fitxers de concessions, tant el del client com el del servidor, per detectar-hi anomalies.</div>
</li>
<li class="level1">
<div class="li">Quan la comunicació client/servidor no funciona correctament i no sabem el perquè és molt útil monitorar el trànsit de xarxa mitjançant alguna eina d’anàlisi dels paquets que viatgen per la xarxa.</div>
</li>
</ul>
<p>Centrem-nos, doncs, en la monitoratge del trànsit de xarxa per tal d’analitzar que el diàleg entre el client i el servidor és l’apropiat. Existeixen moltes eines al mercat (que podeu trobar per Internet) que fan aquesta funció. Un de les més recomanables és l’aplicació <em>wireshark</em>. Amb aquesta eina hem de poder observar l’intercanvi dels paquets <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Discover</em>, <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Offer</em>, <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Request</em> i <em><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> Ack</em> que es produeix quan tot el procés <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> funciona correctament. Si aquest intercanvi no es produeix és que existeix algun problema.</p>
<div class="iocreference">
<div class="ioccontent">
<p>En l’apartat “El model funcional del protocol <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>” podeu observar detalladament com és el diàleg entre el client i el servidor.</p>
</div>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>En l’apartat “Demanar una nova adreça IP” es pot observar com forçar el client a demanar una nova configuració.</p>
</div>
</div>
<p>En la <span class="figref"><a href="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/a1/continguts.html#Figura5"><span>figura</span>.5</a></span> podeu observar una captura de trànsit <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> feta amb <em>Wireshark</em>. La captura s’ha fet al servidor i el client s’ha forçat a demanar de nou una configuració de xarxa amb la utilitat <em>dhclient</em>.</p>
<div class="iocfigure"><a name="Figura5"></a>
<p></p>
<figure>
<figcaption style="width: 430px; max-width: 75%;"><span class="figuretitle">Figura</span> Captura d’un diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client/servidor</figcaption>
<img src="http://ioc.xtec.cat/materials/FP/Materials/2201_SMX/SMX_2201_M07/web/html/WebContent/u1/media/smxm7uf1ud1_im5.png" alt="" /></figure>
<p></p>
</div>
<div class="iocreference">
<div class="ioccontent">
<p>Podeu manipular vosaltres mateixos la captura del trànsit de xarxa <acronym title="Domain Name System">DNS</acronym> carregant el fitxer de captura del <em>wireshark</em> que es lliura com a material complementari. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.</p>
</div>
</div>
<p>A continuació es pot observar la llista de text de les quatre trames capturades amb el <em>wireshark</em> que s’han exportat en format text. Això permet veure detalladament tot el diàleg <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>.</p>
<ol>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">1</span> <span class="nu0">0.000000</span> 0.0.0.0 255.255.255.255 DHCP DHCP Discover -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">1</span> <span class="br0">(</span><span class="nu0">590</span> bytes on wire, <span class="nu0">590</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span>, Dst Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Request <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Discover</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">57</span>,<span class="re2">l</span>=<span class="nu0">2</span><span class="br0">)</span> Maximum DHCP Message Size = <span class="nu0">548</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">55</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Parameter Request List</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">12</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Host Name = <span class="st0">"box"</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">2</span> <span class="nu0">0.000351</span> 192.168.1.34 192.168.1.254 DHCP DHCP Offer -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">2</span> <span class="br0">(</span><span class="nu0">342</span> bytes on wire, <span class="nu0">342</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: AsustekC_15:<span class="nu0">80</span>:7e <span class="br0">(</span>00:<span class="nu0">17</span>:<span class="nu0">31</span>:<span class="nu0">15</span>:<span class="nu0">80</span>:7e<span class="br0">)</span>, Dst: CadmusCo_b2:8b:ec</div>
</li>
<li class="li1">
<div class="de1"><span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 192.168.1.34 <span class="br0">(</span>192.168.1.34<span class="br0">)</span>, Dst: 192.168.1.254 <span class="br0">(</span>192.168.1.254<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span>, Dst Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Reply <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8a1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 192.168.1.254 <span class="br0">(</span>192.168.1.254<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Offer</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">54</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Server Identifier = 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">1</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Subnet Mask = 255.255.255.0</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">3</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Router = 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">6</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Domain Name Server = 192.168.1.1</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">15</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Domain Name = <span class="st0">"domain.org"</span></div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">3</span> <span class="nu0">0.009004</span> 0.0.0.0 255.255.255.255 DHCP DHCP Request -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">3</span> <span class="br0">(</span><span class="nu0">590</span> bytes on wire, <span class="nu0">590</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span>, Dst Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Request <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x0000 <span class="br0">(</span>Unicast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP Request</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">57</span>,<span class="re2">l</span>=<span class="nu0">2</span><span class="br0">)</span> Maximum DHCP Message Size = <span class="nu0">548</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">55</span>,<span class="re2">l</span>=<span class="nu0">11</span><span class="br0">)</span> Parameter Request List</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">12</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Host Name = <span class="st0">"box"</span></div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">51</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> IP Address Lease Time = <span class="nu0">12</span> hours</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">54</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Server Identifier = 192.168.1.34</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">50</span>,<span class="re2">l</span>=<span class="nu0">4</span><span class="br0">)</span> Requested IP Address = 192.168.1.254</div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">No. Time Source Destination Protocol Info</div>
</li>
<li class="li1">
<div class="de1"><span class="nu0">4</span> <span class="nu0">0.010712</span> 192.168.1.1 255.255.255.255 DHCP DHCP NAK -</div>
</li>
<li class="li1">
<div class="de1">Transaction ID 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1"> </div>
</li>
<li class="li1">
<div class="de1">Frame <span class="nu0">4</span> <span class="br0">(</span><span class="nu0">342</span> bytes on wire, <span class="nu0">342</span> bytes captured<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Ethernet II, Src: XaviTech_7b:ff:1d <span class="br0">(</span>00:01:<span class="nu0">38</span>:7b:ff:1d<span class="br0">)</span>, Dst: Broadcast <span class="br0">(</span>ff:ff:ff:ff:ff:ff<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Internet Protocol, Src: 192.168.1.1 <span class="br0">(</span>192.168.1.1<span class="br0">)</span>, Dst: 255.255.255.255 <span class="br0">(</span>255.255.255.255<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">User Datagram Protocol, Src Port: bootps <span class="br0">(</span><span class="nu0">67</span><span class="br0">)</span>, Dst Port: bootpc <span class="br0">(</span><span class="nu0">68</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Bootstrap Protocol</div>
</li>
<li class="li1">
<div class="de1">Message <span class="kw3">type</span>: Boot Reply <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Hardware <span class="kw3">type</span>: Ethernet</div>
</li>
<li class="li1">
<div class="de1">Hardware address length: <span class="nu0">6</span></div>
</li>
<li class="li1">
<div class="de1">Hops: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Transaction ID: 0x8b1327b2</div>
</li>
<li class="li1">
<div class="de1">Seconds elapsed: <span class="nu0">0</span></div>
</li>
<li class="li1">
<div class="de1">Bootp flags: 0x8000 <span class="br0">(</span>Broadcast<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Your <span class="br0">(</span>client<span class="br0">)</span> IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Next server IP address: 192.168.1.1 <span class="br0">(</span>192.168.1.1<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Relay agent IP address: 0.0.0.0 <span class="br0">(</span>0.0.0.0<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Client MAC address: CadmusCo_b2:8b:ec <span class="br0">(</span>08:00:<span class="nu0">27</span>:b2:8b:ec<span class="br0">)</span></div>
</li>
<li class="li1">
<div class="de1">Server host name not given</div>
</li>
<li class="li1">
<div class="de1">Boot <span class="kw2">file</span> name not given</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">53</span>,<span class="re2">l</span>=<span class="nu0">1</span><span class="br0">)</span> DHCP Message Type = DHCP NAK</div>
</li>
<li class="li1">
<div class="de1">Option: <span class="br0">(</span><span class="re2">t</span>=<span class="nu0">56</span>,<span class="re2">l</span>=<span class="nu0">31</span><span class="br0">)</span> Message = <span class="st0">"requested address not available"</span></div>
</li>
<li class="li1">
<div class="de1">End Option</div>
</li>
<li class="li1">
<div class="de1">Padding</div>
</li>
</ol>
</div>
<h2><a id="realitzar_documentacio_de_suport_a_l_usuari"></a>Realitzar documentació de suport a l'usuari</h2>
<div class="level2">
<p>Una de les facetes més ignorades en el camp de la informàtica és la confecció de manuals i documentació de suport. Com a clients molt sovint ens queixem que falta informació o que està mal redactada. Com a administradors de xarxa no trobem mai temps per anotar les coses. Mentre les tenim al cap no creiem necessari fer la documentació, quan no ho tenim al cap, ja ens és impossible fer-ho, i sovint, és just quan en faria falta haver-ho fet! Fem un repàs de la informació necessària que cal documentar, tant per a l’usuari com per a l’administrador.</p>
<div class="iocreference">
<div class="ioccontent">
<p>Un altre exemple de captura <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> es lliura com a material complementari. En aquesta captura hi ha dos servidors dhcp diferents en la xarxa i es poden observar paquets NACK. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.</p>
</div>
</div>
<p>El client ha de saber:</p>
<ul>
<li class="level1">
<div class="li">Com contactar amb el servidor <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Quin programari ha d’utilitzar i com l’ha de configurar per fer ús del servei.</div>
</li>
<li class="level1">
<div class="li">Quina és la informació que s’obtindrà via <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>. Cal saber visualitzar, consultar aquesta informació i saber què significa, per a què serveix.</div>
</li>
</ul>
<p>Així doncs, la documentació de l’usuari descriurà el procés per activar el client <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>, amb captures de pantalla que facilitin aquest procés. Cal també exemples de llista de concessions rebudes, on són i com es poden consultar aquestes concessions. La part més important és mostrar un exemple de configuració de xarxa rebuda on es detalli el significat de cada element i explicar a l’usuari com fer aquesta consulta.</p>
<p>Un exemple d’informació a proporcionar podria ser el següent:</p>
<pre class="code">L'usuari pot consultar la concessió de xarxa amb l'ordre:
C:\&gt;ifconfig /all
Configuración IP de Windows
        Nombre del host . . . . . . . . . : nombre-29b9943f
        Sufijo DNS principal  . . . . . . : 
        Tipo de nodo. . . . . . . . . . . : híbrido
        Enrutamiento habilitado. . . . . .: No
        Proxy WINS habilitado. . . . .    : No
        Lista de búsqueda de sufijo DNS:    local.lan

Adaptador Ethernet Conexiones de red inalámbricas          :
        Estado de los medios. . . .: medios desconectados
        Descripción. . . . . . . . . . .  : Intel(R) PRO/Wireless 3945ABG Net Connection
        Dirección física. . . . . . . . . : 00-31-02-44-9F-5A

Adaptador Ethernet Conexión de área local          :
        Sufijo de conexión específica DNS : local.lan
        Descripción. . . . . . . . . . .  : Realtek RTL8168/8111 PCI-E Gigabit Ether NIC
        Dirección física. . . . . . . . . : 00-21-32-80-23-7D
        DHCP habilitado. . . . . . . . .  : No
        Autoconfiguración habilitada. . . : Sí
        Dirección IP. . . . . . . . . . . : 192.168.1.33
        Máscara de subred . . . . . . . . : 255.255.255.0
        Puerta de enlace predeterminada   : 192.168.1.1
        Servidor DHCP . . . . . . . . . . : 192.168.1.1
        Servidores DNS . . . . . . . . . .: 80.58.61.250
                                            80.58.61.254
        Concesión obtenida . . . . . . .  : jueves, 24 de septiembre de 2009 12:09:16
        Concesión expira . . . . . . . . .: jueves, 24 de septiembre de 2009 13:09:16</pre>
<p>Els principals valors de xarxa a destacar són: Adreça IP, màscara de xarxa, el router o porta d’enllaç predeterminada, el servidor dhcp amb el qual s’ha contactat, els servidors de noms <acronym title="Domain Name System">DNS</acronym> que s’utilitzen i quan expira la concessió.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ReflectionfpdmodifIdevice em_iDevice" id="id76">
<div class="iDevice emphasis_reflexionfpd" >
<div class="iDevice_header"><h2 class="iDeviceTitle">Reflexiona</h2></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta76_121" class="block iDevice_content">
<p><strong>Reconfiguració d'una xarxa</strong></p>
<p>Imagineu la diversió de l’administrador d’una xarxa corporativa de 1.000 equips amb adreces estàtiques quan cal reconfigurar-la en un cap de setmana!</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id79">
<div class="iDevice emphasis_parasabermasfpd" >
<div class="iDevice_header"><h2 class="iDeviceTitle">Per saber més</h2></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta79_128" class="block iDevice_content">
<p><strong>DNS dinàmic</strong></p>
<p>Hi ha serveis de DNS dinàmic (DDNS) que permeten assignar un nom de domini a equips amb adreça IP dinàmica.</p>
</div>
</div>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Llicència Creative Commons Reconeixement CompartirIgual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="continguts.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="11_evoluci_del_protocol_dhcp.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="my_js.js"></script></body></html>